define("common/modules/commercial/tags/imrworldwide",["common/utils/config"],function(e){function o(){if(e.switches.imrWorldwide){var o=new Image;return o.src=["//secure-uk.imrworldwide.com/cgi-bin/m?ci=uk-305078h&cg=0&cc=1&ts=compact","&si=",encodeURI(window.location.href),"&rp=",encodeURI(document.referrer),"&rnd=",(new Date).getTime()].join(""),o}}return{load:o}}),define("common/modules/commercial/tags/media-math",["common/utils/config","lodash/objects/defaults","lodash/objects/pairs"],function(e,o,t){var n="//pixel.mathtag.com/event/img?mt_id=328671&mt_adid=114751",s=function(e){return e.split("?").pop().split("&").filter(function(e){return["q","p","as_q","as_epq","as_oq","query","search","wd","ix"].indexOf(e.split("=").shift())>-1}).map(function(e){return decodeURIComponent(e.split("=").pop().replace(/\\+/g," "))}).shift()};return{load:function(i){if(i=o(i||{},e,{referrer:document.referrer,switches:{},page:{}}),!i.switches.mediaMath)return!1;var r=i.page,a=t({v1:(r.host?r.host:"")+"/"+r.pageId,v2:r.section,v3:s(i.referrer),v4:i.referrer,v5:r.keywords?r.keywords.replace(/,/g,"|"):"",v6:r.contentType?r.contentType.toLowerCase():""}).map(function(e){return e.join("=")}).join("&"),c=new Image;return c.src=n+"&"+a,c}}}),define("common/modules/commercial/tags/remarketing",["common/utils/config"],function(e){function o(){return e.switches.remarketing?require(["js!"+t+"!exports=google_trackConversion"],function(){window.google_trackConversion({google_conversion_id:971225648,google_custom_params:window.google_tag_params,google_remarketing_only:!0})}):void 0}var t="//www.googleadservices.com/pagead/conversion_async.js";return{load:o}}),define("common/modules/commercial/tags/amaa",["common/utils/config"],function(e){function o(){return e.switches.amaa?require(["js!"+t+"!exports=superT"]):void 0}var t="//c.supert.ag/the-guardian/the-guardian/supertag-async.js";return{load:o}}),define("common/modules/commercial/tags/effective-measure",["common/utils/config"],function(e){function o(){return e.switches.effectiveMeasure?require(["js!"+t+"!exports=_EMeasure"]):void 0}var t=("https:"===document.location.protocol?"https://au-ssl":"http://au-cdn")+".effectivemeasure.net/em.js";return{load:o}}),define("common/modules/commercial/tags/container",["lodash/objects/defaults","common/utils/config","common/modules/commercial/tags/audience-science","common/modules/commercial/tags/audience-science-gateway","common/modules/commercial/tags/imrworldwide","common/modules/commercial/tags/media-math","common/modules/commercial/tags/criteo","common/modules/commercial/tags/remarketing","common/modules/commercial/tags/amaa","common/modules/commercial/tags/effective-measure"],function(e,o,t,n,s,i,r,a,c,m){function l(l){var d=e(l||{},o,{switches:{},page:{}});if("Identity"===d.page.contentType||"identity"===d.page.section)return!1;switch(d.page.edition.toLowerCase()){case"au":c.load(),m.load();break;default:t.load(),n.load()}i.load(),r.load(),s.load(),a.load()}return{init:l}}),define("common/modules/commercial/article-aside-adverts",["lodash/objects/defaults","lodash/functions/once","common/utils/$","common/utils/config","common/modules/commercial/dfp"],function(e,o,t,n,s){function i(o){var i=e(o||{},n,{columnSelector:".content__secondary-column",adSlotContainerSelector:".js-mpu-ad-slot",switches:{},page:{}});return i.switches.standardAdverts&&"Article"===i.page.contentType&&"none"!==t(i.columnSelector).css("display")?t(i.adSlotContainerSelector).append(s.createAdSlot("right","mpu-banner-ad")):!1}return{init:o(i),reset:function(){this.init=o(i)}}}),define("common/modules/article/spacefinder",["bonzo","qwery","common/utils/_"],function(e,o,t){function n(e){return{top:e.offsetTop,bottom:e.offsetTop+e.offsetHeight,element:e}}function s(e,s,i){var a=t(e).filter(function(e){return e.top>=s.minAbove&&e.top+s.minBelow<=i});return t(s.selectors).forOwn(function(e,s){var i=t(o(r+s)).map(n);a=a.filter(function(o){return m(o,i,e)})}),a.valueOf()}function i(e){e=e||a;var i=o(r)[0].offsetHeight,c=t(o(r+" > *")).map(n),m=c.filter(function(e){return"p"===e.element.tagName.toLowerCase()}),l=s(m,e,i);return l.length?l[0].element:void 0}var r=".js-article__body",a={minAbove:250,minBelow:300,selectors:{" > h2":{minAbove:0,minBelow:250}," > *:not(p):not(h2)":{minAbove:25,minBelow:250}}},c=function(e,o,t){var n=e.top-o.bottom>=t.minAbove,s=o.top-e.bottom>=t.minBelow;return n||s},m=function(e,o,n){return t(o).every(function(o){return c(e,o,n)}).valueOf()};return{getParaWithSpace:i,_testElem:c,_testElems:m}}),define("common/modules/commercial/article-body-adverts",["lodash/objects/defaults","lodash/functions/once","common/utils/$","common/utils/config","common/utils/detect","common/modules/commercial/dfp","common/modules/article/spacefinder"],function(e,o,t,n,s,i,r){var a=[],c=function(e){if(e){var o=t.create(i.createAdSlot("inline"+(a.length+1),"inline")).insertBefore(e);a.push(o)}},m=function(o){var t=e(o||{},n,{switches:{}});if(!t.switches.standardAdverts||"Article"!==t.page.contentType||t.page.isLiveBlog)return!1;var i=s.getBreakpoint(),a={minAbove:250,minBelow:300,selectors:{" > h2":{minAbove:"mobile"===i?20:0,minBelow:250}," > *:not(p):not(h2)":{minAbove:25,minBelow:250}," .ad-slot":{minAbove:500,minBelow:500}}};/wide|desktop|tablet/.test(i)?(c(r.getParaWithSpace(a)),window.innerWidth<900&&c(r.getParaWithSpace(a))):(c(r.getParaWithSpace(a)),c(r.getParaWithSpace(a)))};return{init:o(m),destroy:function(){a.forEach(function(e){e.remove()})},reset:function(){a=[],this.init=o(m)}}}),define("common/modules/commercial/slice-adverts",["bonzo","qwery","lodash/objects/defaults","lodash/functions/once","common/utils/$","common/utils/config","common/utils/template","common/modules/userPrefs","common/modules/commercial/dfp"],function(e,o,t,n,s,i,r,a,c){var m=["inline1","inline2"],l=function(n){var r=t(n||{},i,{containerSelector:".container",sliceSelector:".js-slice--ad-candidate",page:{},switches:{}});if(!r.switches.standardAdverts)return!1;for(var l=o(r.containerSelector),d=0,u=[],f=2,h=a.get("container-states");d<l.length;){var p=l[d],g=e(p).data("id"),v=s(r.sliceSelector,p),w=["uk","us","au"].indexOf(r.page.pageId)>-1&&0===d;!v.length||w||h&&"closed"===h[g]?d++:(u.push(v.first()),d+=f+1)}return u.slice(0,m.length).forEach(function(o,t){var n=m[t],s=e(c.createAdSlot(n,"container-inline"));o.addClass("slice--has-ad").append(s)}),u};return{init:n(l),reset:function(){this.init=n(l)}}}),define("common/modules/commercial/front-commercial-components",["bonzo","lodash/objects/defaults","lodash/functions/once","common/utils/$","common/utils/config","common/modules/commercial/dfp"],function(e,o,t,n,s,i){function r(t){var r=o(t||{},s,{switches:{},page:{}});if(!r.switches.commercialComponents||!r.page.isFront||r.page.hasPageSkin)return!1;var a=e(i.createAdSlot("merchandising-high","commercial-component-high")),c=n(".container");return c.length>=4?a.insertAfter(c[1]):c.length>=2?a.insertAfter(c[0]):void 0}return{init:t(r),reset:function(){this.init=t(r)}}}),define("common/modules/commercial/badges",["qwery","bonzo","lodash/objects/defaults","lodash/functions/once","common/utils/$","common/utils/template","common/utils/config","common/modules/commercial/dfp"],function(e,o,t,n,s,i,r,a){var c=!1,m=!1,l=function(e,o,t){t&&(e.append(i('<div class="ad-slot--paid-for-badge__inner"><h3 class="ad-slot--paid-for-badge__header">{{header}}</h3><p class="ad-slot--paid-for-badge__header">{{sponsor}}</p></div>',{header:o?"Sponsored by:":"Advertisement feature",sponsor:t})),o||s(".ad-slot--paid-for-badge__header",e[0]).first().after('<p class="ad-slot--paid-for-badge__label">in association with</p>'))},d=function(e,t,n){if(!(t&&c||!t&&m)){var i=o(a.createAdSlot((t?"sp":"ad")+"badge",["paid-for-badge","paid-for-badge--front"],n.keywords));t?(l(i,!0,n.sponsor),c=!0):(l(i,!1,n.sponsor),m=!0),s(".container__header",e).after(i)}},u=function(n){var i=t(n||{},r,{switches:{}});return i.switches.sponsored?(s(".facia-container--sponsored, .facia-container--advertisement-feature").each(function(t){var n=o(t);d(e(".container",t)[0],n.hasClass("facia-container--sponsored"),{sponsor:n.data("sponsor")})}),void s(".container--sponsored, .container--advertisement-feature").each(function(t){if(0===e(".ad-slot--paid-for-badge",t).length){var n=o(t);d(t,o(t).hasClass("container--sponsored"),{keywords:n.data("keywords"),sponsor:n.data("sponsor")})}})):!1},f={init:n(u),reset:function(){f.init=n(u),c=!1,m=!1}};return f}),define("common/modules/commercial/loader",["bonzo","common/utils/$","common/utils/mediator","common/utils/storage","common/modules/lazyload","common/modules/component","bean","common/modules/ui/tabs"],function(e,o,t,n,i,r,a,c){var m=function(e){var o=e.config.page||{};return this.pageId=o.pageId,this.keywordIds=o.keywordIds||"",this.section=o.section,this.host=o.ajaxUrl+"/commercial/",this.desktopUserVariant=o.ab_commercialInArticleDesktop||"",this.mobileUserVariant=o.ab_commercialInArticleMobile||"",this.oastoken=e.oastoken||"",this.adType=e.adType||"desktop",this.components={bestbuy:this.host+"money/bestbuys.json",bestbuyHigh:this.host+"money/bestbuys-high.json",book:this.host+"books/book/"+this.pageId+".json",books:this.host+"books/bestsellers.json?"+this.getKeywords(),booksMedium:this.host+"books/bestsellers-medium.json?"+this.getKeywords(),booksHigh:this.host+"books/bestsellers-high.json?"+this.getKeywords(),jobs:this.host+"jobs.json?"+this.getKeywords(),jobsHigh:this.host+"jobs-high.json?"+this.getKeywords(),masterclasses:this.host+"masterclasses.json?"+this.getKeywords(),masterclassesHigh:this.host+"masterclasses-high.json?"+this.getKeywords(),soulmates:this.host+"soulmates/mixed.json",soulmatesHigh:this.host+"soulmates/mixed-high.json",travel:this.host+"travel/offers.json?s="+this.section+"&"+this.getKeywords(),travelHigh:this.host+"travel/offers-high.json?s="+this.section+"&"+this.getKeywords()},this.postLoadEvents={books:function(e){a.on(e,"click",".commercial__search__submit",function(){var t="merchandising-bookshop-v0_7_2014-03-12-low-"+e.querySelector(".commercial__search__input").value,n=o.contentType?o.contentType+":"+t:t;s.linkTrackVars="prop22,eVar22,eVar37,events",s.linkTrackEvents="event7,event37",s.events="event7,event37",s.prop22=n,s.eVar22=n,s.eVar37=n,s.tl(!0,"o",t)})},bestbuy:function(e){(new c).init(e)}},this};return r.define(m),m.prototype.getKeywords=function(){return this.keywordIds?this.keywordIds.split(",").map(function(e){return"k="+encodeURIComponent(e.split("/").pop())}).join("&"):"k="+this.pageId.split("/").pop()},m.prototype.load=function(e,o){var n=this,s=this.components[e];return new i({url:s,container:o,beforeInsert:function(e){return e?e.replace(/%OASToken%/g,n.oastoken).replace(/%OmnitureToken%/g,""):e},success:function(){e in n.postLoadEvents&&n.postLoadEvents[e](o),t.emit("modules:commercial/loader:loaded")},error:function(e){t.emit("module:error","Failed to load related: "+e.statusText,"common/modules/commercial/loader.js")}}).load(),this},m.prototype.init=function(e,o){return void 0===this.components[e]?(t.emit("module:error","Unknown commercial component: "+e,"common/modules/commercial/loader.js"),!1):this.load(e,o)},m}),define("bootstraps/commercial",["bonzo","qwery","common/utils/config","common/modules/userPrefs","common/modules/commercial/tags/container","common/modules/commercial/article-aside-adverts","common/modules/commercial/article-body-adverts","common/modules/commercial/slice-adverts","common/modules/commercial/front-commercial-components","common/modules/commercial/badges","common/modules/commercial/dfp","common/modules/commercial/loader"],function(e,o,t,n,s,i,r,a,c,m,l,d){function u(){[["commercial-component","merchandising"],["commercial-component-high","merchandising-high"]].forEach(function(n){var s=new RegExp("^#"+n[0]+"=(.*)$").exec(window.location.hash),i=o('[data-name="'+n[1]+'"]').shift();if(s&&i){e(i).removeClass("ad-slot--dfp");var r=new d({config:t}),a={};a[s[1]]=function(){e(i).css("display","block")},r.postLoadEvents=a,r.init(s[1],i)}}),n.isOff("adverts")||t.page.shouldHideAdverts||t.page.isSSL||(s.init(t),i.init(),r.init(),a.init(),c.init(),m.init(),l.init())}return{init:u}});
//# sourceMappingURL=commercial.js.map