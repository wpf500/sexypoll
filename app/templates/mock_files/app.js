function Imager(e,t){t=t||{},this.update(e),t.strategy=t.strategy||"replacer",this.replacementDelay=t.hasOwnProperty("replacementDelay")?t.replacementDelay:200,this.availableWidths=t.availableWidths||[320,480,768],this.availableWidths=this.availableWidths.sort(function(e,t){return t-e}),this._processing=!1;var n=t.strategy.call?t.strategy:Imager.strategies[t.strategy];this.strategy=new n(t.placeholder)}function s_doPlugins(e){e.prop61="D=g",e.eVar38||(e.eVar38=e.getQueryParam("CMP")),e.eVar38=e.getValOnce(e.eVar38,"s_eVar38",0);var t=new Date;now=Math.floor(t.getTime()/864e5);var n=now-13,o=e.c_r("s_daily_habit")+"";o=o.split(","),newDiary=[],vC=1;for(var i=0,s=o.length;s>i;++i){var a=o[i];a>=n&&a!=now&&(vC+=1)&&newDiary.push(a)}newDiary.push(now),newDiary=newDiary.join(","),t.setFullYear(t.getFullYear()+5),e.c_w("s_daily_habit",newDiary,t),e.eVar64=vC+"/14",e.eVar10=e.getDaysSinceLastVisit("s_lv")}function s_gi(e,t,n){var o,i,s,a,r,c='s.version=\'H.25.3\';s.an=s_an;s.logDebug=function(m){var s=this,tcf=new Function(\'var e;try{console.log("\'+s.rep(s.rep(s.rep(m,"\\\\","\\\\\\\\"),"\\n","\\\\n"),"\\"","\\\\\\"")+\'");}catch(e){}\');tcf()};s.cls=function(x,c){var i,y=\'\';if(!c)c=this.an;for(i=0;i<x.length;i++){n=x.substring(i,i+1);if(c.indexOf(n)>=0)y+=n}retur'+"n y};s.fl=function(x,l){return x?(''+x).substring(0,l):x};s.co=function(o){return o};s.num=function(x){x=''+x;for(var p=0;p<x.length;p++)if(('0123456789').indexOf(x.substring(p,p+1))<0)return 0;return 1};s.rep=s_rep;s.sp=s_sp;s.jn=s_jn;s.ape=function(x){var s=this,h='0123456789ABCDEF',f=\"+~!*()'\",i,c=s.charSet,n,l,e,y='';c=c?c.toUpperCase():'';if(x){x=''+x;if(s.em==3){x=encodeURIComponent(x);for(i=0;i<f.length;i++) {n=f.substring(i,i+1);if(x.indexOf(n)>=0)x=s.rep(x,n,\"%\"+n.charCodeAt(0).toString(16).toUpperCase())}}else if(c=='AUTO'&&('').charCodeAt){for(i=0;i<x.length;i++){c=x.substring(i,i+1);n=x.charCodeAt(i);if(n>127){l=0;e='';while(n||l<4){e=h.substring(n%16,n%16+1)+e;n=(n-n%16)/16;l++}y+='%u'+e}else if(c=='+')y+='%2B';else y+=escape(c)}x=y}else x=s.rep(escape(''+x),'+','%2B');if(c&&c!='AUTO'&&s.em==1&&x.indexOf('%u')<0&&x.indexOf('%U')<0){i=x.indexOf('%');while(i>=0){i++;if(h.substring(8).indexOf(x.substring(i,i+1).toUpperCase())>=0)return x.substring(0,i)+'u00'+x.substring(i);i=x.indexOf('%',i)}}}return x};s.epa=function(x){var s=this,y,tcf;if(x){x=s.rep(''+x,'+',' ');if(s.em==3){tcf=new Function('x','var y,e;try{y=decodeURIComponent(x)}catch(e){y=unescape(x)}return y');return tcf(x)}else return unescape(x)}return y};s.pt=function(x,d,f,a){var s=this,t=x,z=0,y,r;while(t){y=t.indexOf(d);y=y<0?t.length:y;t=t.substring(0,y);r=s[f](t,a);if(r)return r;z+=y+d.length;t=x.substring(z,x.length);t=z<x.length?t:''}return ''};s.isf=function(t,a){var c=a.indexOf(':');if(c>=0)a=a.substring(0,c);c=a.indexOf('=');if(c>=0)a=a.substring(0,c);if(t.substring(0,2)=='s_')t=t.substring(2);return (t!=''&&t==a)};s.fsf=function(t,a){var s=this;if(s.pt(a,',','isf',t))s.fsg+=(s.fsg!=''?',':'')+t;return 0};s.fs=function(x,f){var s=this;s.fsg='';s.pt(x,',','fsf',f);return s.fsg};s.mpc=function(m,a){var s=this,c,l,n,v;v=s.d.visibilityState;if(!v)v=s.d.webkitVisibilityState;if(v&&v=='prerender'){if(!s.mpq){s.mpq=new Array;l=s.sp('webkitvisibilitychange,visibilitychange',',');for(n=0;n<l.length;n++){s.d.addEventListener(l[n],new Function('var s=s_c_il['+s._in+'],c,v;v=s.d.visibilityState;if(!v)v=s.d.webkitVisibilityState;if(s.mpq&&v==\"visible\"){while(s.mpq.length>0){c=s.mpq.shift();s[c.m].apply(s,c.a)}s.mpq=0}'),false)}}c=new Object;c.m=m;c.a=a;s.mpq.push(c);return 1}return 0};s.si=function(){var s=this,i,k,v,c=s_gi+'var s=s_gi(\"'+s.oun+'\");s.sa(\"'+s.un+'\");';for(i=0;i<s.va_g.length;i++){k=s.va_g[i];v=s[k];if(v!=undefined){if(typeof(v)!='number')c+='s.'+k+'=\"'+s_fe(v)+'\";';else c+='s.'+k+'='+v+';'}}c+=\"s.lnk=s.eo=s.linkName=s.linkType=s.wd.s_objectID=s.ppu=s.pe=s.pev1=s.pev2=s.pev3='';\";return c};s.c_d='';s.c_gdf=function(t,a){var s=this;if(!s.num(t))return 1;return 0};s.c_gd=function(){var s=this,d=s.wd.location.hostname,n=s.fpCookieDomainPeriods,p;if(!n)n=s.cookieDomainPeriods;if(d&&!s.c_d){n=n?parseInt(n):2;n=n>2?n:2;p=d.lastIndexOf('.');if(p>=0){while(p>=0&&n>1){p=d.lastIndexOf('.',p-1);n--}s.c_d=p>0&&s.pt(d,'.','c_gdf',0)?d.substring(p):d}}return s.c_d};s.c_r=function(k){var s=this;k=s.ape(k);var c=' '+s.d.cookie,i=c.indexOf(' '+k+'='),e=i<0?i:c.indexOf(';',i),v=i<0?'':s.epa(c.substring(i+2+k.length,e<0?c.length:e));return v!='[[B]]'?v:''};s.c_w=function(k,v,e){var s=this,d=s.c_gd(),l=s.cookieLifetime,t;v=''+v;l=l?(''+l).toUpperCase():'';if(e&&l!='SESSION'&&l!='NONE'){t=(v!=''?parseInt(l?l:0):-60);if(t){e=new Date;e.setTime(e.getTime()+(t*1000))}}if(k&&l!='NONE'){s.d.cookie=k+'='+s.ape(v!=''?v:'[[B]]')+'; path=/;'+(e&&l!='SESSION'?' expires='+e.toGMTString()+';':'')+(d?' domain='+d+';':'');return s.c_r(k)==v}return 0};s.eh=function(o,e,r,f){var s=this,b='s_'+e+'_'+s._in,n=-1,l,i,x;if(!s.ehl)s.ehl=new Array;l=s.ehl;for(i=0;i<l.length&&n<0;i++){if(l[i].o==o&&l[i].e==e)n=i}if(n<0){n=i;l[n]=new Object}x=l[n];x.o=o;x.e=e;f=r?x.b:f;if(r||f){x.b=r?0:o[e];x.o[e]=f}if(x.b){x.o[b]=x.b;return b}return 0};s.cet=function(f,a,t,o,b){var s=this,r,tcf;if(s.apv>=5&&(!s.isopera||s.apv>=7)){tcf=new Function('s','f','a','t','var e,r;try{r=s[f](a)}catch(e){r=s[t](e)}return r');r=tcf(s,f,a,t)}else{if(s.ismac&&s.u.indexOf('MSIE 4')>=0)r=s[b](a);else{s.eh(s.wd,'onerror',0,o);r=s[f](a);s.eh(s.wd,'onerror',1)}}return r};s.gtfset=function(e){var s=this;return s.tfs};s.gtfsoe=new Function('e','var s=s_c_il['+s._in+'],c;s.eh(window,\"onerror\",1);s.etfs=1;c=s.t();if(c)s.d.write(c);s.etfs=0;return true');s.gtfsfb=function(a){return window};s.gtfsf=function(w){var s=this,p=w.parent,l=w.location;s.tfs=w;if(p&&p.location!=l&&p.location.host==l.host){s.tfs=p;return s.gtfsf(s.tfs)}return s.tfs};s.gtfs=function(){var s=this;if(!s.tfs){s.tfs=s.wd;if(!s.etfs)s.tfs=s.cet('gtfsf',s.tfs,'gtfset',s.gtfsoe,'gtfsfb')}return s.tfs};s.mrq=function(u){var s=this,l=s.rl[u],n,r;s.rl[u]=0;if(l)for(n=0;n<l.length;n++){r=l[n];s.mr(0,0,r.r,r.t,r.u)}};s.flushBufferedRequests=function(){};s.mr=function(sess,q,rs,ta,u){var s=this,dc=s.dc,t1=s.trackingServer,t2=s.trackingServerSecure,tb=s.trackingServerBase,p='.sc',ns=s.visitorNamespace,un=s.cls(u?u:(ns?ns:s.fun)),r=new Object,l,imn='s_i_'+(un),im,b,e;if(!rs){if(t1){if(t2&&s.ssl)t1=t2}else{if(!tb)tb='2o7.net';if(dc)dc=(''+dc).toLowerCase();else dc='d1';if(tb=='2o7.net'){if(dc=='d1')dc='112';else if(dc=='d2')dc='122';p=''}t1=un+'.'+dc+'.'+p+tb}rs='http'+(s.ssl?'s':'')+'://'+t1+'/b/ss/'+s.un+'/'+(s.mobile?'5.1':'1')+'/'+s.version+(s.tcn?'T':'')+'/'+sess+'?AQB=1&ndh=1'+(q?q:'')+'&AQE=1';if(s.isie&&!s.ismac)rs=s.fl(rs,2047)}if(s.d.images&&s.apv>=3&&(!s.isopera||s.apv>=7)&&(s.ns6<0||s.apv>=6.1)){if(!s.rc)s.rc=new Object;if(!s.rc[un]){s.rc[un]=1;if(!s.rl)s.rl=new Object;s.rl[un]=new Array;setTimeout('if(window.s_c_il)window.s_c_il['+s._in+'].mrq(\"'+un+'\")',750)}else{l=s.rl[un];if(l){r.t=ta;r.u=un;r.r=rs;l[l.length]=r;return ''}imn+='_'+s.rc[un];s.rc[un]++}if(s.debugTracking){var d='AppMeasurement Debug: '+rs,dl=s.sp(rs,'&'),dln;for(dln=0;dln<dl.length;dln++)d+=\"\\n\\t\"+s.epa(dl[dln]);s.logDebug(d)}im=s.wd[imn];if(!im)im=s.wd[imn]=new Image;im.s_l=0;im.onload=new Function('e','this.s_l=1;var wd=window,s;if(wd.s_c_il){s=wd.s_c_il['+s._in+'];s.bcr();s.mrq(\"'+un+'\");s.nrs--;if(!s.nrs)s.m_m(\"rr\")}');if(!s.nrs){s.nrs=1;s.m_m('rs')}else s.nrs++;im.src=rs;if(s.useForcedLinkTracking||s.bcf){if(!s.forcedLinkTrackingTimeout)s.forcedLinkTrackingTimeout=250;setTimeout('if(window.s_c_il)window.s_c_il['+s._in+'].bcr()',s.forcedLinkTrackingTimeout);}else if((s.lnk||s.eo)&&(!ta||ta=='_self'||ta=='_top'||(s.wd.name&&ta==s.wd.name))){b=e=new Date;while(!im.s_l&&e.getTime()-b.getTime()<500)e=new Date}return ''}return '<im'+'g sr'+'c=\"'+rs+'\" width=1 height=1 border=0 alt=\"\">'};s.gg=function(v){var s=this;if(!s.wd['s_'+v])s.wd['s_'+v]='';return s.wd['s_'+v]};s.glf=function(t,a){if(t.substring(0,2)=='s_')t=t.substring(2);var s=this,v=s.gg(t);if(v)s[t]=v};s.gl=function(v){var s=this;if(s.pg)s.pt(v,',','glf',0)};s.rf=function(x){var s=this,y,i,j,h,p,l=0,q,a,b='',c='',t;if(x&&x.length>255){y=''+x;i=y.indexOf('?');if(i>0){q=y.substring(i+1);y=y.substring(0,i);h=y.toLowerCase();j=0;if(h.substring(0,7)=='http://')j+=7;else if(h.substring(0,8)=='https://')j+=8;i=h.indexOf(\"/\",j);if(i>0){h=h.substring(j,i);p=y.substring(i);y=y.substring(0,i);if(h.indexOf('google')>=0)l=',q,ie,start,search_key,word,kw,cd,';else if(h.indexOf('yahoo.co')>=0)l=',p,ei,';if(l&&q){a=s.sp(q,'&');if(a&&a.length>1){for(j=0;j<a.length;j++){t=a[j];i=t.indexOf('=');if(i>0&&l.indexOf(','+t.substring(0,i)+',')>=0)b+=(b?'&':'')+t;else c+=(c?'&':'')+t}if(b&&c)q=b+'&'+c;else c=''}i=253-(q.length-c.length)-y.length;x=y+(i>0?p.substring(0,i):'')+'?'+q}}}}return x};s.s2q=function(k,v,vf,vfp,f){var s=this,qs='',sk,sv,sp,ss,nke,nk,nf,nfl=0,nfn,nfm;if(k==\"contextData\")k=\"c\";if(v){for(sk in v)if((!f||sk.substring(0,f.length)==f)&&v[sk]&&(!vf||vf.indexOf(','+(vfp?vfp+'.':'')+sk+',')>=0)&&(!Object||!Object.prototype||!Object.prototype[sk])){nfm=0;if(nfl)for(nfn=0;nfn<nfl.length;nfn++)if(sk.substring(0,nfl[nfn].length)==nfl[nfn])nfm=1;if(!nfm){if(qs=='')qs+='&'+k+'.';sv=v[sk];if(f)sk=sk.substring(f.length);if(sk.length>0){nke=sk.indexOf('.');if(nke>0){nk=sk.substring(0,nke);nf=(f?f:'')+nk+'.';if(!nfl)nfl=new Array;nfl[nfl.length]=nf;qs+=s.s2q(nk,v,vf,vfp,nf)}else{if(typeof(sv)=='boolean'){if(sv)sv='true';else sv='false'}if(sv){if(vfp=='retrieveLightData'&&f.indexOf('.contextData.')<0){sp=sk.substring(0,4);ss=sk.substring(4);if(sk=='transactionID')sk='xact';else if(sk=='channel')sk='ch';else if(sk=='campaign')sk='v0';else if(s.num(ss)){if(sp=='prop')sk='c'+ss;else if(sp=='eVar')sk='v'+ss;else if(sp=='list')sk='l'+ss;else if(sp=='hier'){sk='h'+ss;sv=sv.substring(0,255)}}}qs+='&'+s.ape(sk)+'='+s.ape(sv)}}}}}if(qs!='')qs+='&.'+k}return qs};s.hav=function(){var s=this,qs='',l,fv='',fe='',mn,i,e;if(s.lightProfileID){l=s.va_m;fv=s.lightTrackVars;if(fv)fv=','+fv+','+s.vl_mr+','}else{l=s.va_t;if(s.pe||s.linkType){fv=s.linkTrackVars;fe=s.linkTrackEvents;if(s.pe){mn=s.pe.substring(0,1).toUpperCase()+s.pe.substring(1);if(s[mn]){fv=s[mn].trackVars;fe=s[mn].trackEvents}}}if(fv)fv=','+fv+','+s.vl_l+','+s.vl_l2;if(fe){fe=','+fe+',';if(fv)fv+=',events,'}if (s.events2)e=(e?',':'')+s.events2}for(i=0;i<l.length;i++){var k=l[i],v=s[k],b=k.substring(0,4),x=k.substring(4),n=parseInt(x),q=k;if(!v)if(k=='events'&&e){v=e;e=''}if(v&&(!fv||fv.indexOf(','+k+',')>=0)&&k!='linkName'&&k!='linkType'){if(k=='timestamp')q='ts';else if(k=='dynamicVariablePrefix')q='D';else if(k=='visitorID')q='vid';else if(k=='pageURL'){q='g';if(v.length>255){s.pageURLRest=v.substring(255);v=v.substring(0,255);}}else if(k=='pageURLRest')q='-g';else if(k=='referrer'){q='r';v=s.fl(s.rf(v),255)}else if(k=='vmk'||k=='visitorMigrationKey')q='vmt';else if(k=='visitorMigrationServer'){q='vmf';if(s.ssl&&s.visitorMigrationServerSecure)v=''}else if(k=='visitorMigrationServerSecure'){q='vmf';if(!s.ssl&&s.visitorMigrationServer)v=''}else if(k=='charSet'){q='ce';if(v.toUpperCase()=='AUTO')v='ISO8859-1';else if(s.em==2||s.em==3)v='UTF-8'}else if(k=='visitorNamespace')q='ns';else if(k=='cookieDomainPeriods')q='cdp';else if(k=='cookieLifetime')q='cl';else if(k=='variableProvider')q='vvp';else if(k=='currencyCode')q='cc';else if(k=='channel')q='ch';else if(k=='transactionID')q='xact';else if(k=='campaign')q='v0';else if(k=='resolution')q='s';else if(k=='colorDepth')q='c';else if(k=='javascriptVersion')q='j';else if(k=='javaEnabled')q='v';else if(k=='cookiesEnabled')q='k';else if(k=='browserWidth')q='bw';else if(k=='browserHeight')q='bh';else if(k=='connectionType')q='ct';else if(k=='homepage')q='hp';else if(k=='plugins')q='p';else if(k=='events'){if(e)v+=(v?',':'')+e;if(fe)v=s.fs(v,fe)}else if(k=='events2')v='';else if(k=='contextData'){qs+=s.s2q('c',s[k],fv,k,0);v=''}else if(k=='lightProfileID')q='mtp';else if(k=='lightStoreForSeconds'){q='mtss';if(!s.lightProfileID)v=''}else if(k=='lightIncrementBy'){q='mti';if(!s.lightProfileID)v=''}else if(k=='retrieveLightProfiles')q='mtsr';else if(k=='deleteLightProfiles')q='mtsd';else if(k=='retrieveLightData'){if(s.retrieveLightProfiles)qs+=s.s2q('mts',s[k],fv,k,0);v=''}else if(s.num(x)){if(b=='prop')q='c'+n;else if(b=='eVar')q='v'+n;else if(b=='list')q='l'+n;else if(b=='hier'){q='h'+n;v=s.fl(v,255)}}if(v)qs+='&'+s.ape(q)+'='+(k.substring(0,3)!='pev'?s.ape(v):v)}}return qs};s.ltdf=function(t,h){t=t?t.toLowerCase():'';h=h?h.toLowerCase():'';var qi=h.indexOf('?');h=qi>=0?h.substring(0,qi):h;if(t&&h.substring(h.length-(t.length+1))=='.'+t)return 1;return 0};s.ltef=function(t,h){t=t?t.toLowerCase():'';h=h?h.toLowerCase():'';if(t&&h.indexOf(t)>=0)return 1;return 0};s.lt=function(h){var s=this,lft=s.linkDownloadFileTypes,lef=s.linkExternalFilters,lif=s.linkInternalFilters;lif=lif?lif:s.wd.location.hostname;h=h.toLowerCase();if(s.trackDownloadLinks&&lft&&s.pt(lft,',','ltdf',h))return 'd';if(s.trackExternalLinks&&h.substring(0,1)!='#'&&(lef||lif)&&(!lef||s.pt(lef,',','ltef',h))&&(!lif||!s.pt(lif,',','ltef',h)))return 'e';return ''};s.lc=new Function('e','var s=s_c_il['+s._in+'],b=s.eh(this,\"onclick\");s.lnk=this;s.t();s.lnk=0;if(b)return this[b](e);return true');s.bcr=function(){var s=this;if(s.bct&&s.bce)s.bct.dispatchEvent(s.bce);if(s.bcf){if(typeof(s.bcf)=='function')s.bcf();else if(s.bct&&s.bct.href)s.d.location=s.bct.href}s.bct=s.bce=s.bcf=0};s.bc=new Function('e','if(e&&e.s_fe)return;var s=s_c_il['+s._in+'],f,tcf,t,n,nrs;if(s.d&&s.d.all&&s.d.all.cppXYctnr)return;if(!s.bbc)s.useForcedLinkTracking=0;else if(!s.useForcedLinkTracking){s.b.removeEventListener(\"click\",s.bc,true);s.bbc=s.useForcedLinkTracking=0;return}else s.b.removeEventListener(\"click\",s.bc,false);s.eo=e.srcElement?e.srcElement:e.target;nrs=s.nrs;s.t();s.eo=0;if(s.nrs>nrs&&s.useForcedLinkTracking&&e.target){t=e.target.target;if(e.target.dispatchEvent&&(!t||t==\\'_self\\'||t==\\'_top\\'||(s.wd.name&&t==s.wd.name))){e.stopPropagation();e.stopImmediatePropagation();e.preventDefault();n=s.d.createEvent(\"MouseEvents\");n.initMouseEvent(\"click\",e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget);n.s_fe=1;s.bct=e.target;s.bce=n;}}');s.oh=function(o){var s=this,l=s.wd.location,h=o.href?o.href:'',i,j,k,p;i=h.indexOf(':');j=h.indexOf('?');k=h.indexOf('/');if(h&&(i<0||(j>=0&&i>j)||(k>=0&&i>k))){p=o.protocol&&o.protocol.length>1?o.protocol:(l.protocol?l.protocol:'');i=l.pathname.lastIndexOf('/');h=(p?p+'//':'')+(o.host?o.host:(l.host?l.host:''))+(h.substring(0,1)!='/'?l.pathname.substring(0,i<0?0:i)+'/':'')+h}return h};s.ot=function(o){var t=o.tagName;if(o.tagUrn||(o.scopeName&&o.scopeName.toUpperCase()!='HTML'))return '';t=t&&t.toUpperCase?t.toUpperCase():'';if(t=='SHAPE')t='';if(t){if((t=='INPUT'||t=='BUTTON')&&o.type&&o.type.toUpperCase)t=o.type.toUpperCase();else if(!t&&o.href)t='A';}return t};s.oid=function(o){var s=this,t=s.ot(o),p,c,n='',x=0;if(t&&!o.s_oid){p=o.protocol;c=o.onclick;if(o.href&&(t=='A'||t=='AREA')&&(!c||!p||p.toLowerCase().indexOf('javascript')<0))n=s.oh(o);else if(c){n=s.rep(s.rep(s.rep(s.rep(''+c,\"\\r\",''),\"\\n\",''),\"\\t\",''),' ','');x=2}else if(t=='INPUT'||t=='SUBMIT'){if(o.value)n=o.value;else if(o.innerText)n=o.innerText;else if(o.textContent)n=o.textContent;x=3}else if(o.src&&t=='IMAGE')n=o.src;if(n){o.s_oid=s.fl(n,100);o.s_oidt=x}}return o.s_oid};s.rqf=function(t,un){var s=this,e=t.indexOf('='),u=e>=0?t.substring(0,e):'',q=e>=0?s.epa(t.substring(e+1)):'';if(u&&q&&(','+u+',').indexOf(','+un+',')>=0){if(u!=s.un&&s.un.indexOf(',')>=0)q='&u='+u+q+'&u=0';return q}return ''};s.rq=function(un){if(!un)un=this.un;var s=this,c=un.indexOf(','),v=s.c_r('s_sq'),q='';if(c<0)return s.pt(v,'&','rqf',un);return s.pt(un,',','rq',0)};s.sqp=function(t,a){var s=this,e=t.indexOf('='),q=e<0?'':s.epa(t.substring(e+1));s.sqq[q]='';if(e>=0)s.pt(t.substring(0,e),',','sqs',q);return 0};s.sqs=function(un,q){var s=this;s.squ[un]=q;return 0};s.sq=function(q){var s=this,k='s_sq',v=s.c_r(k),x,c=0;s.sqq=new Object;s.squ=new Object;s.sqq[q]='';s.pt(v,'&','sqp',0);s.pt(s.un,',','sqs',q);v='';for(x in s.squ)if(x&&(!Object||!Object.prototype||!Object.prototype[x]))s.sqq[s.squ[x]]+=(s.sqq[s.squ[x]]?',':'')+x;for(x in s.sqq)if(x&&(!Object||!Object.prototype||!Object.prototype[x])&&s.sqq[x]&&(x==q||c<2)){v+=(v?'&':'')+s.sqq[x]+'='+s.ape(x);c++}return s.c_w(k,v,0)};s.wdl=new Function('e','var s=s_c_il['+s._in+'],r=true,b=s.eh(s.wd,\"onload\"),i,o,oc;if(b)r=this[b](e);for(i=0;i<s.d.links.length;i++){o=s.d.links[i];oc=o.onclick?\"\"+o.onclick:\"\";if((oc.indexOf(\"s_gs(\")<0||oc.indexOf(\".s_oc(\")>=0)&&oc.indexOf(\".tl(\")<0)s.eh(o,\"onclick\",0,s.lc);}return r');s.wds=function(){var s=this;if(s.apv>3&&(!s.isie||!s.ismac||s.apv>=5)){if(s.b&&s.b.attachEvent)s.b.attachEvent('onclick',s.bc);else if(s.b&&s.b.addEventListener){if(s.n&&s.n.userAgent.indexOf('WebKit')>=0&&s.d.createEvent){s.bbc=1;s.useForcedLinkTracking=1;s.b.addEventListener('click',s.bc,true)}s.b.addEventListener('click',s.bc,false)}else s.eh(s.wd,'onload',0,s.wdl)}};s.vs=function(x){var s=this,v=s.visitorSampling,g=s.visitorSamplingGroup,k='s_vsn_'+s.un+(g?'_'+g:''),n=s.c_r(k),e=new Date,y=e.getYear();e.setYear(y+10+(y<1900?1900:0));if(v){v*=100;if(!n){if(!s.c_w(k,x,e))return 0;n=x}if(n%10000>v)return 0}return 1};s.dyasmf=function(t,m){if(t&&m&&m.indexOf(t)>=0)return 1;return 0};s.dyasf=function(t,m){var s=this,i=t?t.indexOf('='):-1,n,x;if(i>=0&&m){var n=t.substring(0,i),x=t.substring(i+1);if(s.pt(x,',','dyasmf',m))return n}return 0};s.uns=function(){var s=this,x=s.dynamicAccountSelection,l=s.dynamicAccountList,m=s.dynamicAccountMatch,n,i;s.un=s.un.toLowerCase();if(x&&l){if(!m)m=s.wd.location.host;if(!m.toLowerCase)m=''+m;l=l.toLowerCase();m=m.toLowerCase();n=s.pt(l,';','dyasf',m);if(n)s.un=n}i=s.un.indexOf(',');s.fun=i<0?s.un:s.un.substring(0,i)};s.sa=function(un){var s=this;if(s.un&&s.mpc('sa',arguments))return;s.un=un;if(!s.oun)s.oun=un;else if((','+s.oun+',').indexOf(','+un+',')<0)s.oun+=','+un;s.uns()};s.m_i=function(n,a){var s=this,m,f=n.substring(0,1),r,l,i;if(!s.m_l)s.m_l=new Object;if(!s.m_nl)s.m_nl=new Array;m=s.m_l[n];if(!a&&m&&m._e&&!m._i)s.m_a(n);if(!m){m=new Object,m._c='s_m';m._in=s.wd.s_c_in;m._il=s._il;m._il[m._in]=m;s.wd.s_c_in++;m.s=s;m._n=n;m._l=new Array('_c','_in','_il','_i','_e','_d','_dl','s','n','_r','_g','_g1','_t','_t1','_x','_x1','_rs','_rr','_l');s.m_l[n]=m;s.m_nl[s.m_nl.length]=n}else if(m._r&&!m._m){r=m._r;r._m=m;l=m._l;for(i=0;i<l.length;i++)if(m[l[i]])r[l[i]]=m[l[i]];r._il[r._in]=r;m=s.m_l[n]=r}if(f==f.toUpperCase())s[n]=m;return m};s.m_a=new Function('n','g','e','if(!g)g=\"m_\"+n;var s=s_c_il['+s._in+'],c=s[g+\"_c\"],m,x,f=0;if(s.mpc(\"m_a\",arguments))return;if(!c)c=s.wd[\"s_\"+g+\"_c\"];if(c&&s_d)s[g]=new Function(\"s\",s_ft(s_d(c)));x=s[g];if(!x)x=s.wd[\\'s_\\'+g];if(!x)x=s.wd[g];m=s.m_i(n,1);if(x&&(!m._i||g!=\"m_\"+n)){m._i=f=1;if((\"\"+x).indexOf(\"function\")>=0)x(s);else s.m_m(\"x\",n,x,e)}m=s.m_i(n,1);if(m._dl)m._dl=m._d=0;s.dlt();return f');s.m_m=function(t,n,d,e){t='_'+t;var s=this,i,x,m,f='_'+t,r=0,u;if(s.m_l&&s.m_nl)for(i=0;i<s.m_nl.length;i++){x=s.m_nl[i];if(!n||x==n){m=s.m_i(x);u=m[t];if(u){if((''+u).indexOf('function')>=0){if(d&&e)u=m[t](d,e);else if(d)u=m[t](d);else u=m[t]()}}if(u)r=1;u=m[t+1];if(u&&!m[f]){if((''+u).indexOf('function')>=0){if(d&&e)u=m[t+1](d,e);else if(d)u=m[t+1](d);else u=m[t+1]()}}m[f]=1;if(u)r=1}}return r};s.m_ll=function(){var s=this,g=s.m_dl,i,o;if(g)for(i=0;i<g.length;i++){o=g[i];if(o)s.loadModule(o.n,o.u,o.d,o.l,o.e,1);g[i]=0}};s.loadModule=function(n,u,d,l,e,ln){var s=this,m=0,i,g,o=0,f1,f2,c=s.h?s.h:s.b,b,tcf;if(n){i=n.indexOf(':');if(i>=0){g=n.substring(i+1);n=n.substring(0,i)}else g=\"m_\"+n;m=s.m_i(n)}if((l||(n&&!s.m_a(n,g)))&&u&&s.d&&c&&s.d.createElement){if(d){m._d=1;m._dl=1}if(ln){if(s.ssl)u=s.rep(u,'http:','https:');i='s_s:'+s._in+':'+n+':'+g;b='var s=s_c_il['+s._in+'],o=s.d.getElementById(\"'+i+'\");if(s&&o){if(!o.l&&s.wd.'+g+'){o.l=1;if(o.i)clearTimeout(o.i);o.i=0;s.m_a(\"'+n+'\",\"'+g+'\"'+(e?',\"'+e+'\"':'')+')}';f2=b+'o.c++;if(!s.maxDelay)s.maxDelay=250;if(!o.l&&o.c<(s.maxDelay*2)/100)o.i=setTimeout(o.f2,100)}';f1=new Function('e',b+'}');tcf=new Function('s','c','i','u','f1','f2','var e,o=0;try{o=s.d.createElement(\"script\");if(o){o.type=\"text/javascript\";'+(n?'o.id=i;o.defer=true;o.onload=o.onreadystatechange=f1;o.f2=f2;o.l=0;':'')+'o.src=u;c.appendChild(o);'+(n?'o.c=0;o.i=setTimeout(f2,100)':'')+'}}catch(e){o=0}return o');o=tcf(s,c,i,u,f1,f2)}else{o=new Object;o.n=n+':'+g;o.u=u;o.d=d;o.l=l;o.e=e;g=s.m_dl;if(!g)g=s.m_dl=new Array;i=0;while(i<g.length&&g[i])i++;g[i]=o}}else if(n){m=s.m_i(n);m._e=1}return m};s.voa=function(vo,r){var s=this,l=s.va_g,i,k,v,x;for(i=0;i<l.length;i++){k=l[i];v=vo[k];if(v||vo['!'+k]){if(!r&&(k==\"contextData\"||k==\"retrieveLightData\")&&s[k])for(x in s[k])if(!v[x])v[x]=s[k][x];s[k]=v}}};s.vob=function(vo){var s=this,l=s.va_g,i,k;for(i=0;i<l.length;i++){k=l[i];vo[k]=s[k];if(!vo[k])vo['!'+k]=1}};s.dlt=new Function('var s=s_c_il['+s._in+'],d=new Date,i,vo,f=0;if(s.dll)for(i=0;i<s.dll.length;i++){vo=s.dll[i];if(vo){if(!s.m_m(\"d\")||d.getTime()-vo._t>=s.maxDelay){s.dll[i]=0;s.t(vo)}else f=1}}if(s.dli)clearTimeout(s.dli);s.dli=0;if(f){if(!s.dli)s.dli=setTimeout(s.dlt,s.maxDelay)}else s.dll=0');s.dl=function(vo){var s=this,d=new Date;if(!vo)vo=new Object;s.vob(vo);vo._t=d.getTime();if(!s.dll)s.dll=new Array;s.dll[s.dll.length]=vo;if(!s.maxDelay)s.maxDelay=250;s.dlt()};s.gfid=function(){var s=this,d='0123456789ABCDEF',k='s_fid',fid=s.c_r(k),h='',l='',i,j,m=8,n=4,e=new Date,y;if(!fid||fid.indexOf('-')<0){for(i=0;i<16;i++){j=Math.floor(Math.random()*m);h+=d.substring(j,j+1);j=Math.floor(Math.random()*n);l+=d.substring(j,j+1);m=n=16}fid=h+'-'+l;}y=e.getYear();e.setYear(y+2+(y<1900?1900:0));if(!s.c_w(k,fid,e))fid=0;return fid};s.applyADMS=function(){var s=this,vb=new Object;if(s.wd.ADMS&&!s.visitorID&&!s.admsc){if(!s.adms)s.adms=ADMS.getDefault();if(!s.admsq){s.visitorID=s.adms.getVisitorID(new Function('v','var s=s_c_il['+s._in+'],l=s.admsq,i;if(v==-1)v=0;if(v)s.visitorID=v;s.admsq=0;if(l){s.admsc=1;for(i=0;i<l.length;i++)s.t(l[i]);s.admsc=0;}'));if(!s.visitorID)s.admsq=new Array}if(s.admsq){s.vob(vb);vb['!visitorID']=0;s.admsq.push(vb);return 1}else{if(s.visitorID==-1)s.visitorID=0}}return 0};s.track=s.t=function(vo){var s=this,trk=1,tm=new Date,sed=Math&&Math.random?Math.floor(Math.random()*10000000000000):tm.getTime(),sess='s'+Math.floor(tm.getTime()/10800000)%10+sed,y=tm.getYear(),vt=tm.getDate()+'/'+tm.getMonth()+'/'+(y<1900?y+1900:y)+' '+tm.getHours()+':'+tm.getMinutes()+':'+tm.getSeconds()+' '+tm.getDay()+' '+tm.getTimezoneOffset(),tcf,tfs=s.gtfs(),ta=-1,q='',qs='',code='',vb=new Object;if(s.mpc('t',arguments))return;s.gl(s.vl_g);s.uns();s.m_ll();if(!s.td){var tl=tfs.location,a,o,i,x='',c='',v='',p='',bw='',bh='',j='1.0',k=s.c_w('s_cc','true',0)?'Y':'N',hp='',ct='',pn=0,ps;if(String&&String.prototype){j='1.1';if(j.match){j='1.2';if(tm.setUTCDate){j='1.3';if(s.isie&&s.ismac&&s.apv>=5)j='1.4';if(pn.toPrecision){j='1.5';a=new Array;if(a.forEach){j='1.6';i=0;o=new Object;tcf=new Function('o','var e,i=0;try{i=new Iterator(o)}catch(e){}return i');i=tcf(o);if(i&&i.next){j='1.7';if(a.reduce){j='1.8';if(j.trim){j='1.8.1';if(Date.parse){j='1.8.2';if(Object.create)j='1.8.5'}}}}}}}}}if(s.apv>=4)x=screen.width+'x'+screen.height;if(s.isns||s.isopera){if(s.apv>=3){v=s.n.javaEnabled()?'Y':'N';if(s.apv>=4){c=screen.pixelDepth;bw=s.wd.innerWidth;bh=s.wd.innerHeight}}s.pl=s.n.plugins}else if(s.isie){if(s.apv>=4){v=s.n.javaEnabled()?'Y':'N';c=screen.colorDepth;if(s.apv>=5){bw=s.d.documentElement.offsetWidth;bh=s.d.documentElement.offsetHeight;if(!s.ismac&&s.b){tcf=new Function('s','tl','var e,hp=0;try{s.b.addBehavior(\"#default#homePage\");hp=s.b.isHomePage(tl)?\"Y\":\"N\"}catch(e){}return hp');hp=tcf(s,tl);tcf=new Function('s','var e,ct=0;try{s.b.addBehavior(\"#default#clientCaps\");ct=s.b.connectionType}catch(e){}return ct');ct=tcf(s)}}}else r=''}if(s.pl)while(pn<s.pl.length&&pn<30){ps=s.fl(s.pl[pn].name,100)+';';if(p.indexOf(ps)<0)p+=ps;pn++}s.resolution=x;s.colorDepth=c;s.javascriptVersion=j;s.javaEnabled=v;s.cookiesEnabled=k;s.browserWidth=bw;s.browserHeight=bh;s.connectionType=ct;s.homepage=hp;s.plugins=p;s.td=1}if(vo){s.vob(vb);s.voa(vo)}s.fid=s.gfid();if(s.applyADMS())return '';if((vo&&vo._t)||!s.m_m('d')){if(s.usePlugins)s.doPlugins(s);if(!s.abort){var l=s.wd.location,r=tfs.document.referrer;if(!s.pageURL)s.pageURL=l.href?l.href:l;if(!s.referrer&&!s._1_referrer){s.referrer=r;s._1_referrer=1}s.m_m('g');if(s.lnk||s.eo){var o=s.eo?s.eo:s.lnk,p=s.pageName,w=1,t=s.ot(o),n=s.oid(o),x=o.s_oidt,h,l,i,oc;if(s.eo&&o==s.eo){while(o&&!n&&t!='BODY'){o=o.parentElement?o.parentElement:o.parentNode;if(o){t=s.ot(o);n=s.oid(o);x=o.s_oidt}}if(!n||t=='BODY')o='';if(o){oc=o.onclick?''+o.onclick:'';if((oc.indexOf('s_gs(')>=0&&oc.indexOf('.s_oc(')<0)||oc.indexOf('.tl(')>=0)o=0}}if(o){if(n)ta=o.target;h=s.oh(o);i=h.indexOf('?');h=s.linkLeaveQueryString||i<0?h:h.substring(0,i);l=s.linkName;t=s.linkType?s.linkType.toLowerCase():s.lt(h);if(t&&(h||l)){s.pe='lnk_'+(t=='d'||t=='e'?t:'o');s.pev1=(h?s.ape(h):'');s.pev2=(l?s.ape(l):'')}else trk=0;if(s.trackInlineStats){if(!p){p=s.pageURL;w=0}t=s.ot(o);i=o.sourceIndex;if(o.dataset&&o.dataset.sObjectId){s.wd.s_objectID=o.dataset.sObjectId;}else if(o.getAttribute&&o.getAttribute('data-s-object-id')){s.wd.s_objectID=o.getAttribute('data-s-object-id');}else if(s.useForcedLinkTracking){s.wd.s_objectID='';oc=o.onclick?''+o.onclick:'';if(oc){var ocb=oc.indexOf('s_objectID'),oce,ocq,ocx;if(ocb>=0){ocb+=10;while(ocb<oc.length&&(\"= \\t\\r\\n\").indexOf(oc.charAt(ocb))>=0)ocb++;if(ocb<oc.length){oce=ocb;ocq=ocx=0;while(oce<oc.length&&(oc.charAt(oce)!=';'||ocq)){if(ocq){if(oc.charAt(oce)==ocq&&!ocx)ocq=0;else if(oc.charAt(oce)==\"\\\\\")ocx=!ocx;else ocx=0;}else{ocq=oc.charAt(oce);if(ocq!='\"'&&ocq!=\"'\")ocq=0}oce++;}oc=oc.substring(ocb,oce);if(oc){o.s_soid=new Function('s','var e;try{s.wd.s_objectID='+oc+'}catch(e){}');o.s_soid(s)}}}}}if(s.gg('objectID')){n=s.gg('objectID');x=1;i=1}if(p&&n&&t)qs='&pid='+s.ape(s.fl(p,255))+(w?'&pidt='+w:'')+'&oid='+s.ape(s.fl(n,100))+(x?'&oidt='+x:'')+'&ot='+s.ape(t)+(i?'&oi='+i:'')}}else trk=0}if(trk||qs){s.sampled=s.vs(sed);if(trk){if(s.sampled)code=s.mr(sess,(vt?'&t='+s.ape(vt):'')+s.hav()+q+(qs?qs:s.rq()),0,ta);qs='';s.m_m('t');if(s.p_r)s.p_r();s.referrer=s.lightProfileID=s.retrieveLightProfiles=s.deleteLightProfiles=''}s.sq(qs)}}}else s.dl(vo);if(vo)s.voa(vb,1);s.abort=0;s.pageURLRest=s.lnk=s.eo=s.linkName=s.linkType=s.wd.s_objectID=s.ppu=s.pe=s.pev1=s.pev2=s.pev3='';if(s.pg)s.wd.s_lnk=s.wd.s_eo=s.wd.s_linkName=s.wd.s_linkType='';return code};s.trackLink=s.tl=function(o,t,n,vo,f){var s=this;s.lnk=o;s.linkType=t;s.linkName=n;if(f){s.bct=o;s.bcf=f}s.t(vo)};s.trackLight=function(p,ss,i,vo){var s=this;s.lightProfileID=p;s.lightStoreForSeconds=ss;s.lightIncrementBy=i;s.t(vo)};s.setTagContainer=function(n){var s=this,l=s.wd.s_c_il,i,t,x,y;s.tcn=n;if(l)for(i=0;i<l.length;i++){t=l[i];if(t&&t._c=='s_l'&&t.tagContainerName==n){s.voa(t);if(t.lmq)for(i=0;i<t.lmq.length;i++){x=t.lmq[i];y='m_'+x.n;if(!s[y]&&!s[y+'_c']){s[y]=t[y];s[y+'_c']=t[y+'_c']}s.loadModule(x.n,x.u,x.d)}if(t.ml)for(x in t.ml)if(s[x]){y=s[x];x=t.ml[x];for(i in x)if(!Object.prototype[i]){if(typeof(x[i])!='function'||(''+x[i]).indexOf('s_c_il')<0)y[i]=x[i]}}if(t.mmq)for(i=0;i<t.mmq.length;i++){x=t.mmq[i];if(s[x.m]){y=s[x.m];if(y[x.f]&&typeof(y[x.f])=='function'){if(x.a)y[x.f].apply(y,x.a);else y[x.f].apply(y)}}}if(t.tq)for(i=0;i<t.tq.length;i++)s.t(t.tq[i]);t.s=s;return}}};s.wd=window;s.ssl=(s.wd.location.protocol.toLowerCase().indexOf('https')>=0);s.d=document;s.b=s.d.body;if(s.d.getElementsByTagName){s.h=s.d.getElementsByTagName('HEAD');if(s.h)s.h=s.h[0]}s.n=navigator;s.u=s.n.userAgent;s.ns6=s.u.indexOf('Netscape6/');var apn=s.n.appName,v=s.n.appVersion,ie=v.indexOf('MSIE '),o=s.u.indexOf('Opera '),i;if(v.indexOf('Opera')>=0||o>0)apn='Opera';s.isie=(apn=='Microsoft Internet Explorer');s.isns=(apn=='Netscape');s.isopera=(apn=='Opera');s.ismac=(s.u.indexOf('Mac')>=0);if(o>0)s.apv=parseFloat(s.u.substring(o+6));else if(ie>0){s.apv=parseInt(i=v.substring(ie+5));if(s.apv>3)s.apv=parseFloat(i)}else if(s.ns6>0)s.apv=parseFloat(s.u.substring(s.ns6+10));else s.apv=parseFloat(v);s.em=0;if(s.em.toPrecision)s.em=3;else if(String.fromCharCode){i=escape(String.fromCharCode(256)).toUpperCase();s.em=(i=='%C4%80'?2:(i=='%U0100'?1:0))}if(s.oun)s.sa(s.oun);s.sa(un);s.vl_l='timestamp,dynamicVariablePrefix,visitorID,fid,vmk,visitorMigrationKey,visitorMigrationServer,visitorMigrationServerSecure,ppu,charSet,visitorNamespace,cookieDomainPeriods,cookieLifetime,pageName,pageURL,referrer,contextData,currencyCode,lightProfileID,lightStoreForSeconds,lightIncrementBy,retrieveLightProfiles,deleteLightProfiles,retrieveLightData';s.va_l=s.sp(s.vl_l,',');s.vl_mr=s.vl_m='timestamp,charSet,visitorNamespace,cookieDomainPeriods,cookieLifetime,contextData,lightProfileID,lightStoreForSeconds,lightIncrementBy';s.vl_t=s.vl_l+',variableProvider,channel,server,pageType,transactionID,purchaseID,campaign,state,zip,events,events2,products,linkName,linkType';var n;for(n=1;n<=75;n++){s.vl_t+=',prop'+n+',eVar'+n;s.vl_m+=',prop'+n+',eVar'+n}for(n=1;n<=5;n++)s.vl_t+=',hier'+n;for(n=1;n<=3;n++)s.vl_t+=',list'+n;s.va_m=s.sp(s.vl_m,',');s.vl_l2=',tnt,pe,pev1,pev2,pev3,resolution,colorDepth,javascriptVersion,javaEnabled,cookiesEnabled,browserWidth,browserHeight,connectionType,homepage,pageURLRest,plugins';s.vl_t+=s.vl_l2;s.va_t=s.sp(s.vl_t,',');s.vl_g=s.vl_t+',trackingServer,trackingServerSecure,trackingServerBase,fpCookieDomainPeriods,disableBufferedRequests,mobile,visitorSampling,visitorSamplingGroup,dynamicAccountSelection,dynamicAccountList,dynamicAccountMatch,trackDownloadLinks,trackExternalLinks,trackInlineStats,linkLeaveQueryString,linkDownloadFileTypes,linkExternalFilters,linkInternalFilters,linkTrackVars,linkTrackEvents,linkNames,lnk,eo,lightTrackVars,_1_referrer,un';s.va_g=s.sp(s.vl_g,',');s.pg=pg;s.gl(s.vl_g);s.contextData=new Object;s.retrieveLightData=new Object;if(!ss)s.wds();if(pg){s.wd.s_co=function(o){return o};s.wd.s_gs=function(un){s_gi(un,1,1).t()};s.wd.s_dc=function(un){s_gi(un,1).t()}}",l=window,d=l.s_c_il,m=navigator,u=m.userAgent,f=m.appVersion,p=f.indexOf("MSIE "),h=u.indexOf("Netscape6/");if(e&&(e=e.toLowerCase(),d))for(s=0;2>s;s++)for(i=0;i<d.length;i++)if(r=d[i],a=r._c,(!a||"s_c"==a||s>0&&"s_l"==a)&&(r.oun==e||r.fs&&r.sa&&r.fs(r.oun,e))){if(r.sa&&r.sa(e),"s_c"==a)return r}else r=0;return l.s_an="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",l.s_sp=new Function("x","d","var a=new Array,i=0,j;if(x){if(x.split)a=x.split(d);else if(!d)for(i=0;i<x.length;i++)a[a.length]=x.substring(i,i+1);else while(i>=0){j=x.indexOf(d,i);a[a.length]=x.substring(i,j<0?x.length:j);i=j;if(i>=0)i+=d.length}}return a"),l.s_jn=new Function("a","d","var x='',i,j=a.length;if(a&&j>0){x=a[0];if(j>1){if(a.join)x=a.join(d);else for(i=1;i<j;i++)x+=d+a[i]}}return x"),l.s_rep=new Function("x","o","n","return s_jn(s_sp(x,o),n)"),l.s_d=new Function("x","var t='`^@$#',l=s_an,l2=new Object,x2,d,b=0,k,i=x.lastIndexOf('~~'),j,v,w;if(i>0){d=x.substring(0,i);x=x.substring(i+2);l=s_sp(l,'');for(i=0;i<62;i++)l2[l[i]]=i;t=s_sp(t,'');d=s_sp(d,'~');i=0;while(i<5){v=0;if(x.indexOf(t[i])>=0) {x2=s_sp(x,t[i]);for(j=1;j<x2.length;j++){k=x2[j].substring(0,1);w=t[i]+k;if(k!=' '){v=1;w=d[b+l2[k]]}x2[j]=w+x2[j].substring(1)}}if(v)x=s_jn(x2,'');else{w=t[i]+' ';if(x.indexOf(w)>=0)x=s_rep(x,w,t[i]);i++;b+=62}}}return x"),l.s_fe=new Function("c","return s_rep(s_rep(s_rep(c,'\\\\','\\\\\\\\'),'\"','\\\\\"'),\"\\n\",\"\\\\n\")"),l.s_fa=new Function("f","var s=f.indexOf('(')+1,e=f.indexOf(')'),a='',c;while(s>=0&&s<e){c=f.substring(s,s+1);if(c==',')a+='\",\"';else if((\"\\n\\r\\t \").indexOf(c)<0)a+=c;s++}return a?'\"'+a+'\"':a"),l.s_ft=new Function("c","c+='';var s,e,o,a,d,q,f,h,x;s=c.indexOf('=function(');while(s>=0){s++;d=1;q='';x=0;f=c.substring(s);a=s_fa(f);e=o=c.indexOf('{',s);e++;while(d>0){h=c.substring(e,e+1);if(q){if(h==q&&!x)q='';if(h=='\\\\')x=x?0:1;else x=0}else{if(h=='\"'||h==\"'\")q=h;if(h=='{')d++;if(h=='}')d--}if(d>0)e++}c=c.substring(0,s)+'new Function('+(a?a+',':'')+'\"'+s_fe(c.substring(o+1,e))+'\")'+c.substring(e+1);s=c.indexOf('=function(')}return c;"),c=s_d(c),p>0?(o=parseInt(i=f.substring(p+5)),o>3&&(o=parseFloat(i))):o=parseFloat(h>0?u.substring(h+10):f),(5>o||f.indexOf("Opera")>=0||u.indexOf("Opera")>=0)&&(c=s_ft(c)),r||(r=new Object,l.s_c_in||(l.s_c_il=new Array,l.s_c_in=0),r._il=l.s_c_il,r._in=l.s_c_in,r._il[r._in]=r,l.s_c_in++),r._c="s_c",new Function("s","un","pg","ss",c)(r,e,t,n),r
}function s_giqf(){var e,t,n,o=window,i=o.s_giq;if(i)for(e=0;e<i.length;e++)t=i[e],n=s_gi(t.oun),n.sa(t.un),n.setTagContainer(t.tagContainerName);o.s_giq=0}define("common/modules/ui/fonts",["qwery","bonzo","common/utils/ajax","common/utils/mediator","common/utils/storage"],function(e,t,n,o,i){function s(s,a){function r(e){var t=e.getAttribute("data-cache-file-woff").match(/fonts\/([^/]*?)\/?([^/]*)\.woff.json$/);return t.shift(),t}function c(e){if(i.local.isAvailable()){var n=r(e),o=i.local.get(d+n[1]+"."+n[0]);i.local.remove("gu.fonts.17c5ce231fe8d2e6b2d4f6e429fa8d72.WebAgateSans"),i.local.remove("gu.fonts.d46b85fe29c76aa14f620a5e67b1d720.WebHeadlineSans"),i.local.remove("gu.fonts.085af4a5fff2c8f22c02bdcd86104251.WebEgyptian"),i.local.remove("gu.fonts.bcb2f9b361c905a71d2894f46b51ce4c.WebTextSans");var s=!0,a=e.getAttribute("data-min-width");a&&parseInt(a,10)>=window.innerWidth&&(s=!1);var c=void 0!==t(e).data("advertisement-feature")?l():!0;return null===o&&s&&c}return!1}function l(){return e(".facia-container--advertisement-feature").length>0}var d="gu.fonts.";this.ajax=n,this.view={showFont:function(e,t){e.innerHTML=t.css}},this.loadFromServer=function(e,t){e=e||"";for(var n=0,l=s.length;l>n;++n){var m=s[n];if(c(m)){var u=this;this.ajax({url:e+m.getAttribute("data-cache-file-"+a),type:"jsonp",jsonpCallbackName:"guFont",success:function(e){return function(n){if(!n)return void o.emit("module:error","Failed to load fonts","fonts.js");"function"==typeof t&&t(e,n);var s=r(e);u.clearFont(s[0]),i.local.set(d+s[1]+"."+s[0],n.css),o.emit("modules:fonts:loaded",[n.name])}}(m)})}else o.emit("modules:fonts:notloaded",[])}},this.loadFromServerAndApply=function(e){var t=this;this.loadFromServer(e,function(e,n){t.view.showFont(e,n)})},this.clearFont=function(e){i.local.clearByPrefix(d+e)},this.clearAllFontsFromStorage=function(){i.local.clearByPrefix(d)}}return s}),define("common/modules/discussion/api",["common/utils/ajax","common/utils/cookies"],function(e,t){var n={root:null,clientHeader:null};return n.init=function(e){n.root="https:"===document.location.protocol?e.page.secureDiscussionApiRoot:e.page.discussionApiRoot,n.clientHeader=e.page.discussionApiClientHeader},n.send=function(o,i,s){s=s||{},t.get("GU_U")&&(s.GU_U=t.get("GU_U"));var a=e({url:n.root+o,type:"get"===i?"jsonp":"json",method:i,crossOrigin:!0,data:s,headers:{"D2-X-UID":"zHoBy6HNKsk","GU-Client":n.clientHeader}});return a},n.postComment=function(e,t){var o="/discussion/"+e+"/comment"+(t.replyTo?"/"+t.replyTo.commentId+"/reply":"");return n.send(o,"post",t)},n.previewComment=function(e){var t="/comment/preview";return n.send(t,"post",e)},n.recommendComment=function(e){var t="/comment/"+e+"/recommend";return n.send(t,"post")},n.pickComment=function(e){var t="/comment/"+e+"/highlight";return n.send(t,"post")},n.unPickComment=function(e){var t="/comment/"+e+"/unhighlight";return n.send(t,"post")},n.reportComment=function(e,t){var o="/comment/"+e+"/reportAbuse";return n.send(o,"post",t)},n.getUser=function(e){var t="/profile/"+(e?e:"me");return n.send(t,"get")},n}),define("enhancer",["require"],function(e){function t(t,n,o,i){var s,a=t.getAttribute("data-interactive"),r=t;s=/^https?:\/\//.test(a)?a:o.page.interactiveUrl+a+"/boot.js",e([s],function(e){e.boot(r,n,o,i)})}return{render:t}}),define("common/modules/onward/popular",["common/modules/lazyload","common/utils/mediator"],function(e,t){function n(n,o,i,s,a){t.emit("register:begin","popular-in-section"),a=a||".js-popular";var r=o.querySelector(a);if(r){var c=n.page&&n.page.section&&"global"!==n.page.section,l=i?"/expandable":"";s=s||"/most-read"+l+(c?"/"+n.page.section:""),new e({url:s+".json",container:r,success:function(){t.emit("modules:popular:loaded",r),t.emit("fragment:ready:images",r),t.emit("register:end","popular-in-section")},error:function(e){t.emit("module:error","Failed to load most read: "+e.statusText,"common/modules/popular.js"),t.emit("register:error","popular-in-section")}}).load()}}return n});var ImagerOptions,ImagerStrategyOptions;Imager.prototype.process=function(e){var t=this.nodes.length,n=this,o=n.strategy;if(!n._processing){for(n._processing=!0;t--;)o.requiresPlaceholder(n.nodes[t])&&(n.nodes[t]=o.createPlaceholder(n.nodes[t]));return this.nextTick(function(){n.updateImagesSource(),n._processing=!1,(e||function(){}).call(n)}),n}},Imager.prototype.update=function(e){this.nodes=[].slice.call(e||[])},Imager.prototype.updateImagesSource=function(){for(var e=this.nodes.length,t=this,n=t.strategy;e--;)n.updatePlaceholderUri(this.nodes[e],Imager.replaceUri(this.nodes[e].getAttribute("data-src"),{width:t.getBestWidth(this.nodes[e].clientWidth,this.nodes[e].getAttribute("data-width"))}))},Imager.prototype.getBestWidth=function(e,t){for(var n=t||this.availableWidths[0],o=this.availableWidths.length;o--;)if(e<=this.availableWidths[o])return this.availableWidths[o];return n},Imager.prototype.nextTick=function(e){0===this.replacementDelay?e():setTimeout(e,this.replacementDelay)},Imager.init=function(e,t){return new Imager(e,t).process()},Imager.replaceUri=function(e,t){var n=[];for(var o in t)n.push(o);return e.replace(new RegExp("{("+n.join("|")+")}","g"),function(e,n){return t[n]||""})},Imager.strategies={},define("components/imager.js/imager",function(){}),function(e){function t(e){e=e||{},this.matchingClassName=e.matchingClassName||"responsive-img",this.element=e.element||document.createElement("img"),this.element.src=e.src||"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=",this.element.className+=" "+this.matchingClassName}t._id="container",t.prototype.applyOnPlaceholder=function(e,t){for(var n=e.children.length;n--;)if(e.children[n].className.match(new RegExp("(^| )"+this.matchingClassName+"( |$)")))return t&&t(e.children[n],e),!0;return!1},t.prototype.createPlaceholder=function(e){var t=this.element.cloneNode();return e.hasAttribute("data-width")&&(t.width=e.getAttribute("data-width")),t.className=this.matchingClassName,e.appendChild(t),e},t.prototype.requiresPlaceholder=function(e){return e.hasAttribute("data-src")&&this.applyOnPlaceholder(e)===!1},t.prototype.updatePlaceholderUri=function(e,t){this.applyOnPlaceholder(e,function(e){e.src=t})},e[t._id]=t}(Imager.strategies),define("imager",["components/imager.js/imager"],function(e){return function(){var t;return t||e.Imager}}(this)),define("common/modules/ui/images",["common/utils/$","bonzo","common/utils/mediator","imager"],function(e,t,n,o){var i={upgrade:function(n){n=n||document;var i={availableWidths:[140,220,300,460,620,700,860,940,1430,1920],strategy:"container",replacementDelay:0},s=e(".js-image-upgrade",n).map(function(e){return e},function(e){return"none"!==t(e).css("display")});o.init(s,i),s.forEach(function(n){e("img",n).each(function(e){var n=t(e);null===n.attr("alt")&&n.attr("alt","")})})},listen:function(){n.addListeners({"window:resize":function(){i.upgrade()},"window:orientationchange":function(){i.upgrade()},"ui:images:upgrade":function(){i.upgrade()}})}};return i}),define("common/modules/onward/socially-referred-burners",["common/modules/ui/images","common/utils/mediator","lodash/objects/assign","common/modules/component"],function(e,t,n,o){function i(e,o){t.emit("register:begin","social-content"),this.config=n(this.config,e),this.context=o,this.endpoint="/most-referred.json"}return o.define(i),i.prototype.init=function(){this.fetch(this.context,"html")},i.prototype.ready=function(){e.upgrade(this.context),t.emit("register:end","social-content")},i.prototype.error=function(){t.emit("modules:error","Failed to load social burner content on page: "+this.config.page.pageId+"common/modules/onwards/related.js"),t.emit("register:error","social-content")},i}),define("common/modules/onward/most-popular-factory",["common/utils/context","qwery","common/modules/onward/popular","common/modules/onward/socially-referred-burners"],function(e,t,n,o){function i(t){this.config=t,this.context=e(),this.renderComponent()}return i.showReferredContent=!1,i.setShowReferred=function(){i.showReferredContent=!0},i.prototype.renderComponent=function(){i.showReferredContent?new o(this.config,t(".js-referred",this.context)).init():n(this.config,this.context)},i}),define("common/modules/ui/expandable",["common/utils/$","bean","bonzo"],function(e,t,n){var o=function(o){var i=o||{},s=e(i.dom),a=i.expanded===!1?!1:!0,r=document.createElement("button"),c=i.showCount===!1?!1:!0,l={updateCallToAction:function(){var e="Show ";c&&(e+=d.getCount()+" "),e+=a?"fewer":"more",r.innerHTML=e,r.setAttribute("data-link-name","Show "+(a?"more":"fewer")),r.setAttribute("data-is-ajax","1")},renderState:function(){a?s.removeClass("shut"):s.addClass("shut")},renderCallToAction:function(){t.add(r,"click",function(){d.toggleExpanded()}),r.className="cta",i.buttonAfterEl?n(i.buttonAfterEl).after(r):s[0].appendChild(r),l.updateCallToAction()},scrollToCallToAction:function(){a||window.setTimeout(function(){r.scrollIntoView()},550)}},d={toggleExpanded:function(){a=a?!1:!0,l.renderState(),l.updateCallToAction()},getCount:function(){return parseInt(s.attr("data-count"),10)},isOpen:function(){return s.hasClass("shut")?!1:!0}};return{init:function(){return s.hasClass("expandable-initialised")||!s.html()||d.getCount()<3?!1:(s.addClass("expandable-initialised"),l.renderCallToAction(),void l.renderState())},toggle:d.toggleExpanded}};return o}),define("common/modules/onward/history",["lodash/objects/assign","lodash/collections/map","lodash/collections/sortBy","lodash/collections/filter","common/utils/storage"],function(e,t,n,o,i){var s=function(t){return this.id=t.id,this.timestamp=Date.now(),e(this,t.meta),this},a=function(t){return this.config=e(this.DEFAULTS,t),this};return a.prototype.DEFAULTS={storageKey:"gu.history",maxSize:100},a.prototype.set=function(e){return i.local.set(this.config.storageKey,e)},a.prototype.get=function(){var e=i.local.get(this.config.storageKey);return null===e?[]:e},a.prototype.getSize=function(){return this.get().length},a.prototype.contains=function(e){return this.get().some(function(t){return t.id===e})},a.prototype.capToSize=function(e){var t=this.get();return t.length>e&&(t.length=e),t},a.prototype.log=function(e){var t=this.capToSize(this.config.maxSize-1),n=new s(e);t.unshift(n),this.set(t)},a.prototype.recentVisits=function(){var e=n(this.get(),"timestamp").reverse(),t=0,o=[],i=new Date(Date.now());return i.setMonth(i.getMonth()-1),e.map(function(e){function n(){var n=parseInt(t,10)-parseInt(e.timestamp,10);return Math.ceil(n/1e3/60)}n()>=30&&o.push(e.timestamp),t=e.timestamp}),o},a.prototype.numberOfSessionsSince=function(e){var t=e.getTime(),n=this.recentVisits(),i=o(n,function(e){return parseInt(e,10)>t});return i.length},a}),define("common/modules/analytics/mvt-cookie",["common/utils/cookies"],function(e){function t(){if(!i()||i()>d){var t=a(d,1);e.add(r,t,365)}e.cleanUp(["GU_mvtid"])}function n(t){e.add(r,t,365)}function o(){var t=e.get(l),n=i(),o=e.get(c);return o||(o="unknown-visitor-id"),t||(t="unknown-browser-id"),n||(n="unknown-mvt-id"),o+" "+t+" "+n}function i(){return e.get(r)}function s(){return d}function a(e,t){return Math.floor(Math.random()*(t-e+1)+e)}var r="GU_mvt_id",c="s_vi",l="bwid",d=1e6;return{generateMvtCookie:t,getMvtFullId:o,getMvtValue:i,getMvtNumValues:s,overwriteMvtCookie:n,MAX_INT:d}}),define("common/modules/experiments/ab",["common/utils/storage","common/utils/mediator","common/modules/analytics/mvt-cookie"],function(e,t,n){function o(){return e.local.get(y)||{}}function i(e){var t=o();return t[e.id]}function s(t,n){var i=o();i[t.id]={variant:n},e.local.set(y,i)}function a(t){var n=o();delete n[t.id],e.local.set(y,n)}function r(e){var t=o();Object.keys(t).forEach(function(t){if("undefined"==typeof e.switches["ab"+t])a({id:t});else{var n=v.some(function(e){return e.id===t});n||a({id:t})}})}function c(){return v.filter(function(e){var t=new Date-new Date(e.expiry)>0;return t?(a(e),!1):!0})}function l(){return v.filter(function(e){return new Date-new Date(e.expiry)>0})}function d(e,t){var n=new Date-new Date(e.expiry)>0;return e.canRun(t)&&!n&&h(e,t)}function m(e){var t=v.filter(function(t){return t.id===e});return t?t[0]:""}function u(e){var t=o(),n=[];return Object.keys(t).forEach(function(o){d(m(o),e)&&n.push(["AB",o,t[o].variant].join(" | "))}),n.join(",")}function f(e,t,n){if(i(e)&&d(e,t)){var s=o(),a=s[e.id].variant;e.variants.some(function(e){return e.id===a?(e.test(n,t),!0):void 0}),"notintest"===a&&e.notInTest&&e.notInTest()}}function p(e,t){if(d(e,t)&&!i(e)){var o=n.getMvtNumValues()*e.audienceOffset,a=o+n.getMvtNumValues()*e.audience,r=n.getMvtValue();if(r>=o&&a>r){var c=e.variants.map(function(e){return e.id}),l=r%c.length;s(e,c[l])}else s(e,"notintest")}}function h(e,t){return t.switches["ab"+e.id]}function g(e){var t=o()[e];return t&&t.variant}var v=[],y="gu.ab.participations",b={addTest:function(e){v.push(e)},clearTests:function(){v=[]},segment:function(e){c().forEach(function(t){p(t,e)})},forceSegment:function(e,t){c().filter(function(t){return t.id===e}).forEach(function(e){s(e,t)})},segmentUser:function(e){n.generateMvtCookie();var t=/^#ab/.test(window.location.hash);if(t){var o=window.location.hash.replace("#ab-","").split("="),i=o[0],s=o[1];b.forceSegment(i,s)}else b.segment(e);r(e)},run:function(e,t){c().forEach(function(n){f(n,e,t)})},isEventApplicableToAnActiveTest:function(e){var t=Object.keys(o());return t.some(function(t){var n=m(t).events;return n.some(function(t){return 0===e.indexOf(t)})})},getActiveTestsEventIsApplicableTo:function(e){function t(e,t){return 0===e.indexOf(t)}var n=e.tag;return n&&c().filter(function(e){var o=e.events;return o&&o.some(function(e){return t(n,e)})}).map(function(e){return e.id})},getAbLoggableObject:function(e){var n={};try{c().forEach(function(t){if(i(t)&&d(t,e)){var o=g(t.id);o&&"notintest"!==o&&(n["ab"+t.id]=o)}})}catch(o){n={},t.emit("module:error",o,"common/modules/experiments/ab.js",267)}return n},getParticipations:o,makeOmnitureTag:u,getExpiredTests:l,getActiveTests:c,getTestVariant:g};return b}),define("lodash/collections/where",["./filter"],function(e){var t=e;return t}),define("common/modules/analytics/register",["common/utils/deferToLoad","common/utils/mediator","common/modules/experiments/ab","lodash/collections/where"],function(e,t,n,o){function i(e){l.push({name:e,status:"unfinished"})}function s(e){o(l,{name:e}).forEach(function(e){e.status="completed",e.endTime=Date.now()-d+"ms"})}function a(e){o(l,{name:e}).forEach(function(e){e.status="failed",e.endTime=Date.now()-d+"ms"})}function r(e){require("ophan/ng",function(t){t.record({register:l,abTestRegister:n.getAbLoggableObject(e)})})}function c(n){t.on("register:begin",i),t.on("register:end",s),t.on("register:error",a),e(function(){window.setTimeout(r.bind(n),5e3)})}var l=[],d=Date.now();return{initialise:c,begin:i,end:s,error:a}}),define("lodash/arrays/intersection",["../internals/baseIndexOf","../internals/cacheIndexOf","../internals/createCache","../internals/getArray","../objects/isArguments","../objects/isArray","../internals/largeArraySize","../internals/releaseArray","../internals/releaseObject"],function(e,t,n,o,i,s,a,r,c){function l(){for(var l=[],d=-1,m=arguments.length,u=o(),f=e,p=f===e,h=o();++d<m;){var g=arguments[d];(s(g)||i(g))&&(l.push(g),u.push(p&&g.length>=a&&n(d?l[d]:h)))}var v=l[0],y=-1,b=v?v.length:0,w=[];e:for(;++y<b;){var _=u[0];if(g=v[y],(_?t(_,g):f(h,g))<0){for(d=m,(_||h).push(g);--d;)if(_=u[d],(_?t(_,g):f(l[d],g))<0)continue e;w.push(g)}}for(;m--;)_=u[m],_&&c(_);return r(u),r(h),w}return l}),define("common/modules/onward/related",["common/utils/mediator","common/modules/lazyload","common/modules/ui/expandable","common/modules/ui/images","common/modules/onward/history","qwery","bonzo","common/utils/$","common/modules/analytics/register","lodash/arrays/intersection"],function(e,t,n,o,i,s,a,r,c,l){function d(){}return d.overrideUrl="",d.setOverrideUrl=function(e){d.overrideUrl=e},d.prototype.popularInTagOverride=function(e){if(e.page.keywordIds){var t=["sport/cricket","sport/rugby-union","sport/rugbyleague","sport/formulaone","sport/tennis","sport/cycling","sport/motorsports","sport/golf","sport/horse-racing","sport/boxing","sport/us-sport","sport/australia-sport","football/championsleague","football/premierleague","football/championship","football/europeanfootball","football/world-cup-2014","football/manchester-united","football/chelsea","football/arsenal","football/manchestercity","football/tottenham-hotspur","football/liverpool"],n=e.page.keywordIds.split(","),o=l(t,n);return o.length>0?"/popular-in-tag/"+o[0]+".json":void 0}},d.prototype.renderRelatedComponent=function(i,s){var a;if(i.page&&i.page.hasStoryPackage&&!d.overrideUrl)new n({dom:s.querySelector(".related-trails"),expanded:!1,showCount:!1}).init(),e.emit("modules:related:loaded",i,s);else if(i.switches&&i.switches.relatedContent&&i.page.showRelatedContent&&(a=s.querySelector(".js-related"))){var l=this.popularInTagOverride(i),m=!d.overrideUrl&&l?"related-popular-in-tag":"related-content";c.begin(m),a.setAttribute("data-component",m),new t({url:d.overrideUrl||l||"/related/"+i.page.pageId+".json",container:a,success:function(){d.overrideUrl&&i.page.hasStoryPackage&&r(".more-on-this-story").addClass("u-h");var t=a.querySelector(".related-trails");new n({dom:t,expanded:!1,showCount:!1}).init(),o.upgrade(t),e.emit("modules:related:loaded",i,s),c.end(m)},error:function(t){e.emit("module:error","Failed to load related: "+t.statusText,"common/modules/related.js"),c.error(m)}}).load()}},d}),define("common/modules/onward/onward-content",["common/utils/mediator","common/modules/analytics/register","common/modules/ui/images","common/modules/component"],function(e,t,n,o){function i(e,n){t.begin("series-content"),this.config=e,this.context=n,this.endpoint="/series/"+this.config.page.seriesId+".json?shortUrl="+encodeURIComponent(this.config.page.shortUrl)+"&series="+encodeURIComponent(this.config.page.series),this.fetch(this.context,"html")}return o.define(i),i.prototype.ready=function(){n.upgrade(this.context),t.end("series-content")},i.prototype.error=function(){e.emit("module:error","Failed to load series:"+this.config.page.series+"common/modules/related.js"),t.error("series-content")},i}),define("common/modules/navigation/profile",["lodash/objects/assign","common/utils/mediator","common/utils/ajax","bonzo","bean","common/utils/detect","common/modules/identity/api"],function(e,t,n,o,i,s,a){function r(t,n){this.context=t,this.config=e(this.config,n),this.dom.container=t.querySelector("."+r.CONFIG.classes.container),this.dom.content=this.dom.container.querySelector("."+r.CONFIG.classes.content),this.dom.popup=t.querySelector("."+r.CONFIG.classes.popup)}return r.CONFIG={eventName:"modules:profilenav",classes:{container:"js-profile-nav",content:"js-profile-info",popup:"js-profile-nav-popup"}},r.prototype.config={url:"https://profile.theguardian.com"},r.prototype.dom={},r.prototype.context=null,r.prototype.init=function(){this.setFragmentFromCookie()},r.prototype.setFragmentFromCookie=function(){var e=a.getUserFromCookie(),t=o(this.dom.container),n=o(this.dom.content),i=o(this.dom.popup);t.removeClass("js-hidden"),e?(n.text(e.displayName),t.addClass("is-signed-in"),i.html('<ul class="nav nav--columns" data-link-name="Sub Sections">'+this.menuListItem("Comment activity",this.config.url+"/user/id/"+e.id)+this.menuListItem("Edit profile",this.config.url+"/public/edit")+this.menuListItem("Email preferences",this.config.url+"/email-prefs")+this.menuListItem("Change password",this.config.url+"/password/change")+this.menuListItem("Sign out",this.config.url+"/signout")+"</ul>")):i.remove(),this.emitLoadedEvent(e)},r.prototype.menuListItem=function(e,t){return'<li class="nav__item"><a href="'+t+'" class="nav__link" data-link-name="'+e+'">'+e+"</a></li>"},r.prototype.emitLoadedEvent=function(e){t.emit(r.CONFIG.eventName+":loaded",e)},r.prototype.emitErrorEvent=function(){t.emit(r.CONFIG.eventName+":error")},r}),define("common/modules/navigation/sections",["common/utils/$","bonzo","common/utils/mediator","common/utils/detect"],function(e,t,n,o){function i(){var i="is-off",s=this,a=o.hasCrossedBreakpoint(),r={};this.view={bindings:function(c){var l=c.id;if(!r[l]){r[l]=!0;var d=c.querySelector(".nav-popup--sections"),m=c.querySelector(".nav--global");d&&m&&(n.addListener("window:resize",function(){a(function(n){t(d).addClass(i),"mobile"!==n?(s.view.hideColumns(d,m),e(".nav-popup--localnav").addClass("is-off")):s.view.showColumns(d,m)})}),"mobile"!==o.getBreakpoint()&&s.view.hideColumns(d,m))}},showColumns:function(t){e(".nav__item",t).removeClass("u-h")},hideColumns:function(n,o){var i,s=[],a=e(".nav__item",n).removeClass("u-h");e(".nav__item",o).each(function(e){i=i||t(e).offset().top,t(e).offset().top===i&&s.push(e)});for(var r=0,c=s.length;c>r;r++)t(a[r]).addClass("u-h")}},this.init=function(e){this.view.bindings(e)}}return i}),define("lodash/functions/throttle",["./debounce","../objects/isFunction","../objects/isObject"],function(e,t,n){function o(o,s,a){var r=!0,c=!0;if(!t(o))throw new TypeError;return a===!1?r=!1:n(a)&&(r="leading"in a?a.leading:r,c="trailing"in a?a.trailing:c),i.leading=r,i.maxWait=s,i.trailing=c,e(o,s,i)}var i={leading:!1,maxWait:0,trailing:!1};return o}),define("common/modules/navigation/search",["common/utils/$","lodash/functions/throttle","bean"],function(e,t,n){var o=function(o){var i,s,a,r,c=this;if(o.switches.googleSearch&&o.page.googleSearchUrl&&o.page.googleSearchId){i=!0,s=o.page.googleSearchUrl+"?cx="+o.page.googleSearchId;var l=t(function(){c.load()});n.on(document,"click touchstart",".js-search-toggle",function(e){l(),c.focusSearchField(),e.preventDefault()}),n.on(document,"click touchstart",".search-results",function(e){var t=e.target;"a"===t.nodeName.toLowerCase()&&(t.target="_self")})}this.focusSearchField=function(){var t=e("input.gsc-input");t.length>0&&t.focus()},this.load=function(){var e,t;r=a.querySelector(".js-search-placeholder"),window.__gcse={callback:c.focusSearchField},Array.prototype.forEach.call(document.querySelectorAll(".js-search-placeholder"),function(e){e!==r&&(e.innerHTML="")}),r.innerHTML||(r.innerHTML='<div class="search-box" role="search"><gcse:searchbox></gcse:searchbox></div><div class="search-results" data-link-name="search"><gcse:searchresults></gcse:searchresults></div>',e=document.createElement("script"),e.async=!0,e.src=s,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t))},this.init=function(e){i&&(a=e)}};return o}),define("common/modules/navigation/servicesNav",["qwery","bean","common/utils/$"],function(e,t,n){var o={init:function(){this.enableNavToggle()},enableNavToggle:function(){e(".js-services-nav-toggle").forEach(function(o){t.on(o,"click touchstart",function(t){t.preventDefault(),e(".guardian-services__item-more--expanded").length>0?n(".guardian-services__item-more--expanded").removeClass("guardian-services__item-more--expanded").addClass("guardian-services__item-more--collapsed"):n(".guardian-services__item-more--collapsed").removeClass("guardian-services__item-more--collapsed").addClass("guardian-services__item-more--expanded")})})}};return o}),define("common/modules/navigation/newNavigation",["qwery","bean","common/utils/$"],function(e,t,n){var o={init:function(){this.addMegaNavMenu(),this.enableMegaNavToggle()},addMegaNavMenu:function(){var e=n(".js-transfuse"),t=n("."+e.attr("data-transfuse-target"));t.html(e.html())},enableMegaNavToggle:function(){e(".js-new-navigation-toggle").forEach(function(o){t.on(o,"click touchstart",function(t){t.preventDefault(),e(".new-navigation--expanded").length>0?n(".new-navigation").removeClass("new-navigation--expanded").addClass("new-navigation--collapsed"):n(".new-navigation").addClass("new-navigation--expanded").removeClass("new-navigation--collapsed")})})}};return o}),define("common/modules/ui/toggles",["bean","bonzo"],function(e,t){var n=function(){var n,o=this,i="js-toggle-ready";this.init=function(s){n=s.querySelectorAll("[data-toggle]"),Array.prototype.forEach.call(n,function(a){if(!t(a).hasClass(i)){var r=o.getTarget(a,s);r&&(a.toggleTarget=r,t(a).addClass(i),e.add(a,"click touchstart",function(e){e.preventDefault(),o.toggle(a,n)}))}})},this.reset=function(){Array.prototype.forEach.call(n,o.close)}};return n.prototype.toggle=function(e,n){var o=this;Array.prototype.forEach.call(n,function(n){n===e?o[t(n).hasClass("is-active")?"close":"open"](n):o.close(n)})},n.prototype.getTarget=function(e,n){var o=t(e).data("toggle");return o?n.querySelector("."+o):void 0},n.prototype.open=function(e){t(e).addClass("is-active"),t(e.toggleTarget).removeClass("is-off")},n.prototype.close=function(e){t(e).removeClass("is-active"),t(e.toggleTarget).addClass("is-off")},n}),define("common/modules/ui/dropdowns",["common/utils/$","bonzo","bean","common/utils/context"],function(e,t,n,o){function i(){function i(e,n){return!e.parentNode||t(e.parentNode).hasClass(n.substring(1))?e.parentNode:void i(e.parentNode,n)}o=o(),n.on(o,"click",s.button,function(n){t(i(n.currentTarget,s.container)).toggleClass("dropdown--active").each(function(n){var o=t(n).hasClass("dropdown--active");e(s.content,n).attr("aria-hidden",!o),e(s.content,n).attr("aria-expanded",o)})})}var s={container:".dropdown",button:".dropdown__button",content:".dropdown__content"};return{init:i}}),define("common/modules/ui/relativedates",["common/utils/$","common/utils/mediator","bonzo"],function(e,t,n){function o(e){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]}function i(e){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e]}function s(e){return 10>e?"0"+e:e}function a(e){return 12>e?"am":"pm"}function r(e){return e>12?e-12:e}function c(e){var t=new Date;return e.toDateString()===t.toDateString()}function l(e){var t=new Date;return e.valueOf()>t.valueOf()-864e5}function d(e){var t=new Date,n=new Date;return n.setDate(t.getDate()-1),e.toDateString()===n.toDateString()}function m(e){var t=(new Date).valueOf()-6048e5;return e.valueOf()>=t}function u(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:!isNaN(e.getTime())}function f(e,t,n){var o={s:{"short":["s"],med:["s ago"],"long":[" second ago"," seconds ago"]},m:{"short":["m"],med:["m ago"],"long":[" minute ago"," minutes ago"]},h:{"short":["h"],med:["h ago"],"long":[" hour ago"," hours ago"]},d:{"short":["d"],med:["d ago"],"long":[" day ago"," days ago"]}};if(o[e]){var i=o[e][t];return 1===n?i[0]:i[i.length-1]}return""}function p(e,t){t=t||{};var n,s=new Date(Number(e)),a=new Date,r=t.format||"short",p="short"===t.format||"med"===t.format;if(!u(s))return!1;if(n=parseInt((a.getTime()-s)/1e3,10),0>n)return!1;if(t.notAfter&&n>t.notAfter)return!1;if(55>n)return n+f("s",r,n);if(3300>n){var g=Math.round(n/60,10);return g+f("m",r,g)}if(c(s)||p&&l(s)){var v=Math.round(n/3600);return v+f("h",r,v)}if(p&&m(s)){var y=Math.round(n/3600/24);return y+f("d",r,y)}return d(s)?"Yesterday"+h(s):432e3>n?[o(s.getDay()),s.getDate(),i(s.getMonth()),s.getFullYear()].join(" ")+(t.showTime?h(s):""):[s.getDate(),i(s.getMonth()),s.getFullYear()].join(" ")+(t.showTime?h(s):"")}function h(e){return", "+r(e.getHours())+":"+s(e.getMinutes())+a(e.getHours())}function g(t){return e(".js-timestamp, .js-item__timestamp",t)}function v(t){var o="js-locale-timestamp";e("."+o,t).each(function(e){var t,i=n(e),a=parseInt(i.attr("data-timestamp"),10);a&&(t=new Date(a),e.innerHTML=s(t.getHours())+":"+s(t.getMinutes()),i.removeClass(o))})}function y(e,t){t=t||{},g(e).each(function(e){var o=n(e),i=parseInt(o.attr("data-timestamp"),10)||o.attr("datetime"),s=new Date(i),a=p(s.getTime(),{showTime:n(o.parent()).hasClass("block-time"),format:o.attr("data-relativeformat"),notAfter:t.notAfter});if(o.removeClass("js-timestamp"),a){var r=o[0].querySelector(".timestamp__text")||o[0];r.getAttribute("title")||r.setAttribute("title",n(r).text()),r.innerHTML=a}else t.notAfter&&o.addClass("js-hidden")})}function b(e,t){y(e,t),v(e,t)}return["related","autoupdate"].forEach(function(e){t.on("modules:"+e+":render",y)}),{makeRelativeDate:p,init:b}}),define("common/modules/analytics/clickstream",["common/utils/mediator","common/utils/detect","bean","common/modules/experiments/ab"],function(e,t,n,o){var i=function(t){t=t||{};var i=t.filter||[],s=function(e){return i.filter(function(t){return t===e})},a=function(e){var t,n,o,i;return e=e||"",t=e.match(/:\/\/(.[^\/]+)/),t&&(t=t[1],n=e.match(/^(https?:)\/\//),n=n?n[1]:void 0,o=window.location.hostname,i=window.location.protocol),!t||t===o&&n===i},r=function(e,t){if(!e.el)return!1;var n,o=e.el,i=o.tagName.toLowerCase(),c=o.getAttribute("data-link-name");return c&&(e.tag=e.tag||[],e.tag.push(c)),"body"===i?e.validTarget&&e.tag&&e.tag.length?(e.tag=[].concat(e.tag).reverse().join(" | "),o.getAttribute("data-link-test")&&(e.tag=o.getAttribute("data-link-test")+" | "+e.tag),delete e.el,delete e.validTarget,e):!1:(e.validTarget||(e.validTarget=s(o.tagName.toLowerCase()).length>0||t,e.validTarget&&(e.target=o,n=o.getAttribute("href"),e.samePage=n&&0===n.indexOf("#")||"button"===i||o.hasAttribute("data-is-ajax"),e.sameHost=e.samePage||a(n))),!e.linkContext&&o.getAttribute("data-link-context-path")&&(e.linkContextPath=o.getAttribute("data-link-context-path"),e.linkContextName=o.getAttribute("data-link-context-name")),e.el=o.parentNode,r(e))};return t.addListener!==!1&&n.add(document.body,"click",function(n){var i={el:n.target};t.withEvent!==!1&&(i.event=n),i=r(i);var s=o.getActiveTestsEventIsApplicableTo(i);void 0!==s&&s.length>0&&(i.tag=s.map(function(e){var t=o.getTestVariant(e);return"AB,"+e+","+t+","+i.tag}).join(",")),i&&e.emit("module:clickstream:click",i)}),{getClickSpec:r}};return i});var s=s_gi(s_account);s.charSet="UTF-8",s.currencyCode="GBP",s.trackDownloadLinks=!0,s.trackExternalLinks=!0,s.trackInlineStats=!0,s.linkDownloadFileTypes="exe,zip,wav,mp3,mov,mpg,avi,wmv,pdf,doc,docx,xls,xlsx,ppt,pptx",s.linkInternalFilters="javascript:,adinfo-guardian.co.uk,dating.guardian.co.uk,guardian.co.uk,guardian.greatgetaways.co.uk,guardian.lcplc-online.co.uk,guardian.oddschecker.com,guardian.pickthescore.co.uk,guardian.sportinglife.com,guardian.touch-line.com,guardian.unbiased.co.uk,guardianapis.com,guardianapps.co.uk,guardianbooks.co.uk,guardianbookshop.co.uk,guardiancottages.co.uk,guardiandigitalcomparison.co.uk,guardiandirectsubs.co.uk,guardianeatright.co.uk,guardianecostore.co.uk,guardianenergycomparison.co.uk,guardianenergycomparison.com,guardianfashionstore.co.uk,guardiangardencentre.co.uk,guardiangiftexperiences.co.uk,guardianholidayoffers.co.uk,guardianhomeexchange.co.uk,guardianhomeexchange.com,guardianinvesting.co.uk,guardianjobs.co.uk,guardianjobs.com,guardianjobs.mobi,guardianjobsrecruiter.co.uk,guardiannews.com,guardian-newspaper.com,guardianoffers.co.uk,guardianprofessional.co.uk,guardianpublic.co.uk,guardiansubscriptions.co.uk,guardiantickets.co.uk,guardianvouchercodes.co.uk,guardianweekly.co.uk,guardianweekly.com,id.guardian.co.uk,ivebeenthere.co.uk,jobs.guardian.co.uk,kable.co.uk,money-deals.co.uk,mps-expenses.guardian.co.uk,ogenterprises.co.uk,ogtravelinsurance.co.uk,sixsongsof.me,sixwordmemoirs.co.uk,smarthealthcare.com,sofacinema.co.uk,static.guim.co.uk,theguardian.co.uk,theguardian.com,traffic.outbrain.com,tvlistings.guardian.co.uk",s.linkLeaveQueryString=!1,s.linkTrackVars="None",s.linkTrackEvents="None",s._tpDST={2012:"3/25,10/28",2013:"3/31,10/27",2014:"3/30,10/26",2015:"3/29,10/25",2016:"3/27,10/30",2017:"3/26,10/29",2018:"3/25,10/28",2019:"3/31,10/27"},s.usePlugins=!0,s.doPlugins=s_doPlugins;var s_sv_dynamic_root="survey.112.2o7.net/survey/dynamic",s_sv_gather_root="survey.112.2o7.net/survey/gather";s.loadMediaModule=function(e,t){var n=this;n.loadModule("Media"),n.Media.autoTrack=!1,n.Media.trackWhilePlaying=!0,n.Media.trackSeconds=15,n.Media.trackVars="events,eVar7,eVar43,eVar44,prop44,eVar47,eVar48,eVar56,eVar61",n.Media.trackEvents="event17,event18,event21,event22,event23,event57,event63",n.Media.trackMilestones="25,50,75",n.Media.segmentByMilestones=!0,n.Media.trackUsingContextData=!0,n.Media.contextDataMapping={"a.media.name":"eVar44,prop44","a.media.segment":"eVar48","a.contentType":"eVar43","a.media.timePlayed":"event57","a.media.view":"event17","a.media.segmentView":"event63","a.media.complete":"event18","a.media.milestones":{25:"event21",50:"event22",75:"event23"}},n.Media.monitor=function(e,t){"OPEN"==t.event&&(e.eVar7=e.pageName,e.eVar61=e._GUVideo.restricted?"restricted":"not restricted",e._GUVideo.ad?e.eVar47="video ad":(e.eVar47="video content",e.eVar56=e._GUVideo.provider),e.Media.track(t.name))
},n._GUVideo={},n._GUVideo.provider=e,n._GUVideo.restricted=t},s.trackVideoContent=function(e,t){var n=this;n.Media.autoTrack=!1,n.Media.trackVars="events,eVar7,eVar11,eVar43,eVar44,prop44,eVar47,eVar48,eVar56,eVar61",n.Media.trackEvents="event17,event18,event21,event22,event23,event57,event63",n.Media.trackMilestones="25,50,75",n.Media.segmentByMilestones=!0,n.Media.trackUsingContextData=!0,n.Media.contextDataMapping={"a.media.name":"eVar44,prop44","a.media.segment":"eVar48","a.contentType":"eVar43","a.media.timePlayed":"event57","a.media.view":"event17","a.media.segmentView":"event63","a.media.complete":"event18","a.media.milestones":{25:"event21",50:"event22",75:"event23"}},n._GUVideo.ad=!1,n._GUVideo.provider=e,n._GUVideo.restricted=t},s.trackVideoAd=function(){var e=this;e.Media.autoTrack=!1,e.Media.trackVars="events,eVar7,eVar11,eVar43,prop44,eVar44,eVar47,eVar56,eVar61",e.Media.trackEvents="event57,event59,event64",e.Media.segmentByMilestones=!1,e.Media.trackUsingContextData=!0,e.Media.contextDataMapping={"a.media.name":"eVar44,prop44","a.contentType":"eVar43","a.media.timePlayed":"event57","a.media.view":"event59","a.media.complete":"event64"},e._GUVideo.ad=!0,e._GUVideo.restricted=!1},s.trackingServer="hits.guardian.co.uk",s.trackingServerSecure="hits-secure.guardian.co.uk",s.visitorNamespace="guardian",s.getQueryParam=new Function("p","d","u","h","var s=this,v='',i,j,t;d=d?d:'';u=u?u:(s.pageURL?s.pageURL:s.wd.location);if(u=='f')u=s.gtfs().location;while(p){i=p.indexOf(',');i=i<0?p.length:i;t=s.p_gpv(p.substring(0,i),u+'',h);if(t){t=t.indexOf('#')>-1?t.substring(0,t.indexOf('#')):t;}if(t)v+=v?d+t:t;p=p.substring(i==p.length?i:i+1)}return v"),s.p_gpv=new Function("k","u","h","var s=this,v='',q;j=h==1?'#':'?';i=u.indexOf(j);if(k&&i>-1){q=u.substring(i+1);v=s.pt(q,'&','p_gvf',k)}return v"),s.p_gvf=new Function("t","k","if(t){var s=this,i=t.indexOf('='),p=i<0?t:t.substring(0,i),v=i<0?'True':t.substring(i+1);if(p.toLowerCase()==k.toLowerCase())return s.epa(v)}return''"),s.getValOnce=new Function("v","c","e","t","var s=this,a=new Date,v=v?v:'',c=c?c:'s_gvo',e=e?e:0,i=t=='m'?60000:86400000;k=s.c_r(c);if(v){a.setTime(a.getTime()+e*i);s.c_w(c,v,e==0?0:a);}return v==k?'':v"),s.getDaysSinceLastVisit=new Function("c","var s=this,e=new Date(),es=new Date(),cval,cval_s,cval_ss,ct=e.getTime(),day=24*60*60*1000,f1,f2,f3,f4,f5;e.setTime(ct+3*365*day);es.setTime(ct+30*60*1000);f0='Cookies Not Supported';f1='First Visit';f2='More than 30 days';f3='More than 7 days';f4='Less than 7 days';f5='Less than 1 day';cval=s.c_r(c);if(cval.length==0){s.c_w(c,ct,e);s.c_w(c+'_s',f1,es);}else{var d=ct-cval;if(d>30*60*1000){if(d>30*day){s.c_w(c,ct,e);s.c_w(c+'_s',f2,es);}else if(d<30*day+1 && d>7*day){s.c_w(c,ct,e);s.c_w(c+'_s',f3,es);}else if(d<7*day+1 && d>day){s.c_w(c,ct,e);s.c_w(c+'_s',f4,es);}else if(d<day+1){s.c_w(c,ct,e);s.c_w(c+'_s',f5,es);}}else{s.c_w(c,ct,e);cval_ss=s.c_r(c+'_s');s.c_w(c+'_s',cval_ss,es);}}cval_s=s.c_r(c+'_s');if(cval_s.length==0) return f0;else if(cval_s!=f1&&cval_s!=f2&&cval_s!=f3&&cval_s!=f4&&cval_s!=f5) return '';else return cval_s;"),s.crossVisitParticipation=new Function("v","cn","ex","ct","dl","ev","dv","var s=this,ce;if(typeof(dv)==='undefined')dv=0;if(s.events&&ev){var ay=s.split(ev,',');var ea=s.split(s.events,',');for(var u=0;u<ay.length;u++){for(var x=0;x<ea.length;x++){if(ay[u]==ea[x]){ce=1;}}}}if(!v||v==''){if(ce){s.c_w(cn,'');return'';}else return'';}v=escape(v);var arry=new Array(),a=new Array(),c=s.c_r(cn),g=0,h=new Array();if(c&&c!=''){arry=s.split(c,'],[');for(q=0;q<arry.length;q++){z=arry[q];z=s.repl(z,'[','');z=s.repl(z,']','');z=s.repl(z,\"'\",'');arry[q]=s.split(z,',')}}var e=new Date();e.setFullYear(e.getFullYear()+5);if(dv==0&&arry.length>0&&arry[arry.length-1][0]==v)arry[arry.length-1]=[v,new Date().getTime()];else arry[arry.length]=[v,new Date().getTime()];var start=arry.length-ct<0?0:arry.length-ct;var td=new Date();for(var x=start;x<arry.length;x++){var diff=Math.round((td.getTime()-arry[x][1])/86400000);if(diff<ex){h[g]=unescape(arry[x][0]);a[g]=[arry[x][0],arry[x][1]];g++;}}var data=s.join(a,{delim:',',front:'[',back:']',wrap:\"'\"});s.c_w(cn,data,e);var r=s.join(h,{delim:dl});if(ce)s.c_w(cn,'');return r;"),s.getNewRepeat=new Function("d","cn","var s=this,e=new Date(),cval,sval,ct=e.getTime();d=d?d:30;cn=cn?cn:'s_nr';e.setTime(ct+d*24*60*60*1000);cval=s.c_r(cn);if(cval.length==0){s.c_w(cn,ct+'-New',e);return'New';}sval=s.split(cval,'-');if(ct-sval[0]<30*60*1000&&sval[1]=='New'){s.c_w(cn,ct+'-New',e);return'New';}else{s.c_w(cn,ct+'-Repeat',e);return'Repeat';}"),s.getLoadTimeDim=new Function("","var t='';if(typeof performance!=='undefined'){t=(new Date()).getTime()-performance.timing.requestStart;t=t/1000;t=(t>=0&&t<500)?t.toFixed(1):'';}return t;"),s.inList=new Function("v","l","d","var s=this,ar=Array(),i=0,d=(d)?d:',';if(typeof(l)=='string'){if(s.split)ar=s.split(l,d);else if(l.split)ar=l.split(d);else return-1}else ar=l;while(i<ar.length){if(v==ar[i])return true;i++}return false;"),s.apl=new Function("l","v","d","u","var s=this,m=0;if(!l)l='';if(u){var i,n,a=s.split(l,d);for(i=0;i<a.length;i++){n=a[i];m=m||(u==1?(n==v):(n.toLowerCase()==v.toLowerCase()));}}if(!m)l=l?l+d+v:v;return l"),s.split=new Function("l","d","var i,x=0,a=new Array;while(l){i=l.indexOf(d);i=i>-1?i:l.length;a[x++]=l.substring(0,i);l=l.substring(i+d.length);}return a"),s.getTimeParting=new Function("h","z","var s=this,od;od=new Date('1/1/2000');if(od.getDay()!=6||od.getMonth()!=0){return'Data Not Available';}else{var H,M,D,W,U,ds,de,tm,tt,da=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],d=new Date(),a=[];z=z?z:0;z=parseFloat(z);if(s._tpDST){var dso=s._tpDST[d.getFullYear()].split(/,/);ds=new Date(dso[0]+'/'+d.getFullYear());de=new Date(dso[1]+'/'+d.getFullYear());if(h=='n'&&d>ds&&d<de){z=z+1;}else if(h=='s'&&(d>de||d<ds)){z=z+1;}}d=d.getTime()+(d.getTimezoneOffset()*60000);d=new Date(d+(3600000*z));H=d.getHours();M=d.getMinutes();M=(M<10)?'0'+M:M;D=d.getDay();U='AM';W='Weekday';if(H>=12){U='PM';H=H-12;}if(H==0){H=12;}if(D==6||D==0){W='Weekend';}D=da[D];tm=H+':'+M+U;tt=H+':'+((M>30)?'30':'00')+U;a=[tm,tt,D,W];return a;}"),s.m_Survey_c='var m=s.m_i("Survey");m.launch=function(i,e,c,o,f){this._boot();var m=this,g=window.s_sv_globals||{},l,j;if(g.unloaded||m._blocked())return 0;i=i&&i.constructor&&i.constructor==Array?i:[i];l=g.manualTriggers;for(j=0;j<i.length;++j)l[l.length]={l:m._suites,i:i[j],e:e||0,c:c||0,o:o||0,f:f||0};m._execute();return 1;};m.version = 10001;m._t=function(){this._boot();var m=this,s=m.s,g=window.s_sv_globals||{},l,impr,i,k,impr={};if(m._blocked())return;for(i=0;i<s.va_t.length;i++){k=s.va_t[i];if(s[k]) impr[k]=s[k];}impr["l"]=m._suites;impr["n"]=impr["pageName"]||"";impr["u"]=impr["pageURL"]||"";impr["c"]=impr["campaign"]||"";impr["r"]=impr["referrer"]||"";l=g.pageImpressions;if(l.length > 4) l[l.length - 4]=null;l[l.length]=impr;m._execute();};m._rr=function(){var g=window.s_sv_globals||{},f=g.onScQueueEmpty||0;if(f)f();};m._blocked=function(){var m=this,g=window.s_sv_globals||{};return !m._booted||g.stop||!g.pending&&!g.triggerRequested;};m._execute=function(){if(s_sv_globals.execute)setTimeout("s_sv_globals.execute();",0);};m._boot=function(){var m=this,s=m.s,w=window,g,c,d=s.dc,e=s.visitorNamespace,n=navigator.appName.toLowerCase(),a=navigator.userAgent,v=navigator.appVersion,h,i,j,k,l,b;if(w.s_sv_globals)return;if(!((b=v.match(/AppleWebKit\\/([0-9]+)/))?521<b[1]:n=="netscape"?a.match(/gecko\\//i):(b=a.match(/opera[ \\/]?([0-9]+).[0-9]+/i))?7<b[1]:n=="microsoft internet explorer"&&!v.match(/macintosh/i)&&(b=v.match(/msie ([0-9]+).([0-9]+)/i))&&(5<b[1]||b[1]==5&&4<b[2])))return;g=w.s_sv_globals={};g.module=m;g.pending=0;g.incomingLists=[];g.pageImpressions=[];g.manualTriggers=[];e="survey";c=g.config={};m._param(c,"dynamic_root",(e?e+".":"")+d+".2o7.net/survey/dynamic");m._param(c,"gather_root",(e?e+".":"")+d+".2o7.net/survey/gather");g.url=location.protocol+"//"+c.dynamic_root;g.gatherUrl=location.protocol+"//"+c.gather_root;g.dataCenter=d;g.onListLoaded=new Function("r","b","d","i","l","s_sv_globals.module._loaded(r,b,d,i,l);");m._suites=(m.suites||s.un).toLowerCase().split(",");l=m._suites;b={};for(j=0;j<l.length;++j){i=l[j];if(i&&!b[i]){h=i.length;for(k=0;k<i.length;++k)h=(h&0x03ffffff)<<5^h>>26^i.charCodeAt(k);b[i]={url:g.url+"/suites/"+(h%251+100)+"/"+encodeURIComponent(i.replace(/\\|/,"||").replace(/\\//,"|-"))};++g.pending;}}g.suites=b;setTimeout("s_sv_globals.module._load();",0);m._booted=1;};m._param=function(c,n,v){var p="s_sv_",w=window,u="undefined";if(typeof c[n]==u)c[n]=typeof w[p+n]==u?v:w[p+n];};m._load=function(){var m=this,g=s_sv_globals,q=g.suites,r,i,n="s_sv_sid",b=m.s.c_r(n);if(!b){b=parseInt((new Date()).getTime()*Math.random());m.s.c_w(n,b);}for(i in q){r=q[i];if(!r.requested){r.requested=1;m._script(r.url+"/list.js?"+b);}}};m._loaded=function(r,b,d,i,l){var m=this,g=s_sv_globals,n=g.incomingLists;--g.pending;if(!g.commonRevision){g.bulkRevision=b;g.commonRevision=r;g.commonUrl=g.url+"/common/"+b;}else if(g.commonRevision!=r)return;if(!l.length)return;n[n.length]={r:i,l:l};if(g.execute)g.execute();else if(!g.triggerRequested){g.triggerRequested=1;m._script(g.commonUrl+"/trigger.js");}};m._script=function(u){var d=document,e=d.createElement("script");e.type="text/javascript";e.src=u;d.getElementsByTagName("head")[0].appendChild(e);};if(m.onLoad)m.onLoad(s,m)',s.m_i("Survey"),s.m_Media_c="var m=s.m_i('Media');if(m.completeByCloseOffset==undefined)m.completeByCloseOffset=1;if(m.completeCloseOffsetThreshold==undefined)m.completeCloseOffsetThreshold=1;m.cn=function(n){var m=this;return m.s.rep(m.s.rep(m.s.rep(n,\"\\n\",''),\"\\r\",''),'--**--','')};m.open=function(n,l,p,b){var m=this,i=new Object,tm=new Date,a='',x;n=m.cn(n);if(!l)l=-1;if(n&&p){if(!m.l)m.l=new Object;if(m.l[n])m.close(n);if(b&&b.id)a=b.id;if(a)for (x in m.l)if(m.l[x]&&m.l[x].a==a)m.close(m.l[x].n);i.n=n;i.l=l;i.o=0;i.x=0;i.p=m.cn(m.playerName?m.playerName:p);i.a=a;i.t=0;i.ts=0;i.s=Math.floor(tm.getTime()/1000);i.lx=0;i.lt=i.s;i.lo=0;i.e='';i.to=-1;i.tc=0;i.fel=new Object;i.vt=0;i.sn=0;i.sx=\"\";i.sl=0;i.sg=0;i.sc=0;i.us=0;i.ad=0;i.adpn;i.adpp;i.adppp;i.clk;i.CPM;i.co=0;i.cot=0;i.lm=0;i.lom=0;m.l[n]=i}};m.openAd=function(n,l,p,pn,pp,ppp,CPM,b){var m=this,i=new Object;n=m.cn(n);m.open(n,l,p,b);i=m.l[n];if(i){i.ad=1;i.adpn=m.cn(pn);i.adpp=pp;i.adppp=ppp;i.CPM=CPM}};m._delete=function(n){var m=this,i;n=m.cn(n);i=m.l[n];m.l[n]=0;if(i&&i.m)clearTimeout(i.m.i)};m.close=function(n){this.e(n,0,-1)};m.play=function(n,o,sn,sx,sl){var m=this,i;i=m.e(n,1,o,sn,sx,sl);if(i&&!i.m){i.m=new Object;i.m.m=new Function('var m=s_c_il['+m._in+'],i;if(m.l){i=m.l[\"'+m.s.rep(i.n,'\"','\\\\\"')+'\"];if(i){if(i.lx==1)m.e(i.n,3,-1);i.m.i=setTimeout(i.m.m,1000)}}');i.m.m()}};m.click=function(n,o){this.e(n,7,o)};m.complete=function(n,o){this.e(n,5,o)};m.stop=function(n,o){this.e(n,2,o)};m.track=function(n){this.e(n,4,-1)};m.bcd=function(vo,i){var m=this,ns='a.media.',v=vo.linkTrackVars,e=vo.linkTrackEvents,pe='m_i',pev3,c=vo.contextData,x;if(i.ad){ns+='ad.';if(i.adpn){c['a.media.name']=i.adpn;c[ns+'pod']=i.adpp;c[ns+'podPosition']=i.adppp;}if(!i.vt)c[ns+'CPM']=i.CPM;}if (i.clk) {c[ns+'clicked']=1;i.clk=0}c['a.contentType']='video'+(i.ad?'Ad':'');c['a.media.channel']=m.channel;c[ns+'name']=i.n;c[ns+'playerName']=i.p;if(i.l>0)c[ns+'length']=i.l;if(Math.floor(i.ts)>0)c[ns+'timePlayed']=Math.floor(i.ts);if(!i.vt){c[ns+'view']=true;pe='m_s';i.vt=1}if(i.sx){c[ns+'segmentNum']=i.sn;c[ns+'segment']=i.sx;if(i.sl>0)c[ns+'segmentLength']=i.sl;if(i.sc&&i.ts>0)c[ns+'segmentView']=true}if(!i.cot&&i.co){c[ns+\"complete\"]=true;i.cot=1}if(i.lm>0)c[ns+'milestone']=i.lm;if(i.lom>0)c[ns+'offsetMilestone']=i.lom;if(v)for(x in c)v+=',contextData.'+x;pev3=c['a.contentType'];vo.pe=pe;vo.pev3=pev3;var d=m.contextDataMapping,y,a,l,n;if(d){vo.events2='';if(v)v+=',events';for(x in d){if(x.substring(0,ns.length)==ns)y=x.substring(ns.length);else y=\"\";a=d[x];if(typeof(a)=='string'){l=m.s.sp(a,',');for(n=0;n<l.length;n++){a=l[n];if(x==\"a.contentType\"){if(v)v+=','+a;vo[a]=c[x]}else if(y=='view'||y=='segmentView'||y=='clicked'||y=='complete'||y=='timePlayed'||y=='CPM'){if(e)e+=','+a;if(y=='timePlayed'||y=='CPM'){if(c[x])vo.events2+=(vo.events2?',':'')+a+'='+c[x];}else if(c[x])vo.events2+=(vo.events2?',':'')+a}else if(y=='segment'&&c[x+'Num']){if(v)v+=','+a;vo[a]=c[x+'Num']+':'+c[x]}else{if(v)v+=','+a;vo[a]=c[x]}}}else if(y=='milestones'||y=='offsetMilestones'){x=x.substring(0,x.length-1);if(c[x]&&d[x+'s'][c[x]]){if(e)e+=','+d[x+'s'][c[x]];vo.events2+=(vo.events2?',':'')+d[x+'s'][c[x]]}}if(c[x])c[x]=undefined;if(y=='segment'&&c[x+'Num'])c[x+\"Num\"]=undefined}}vo.linkTrackVars=v;vo.linkTrackEvents=e};m.bpe=function(vo,i,x,o){var m=this,pe='m_o',pev3,d='--**--';pe='m_o';if(!i.vt){pe='m_s';i.vt=1}else if(x==4)pe='m_i';pev3=m.s.ape(i.n)+d+Math.floor(i.l>0?i.l:1)+d+m.s.ape(i.p)+d+Math.floor(i.t)+d+i.s+d+(i.to>=0?'L'+Math.floor(i.to):'')+i.e+(x!=0&&x!=2?'L'+Math.floor(o):'');vo.pe=pe;vo.pev3=pev3};m.e=function(n,x,o,sn,sx,sl,pd){var m=this,i,tm=new Date,ts=Math.floor(tm.getTime()/1000),c,l,v=m.trackVars,e=m.trackEvents,ti=m.trackSeconds,tp=m.trackMilestones,to=m.trackOffsetMilestones,sm=m.segmentByMilestones,so=m.segmentByOffsetMilestones,z=new Array,j,t=1,w=new Object,x,ek,tc,vo=new Object;if(!m.channel)m.channel=m.s.wd.location.hostname;n=m.cn(n);i=n&&m.l&&m.l[n]?m.l[n]:0;if(i){if(i.ad){ti=m.adTrackSeconds;tp=m.adTrackMilestones;to=m.adTrackOffsetMilestones;sm=m.adSegmentByMilestones;so=m.adSegmentByOffsetMilestones}if(o<0){if(i.lx==1&&i.lt>0)o=(ts-i.lt)+i.lo;else o=i.lo}if(i.l>0)o=o<i.l?o:i.l;if(o<0)o=0;i.o=o;if(i.l>0){i.x=(i.o/i.l)*100;i.x=i.x>100?100:i.x}if(i.lo<0)i.lo=o;tc=i.tc;w.name=n;w.ad=i.ad;w.length=i.l;w.openTime=new Date;w.openTime.setTime(i.s*1000);w.offset=i.o;w.percent=i.x;w.playerName=i.p;if(i.to<0)w.mediaEvent=w.event='OPEN';else w.mediaEvent=w.event=(x==1?'PLAY':(x==2?'STOP':(x==3?'MONITOR':(x==4?'TRACK':(x==5?'COMPLETE':(x==7?'CLICK':('CLOSE')))))));if(!pd){if(i.pd)pd=i.pd}else i.pd=pd;w.player=pd;if(x>2||(x!=i.lx&&(x!=2||i.lx==1))) {if(!sx){sn=i.sn;sx=i.sx;sl=i.sl}if(x){if(x==1)i.lo=o;if((x<=3||x>=5)&&i.to>=0){t=0;v=e=\"None\";if(i.to!=o){l=i.to;if(l>o){l=i.lo;if(l>o)l=o}z=tp?m.s.sp(tp,','):0;if(i.l>0&&z&&o>=l)for(j=0;j<z.length;j++){c=z[j]?parseFloat(''+z[j]):0;if(c&&(l/i.l)*100<c&&i.x>=c){t=1;j=z.length;w.mediaEvent=w.event='MILESTONE';i.lm=w.milestone=c}}z=to?m.s.sp(to,','):0;if(z&&o>=l)for(j=0;j<z.length;j++){c=z[j]?parseFloat(''+z[j]):0;if(c&&l<c&&o>=c){t=1;j=z.length;w.mediaEvent=w.event='OFFSET_MILESTONE';i.lom=w.offsetMilestone=c}}}}if(i.sg||!sx){if(sm&&tp&&i.l>0){z=m.s.sp(tp,',');if(z){z[z.length]='100';l=0;for(j=0;j<z.length;j++){c=z[j]?parseFloat(''+z[j]):0;if(c){if(i.x<c){sn=j+1;sx='M:'+l+'-'+c;j=z.length}l=c}}}}else if(so&&to){z=m.s.sp(to,',');if(z){z[z.length]=''+(i.l>0?i.l:'E');l=0;for(j=0;j<z.length;j++){c=z[j]?parseFloat(''+z[j]):0;if(c||z[j]=='E'){if(o<c||z[j]=='E'){sn=j+1;sx='O:'+l+'-'+c;j=z.length}l=c}}}}if(sx)i.sg=1}if((sx||i.sx)&&sx!=i.sx){i.us=1;if(!i.sx){i.sn=sn;i.sx=sx}if(i.to>=0)t=1}if((x>=2||i.x>=100)&&i.lo<o){i.t+=o-i.lo;i.ts+=o-i.lo}if(x<=2||(x==3&&!i.lx)){i.e+=(x==1||x==3?'S':'E')+Math.floor(o);i.lx=(x==3?1:x)}if(!t&&i.to>=0&&x<=3){ti=ti?ti:0;if(ti&&i.ts>=ti){t=1;w.mediaEvent=w.event='SECONDS'}}i.lt=ts;i.lo=o}if(!x||(x<=3&&i.x>=100)){if(i.lx!=2)i.e+='E'+Math.floor(o);x=0;v=e=\"None\";w.mediaEvent=w.event=\"CLOSE\"}if(x==7){w.clicked=i.clk=1;t=1}if(x==5||(m.completeByCloseOffset&&(!x||i.x>=100)&&i.l>0&&o>=i.l-m.completeCloseOffsetThreshold)){w.complete=i.co=1;t=1}ek=w.mediaEvent;if(ek=='MILESTONE')ek+='_'+w.milestone;else if(ek=='OFFSET_MILESTONE')ek+='_'+w.offsetMilestone;if(!i.fel[ek]) {w.eventFirstTime=true;i.fel[ek]=1}else w.eventFirstTime=false;w.timePlayed=i.t;w.segmentNum=i.sn;w.segment=i.sx;w.segmentLength=i.sl;if(m.monitor&&x!=4)m.monitor(m.s,w);if(x==0)m._delete(n);if(t&&i.tc==tc){vo=new Object;vo.contextData=new Object;vo.linkTrackVars=v;vo.linkTrackEvents=e;if(!vo.linkTrackVars)vo.linkTrackVars='';if(!vo.linkTrackEvents)vo.linkTrackEvents='';if(m.trackUsingContextData)m.bcd(vo,i);else m.bpe(vo,i,x,o);m.s.t(vo);if(i.us){i.sn=sn;i.sx=sx;i.sc=1;i.us=0}else if(i.ts>0)i.sc=0;i.e=\"\";i.lm=i.lom=0;i.ts-=Math.floor(i.ts);i.to=o;i.tc++}}}return i};m.ae=function(n,l,p,x,o,sn,sx,sl,pd,b){var m=this,r=0;if(n&&(!m.autoTrackMediaLengthRequired||(length&&length>0)) &&p){if(!m.l||!m.l[n]){if(x==1||x==3){m.open(n,l,p,b);r=1}}else r=1;if(r)m.e(n,x,o,sn,sx,sl,pd)}};m.a=function(o,t){var m=this,i=o.id?o.id:o.name,n=o.name,p=0,v,c,c1,c2,xc=m.s.h,x,e,f1,f2='s_media_'+m._in+'_oc',f3='s_media_'+m._in+'_t',f4='s_media_'+m._in+'_s',f5='s_media_'+m._in+'_l',f6='s_media_'+m._in+'_m',f7='s_media_'+m._in+'_c',tcf,w;if(!i){if(!m.c)m.c=0;i='s_media_'+m._in+'_'+m.c;m.c++}if(!o.id)o.id=i;if(!o.name)o.name=n=i;if(!m.ol)m.ol=new Object;if(m.ol[i])return;m.ol[i]=o;if(!xc)xc=m.s.b;tcf=new Function('o','var e,p=0;try{if(o.versionInfo&&o.currentMedia&&o.controls)p=1}catch(e){p=0}return p');p=tcf(o);if(!p){tcf=new Function('o','var e,p=0,t;try{t=o.GetQuickTimeVersion();if(t)p=2}catch(e){p=0}return p');p=tcf(o);if(!p){tcf=new Function('o','var e,p=0,t;try{t=o.GetVersionInfo();if(t)p=3}catch(e){p=0}return p');p=tcf(o)}}v=\"var m=s_c_il[\"+m._in+\"],o=m.ol['\"+i+\"']\";if(p==1){p='Windows Media Player '+o.versionInfo;c1=v+',n,p,l,x=-1,cm,c,mn;if(o){cm=o.currentMedia;c=o.controls;if(cm&&c){mn=cm.name?cm.name:c.URL;l=cm.duration;p=c.currentPosition;n=o.playState;if(n){if(n==8)x=0;if(n==3)x=1;if(n==1||n==2||n==4||n==5||n==6)x=2;}';c2='if(x>=0)m.ae(mn,l,\"'+p+'\",x,x!=2?p:-1,0,\"\",0,0,o)}}';c=c1+c2;if(m.s.isie&&xc){x=m.s.d.createElement('script');x.language='jscript';x.type='text/javascript';x.htmlFor=i;x.event='PlayStateChange(NewState)';x.defer=true;x.text=c;xc.appendChild(x);o[f6]=new Function(c1+'if(n==3){x=3;'+c2+'}setTimeout(o.'+f6+',5000)');o[f6]()}}if(p==2){p='QuickTime Player '+(o.GetIsQuickTimeRegistered()?'Pro ':'')+o.GetQuickTimeVersion();f1=f2;c=v+',n,x,t,l,p,p2,mn;if(o){mn=o.GetMovieName()?o.GetMovieName():o.GetURL();n=o.GetRate();t=o.GetTimeScale();l=o.GetDuration()/t;p=o.GetTime()/t;p2=o.'+f5+';if(n!=o.'+f4+'||p<p2||p-p2>5){x=2;if(n!=0)x=1;else if(p>=l)x=0;if(p<p2||p-p2>5)m.ae(mn,l,\"'+p+'\",2,p2,0,\"\",0,0,o);m.ae(mn,l,\"'+p+'\",x,x!=2?p:-1,0,\"\",0,0,o)}if(n>0&&o.'+f7+'>=10){m.ae(mn,l,\"'+p+'\",3,p,0,\"\",0,0,o);o.'+f7+'=0}o.'+f7+'++;o.'+f4+'=n;o.'+f5+'=p;setTimeout(\"'+v+';o.'+f2+'(0,0)\",500)}';o[f1]=new Function('a','b',c);o[f4]=-1;o[f7]=0;o[f1](0,0)}if(p==3){p='RealPlayer '+o.GetVersionInfo();f1=n+'_OnPlayStateChange';c1=v+',n,x=-1,l,p,mn;if(o){mn=o.GetTitle()?o.GetTitle():o.GetSource();n=o.GetPlayState();l=o.GetLength()/1000;p=o.GetPosition()/1000;if(n!=o.'+f4+'){if(n==3)x=1;if(n==0||n==2||n==4||n==5)x=2;if(n==0&&(p>=l||p==0))x=0;if(x>=0)m.ae(mn,l,\"'+p+'\",x,x!=2?p:-1,0,\"\",0,0,o)}if(n==3&&(o.'+f7+'>=10||!o.'+f3+')){m.ae(mn,l,\"'+p+'\",3,p,0,\"\",0,0,o);o.'+f7+'=0}o.'+f7+'++;o.'+f4+'=n;';c2='if(o.'+f2+')o.'+f2+'(o,n)}';if(m.s.wd[f1])o[f2]=m.s.wd[f1];m.s.wd[f1]=new Function('a','b',c1+c2);o[f1]=new Function('a','b',c1+'setTimeout(\"'+v+';o.'+f1+'(0,0)\",o.'+f3+'?500:5000);'+c2);o[f4]=-1;if(m.s.isie)o[f3]=1;o[f7]=0;o[f1](0,0)}};m.as=new Function('e','var m=s_c_il['+m._in+'],l,n;if(m.autoTrack&&m.s.d.getElementsByTagName){l=m.s.d.getElementsByTagName(m.s.isie?\"OBJECT\":\"EMBED\");if(l)for(n=0;n<l.length;n++)m.a(l[n]);}');if(s.wd.attachEvent)s.wd.attachEvent('onload',m.as);else if(s.wd.addEventListener)s.wd.addEventListener('load',m.as,false);if(m.onLoad)m.onLoad(s,m)",s.m_i("Media");var s_code="",s_objectID;s_giqf(),define("omniture",function(e){return function(){var t;return t||e.s}}(this)),define("common/modules/analytics/beacon",["common/utils/config"],function(e){return{fire:function(t){if(!e.page.isSSL){var n=new Image;n.src=e.page.beaconUrl+t}}}}),define("common/utils/deferToAnalytics",["common/utils/mediator"],function(e){function t(t){n?t():e.on("analytics:ready",function(){t()})}var n=!1;return e.on("analytics:ready",function(){n=!0}),t}),define("common/modules/analytics/omniture",["common/utils/detect","common/modules/experiments/ab","common/utils/storage","common/modules/identity/api","common/utils/cookies","omniture","common/modules/analytics/mvt-cookie","common/modules/analytics/beacon","common/utils/pad","common/utils/mediator","common/utils/deferToAnalytics"],function(e,t,n,o,i,s,a,r,c,l){function d(s,d){var m,u="s_ni",f="gu.analytics.referrerVars",p=this;d=d||{},this.pageviewSent=!1,this.logView=function(){s.t(),this.confirmPageView()},this.logUpdate=function(){s.linkTrackVars="events,eVar7",s.linkTrackEvents="event90",s.events="event90",s.eVar7=m.page.analyticsName,s.tl(!0,"o","AutoUpdate Refresh")},this.logTag=function(e){var t,o;if(e.tag)if(e.sameHost&&!e.samePage){t={pageName:s.pageName,tag:e.tag,time:(new Date).getTime()};try{sessionStorage.setItem(u,t.tag)}catch(i){}n.session.set(f,t)}else p.populateEventProperties(e.tag),o=e.samePage?!0:e.target,s.tl(o,"o",e.tag)},this.populateEventProperties=function(e){s.linkTrackVars="eVar37,eVar7,prop37,events",s.linkTrackEvents="event37",s.events="event37",s.eVar37=m.page.contentType?m.page.contentType+":"+e:e,s.eVar7="D=pageName",s.prop37="D=v37",/social/.test(e)&&(s.linkTrackVars+=",eVar12,prop4,prop9,prop10",s.linkTrackEvents+=",event16",s.eVar12=e,s.prop4=m.page.keywords||"",s.prop9=m.page.contentType||"",s.prop10=m.page.tones||"",s.events=s.apl(s.events,"event16",","))},this.trackNonLinkEvent=function(e){s.linkTrackVars="eVar37,events",s.linkTrackEvents="event37",s.events="event37",s.eVar37=m.page.contentType?m.page.contentType+":"+e:e,s.tl(!0,"o",e)},this.populatePageProperties=function(){s.cookieDomainPeriods="2",s.linkInternalFilters+=",localhost,gucode.co.uk,gucode.com,guardiannews.com,int.gnl,proxylocal.com,theguardian.com",s.trackingServer="hits.theguardian.com",s.trackingServerSecure="hits-secure.theguardian.com",s.ce="UTF-8",s.pageName=m.page.analyticsName,s.prop1=m.page.headline||"";var r=new Date;s.eVar1=r.getFullYear()+"/"+c(r.getMonth()+1,2)+"/"+c(r.getDate(),2),o.getUserFromCookie()&&(s.prop2="GUID:"+o.getUserFromCookie().id,s.eVar2="GUID:"+o.getUserFromCookie().id),s.prop3=m.page.publication||"",s.channel="Network Front"===m.page.contentType?"Network Front":m.page.section||"",s.prop9=m.page.contentType||"",s.prop4=m.page.keywords||"",s.prop6=m.page.author||"",s.prop7=m.page.webPublicationDate||"",s.prop8=m.page.pageCode||"",s.prop9=m.page.contentType||"",s.prop10=m.page.tones||"",s.prop13=m.page.series||"",s.eVar18=e.getBreakpoint(),s.eVar21=document.documentElement.clientWidth+"x"+document.documentElement.clientHeight,s.eVar32=e.getOrientation();var l=s.getTimeParting("n","+0");s.prop20=l[2]+":"+l[1],s.eVar20="D=c20",s.prop25=m.page.blogs||"",s.prop14=m.page.buildNumber||"";var p="frontend";s.prop19=p,s.eVar19=p,s.prop31=o.getUserFromCookie()?"registered user":"guest user",s.eVar31=o.getUserFromCookie()?"registered user":"guest user",s.prop47=m.page.edition||"";var h=t.makeOmnitureTag(m,document);s.prop51=h,s.eVar51=h;var g=i.get("GU_SHIFT");if(g){var v="gu_shift,"+g+",",y=i.get("GU_VIEW");y&&(v+=","+y),s.prop51=v+s.prop51,s.eVar51=v+s.eVar51}s.prop51&&(s.events=s.apl(s.events,"event58",","));var b=a.getMvtFullId();b&&(s.eVar60=b),m.page.commentable&&(s.events=s.apl(s.events,"event46",",")),"identity"===m.page.section&&(s.prop11="Users",s.prop9="userid",s.eVar27=m.page.omnitureErrorMessage||"",s.eVar42=m.page.returnUrl||"",s.hier2="GU/Users/Registration",s.events=s.apl(s.events,m.page.omnitureEvent,",")),s.prop56="Javascript",m.page.productionOffice&&(s.prop64=m.page.productionOffice),s.prop63=e.getPageSpeed(),s.prop65=m.page.headline||"",s.prop67="nextgen-served",s.prop68=e.getConnectionSpeed(d.performance,null,!0),s.prop30=m.page.webPublicationDate?"content":"non-content",""!==s.getQueryParam("INTCMP")&&(s.eVar50=s.getQueryParam("INTCMP")),s.eVar50=s.getValOnce(s.eVar50,"s_intcampaign",0),s.eVar58=navigator.platform||"unknown",m.page.inBodyInternalLinkCount&&(s.prop58=m.page.inBodyInternalLinkCount),m.page.inBodyExternalLinkCount&&(s.prop69=m.page.inBodyExternalLinkCount);var w=n.session.get(f);if(w){var _=(new Date).getTime();_-w.time<6e4&&(s.eVar24=w.pageName,s.eVar37=w.tag,s.events="event37",s.eVar7=w.pageName,s.prop37=w.tag),n.session.remove(u),n.session.remove(f)}s.prop75=m.page.wordCount||0,s.eVar75=m.page.wordCount||0},this.go=function(e){m=e,window.s_account=m.page.omnitureAccount,s=window.s,this.populatePageProperties(),this.logView(),l.emit("analytics:ready")},this.confirmPageView=function(){var e=this,t=setInterval(function(){"undefined"!=typeof s_i_guardian&&(s_i_guardian.complete===!0||s_i_guardian.width+s_i_guardian.height>0)&&(clearInterval(t),e.pageviewSent=!0,l.emit("module:analytics:omniture:pageview:sent"))},250);setTimeout(function(){clearInterval(t)},1e4)},l.on("module:clickstream:interaction",p.trackNonLinkEvent),l.on("module:clickstream:click",p.logTag),l.on("module:autoupdate:loaded",function(){p.populatePageProperties(),p.logUpdate()}),l.on("module:analytics:omniture:pageview:sent",function(){r.fire("/count/pva.gif")})}return d}),define("common/modules/analytics/scrollDepth",["common/utils/mediator","lodash/objects/assign"],function(e,t){function n(e){this.config=t(this.config,e),this.config.isContent&&(this.config.contentEl=this.contentEl||document.getElementById("article")||document.getElementById("live-blog")),this.init()}return n.prototype.config={changeThreshold:10,isContent:!1,pageEl:document.body},n.prototype.data={page:{start:(new Date).getTime(),depth:0,duration:0},content:{depth:0}},n.prototype.timeSince=function(e){return(new Date).getTime()-e},n.prototype.getPercentageInViewPort=function(e){var t=e.getBoundingClientRect(),n=window.innerHeight||document.body.clientHeight;return t.bottom<0||t.bottom<n?100:t.top>n?0:t.top>0?100/(t.height||1)*(n-t.top):100/(t.height||1)*(Math.abs(t.top)+n)},n.prototype.isInViewport=function(e){var t=e.getBoundingClientRect();return t.top<(window.innerHeight||document.body.clientHeight)&&t.left<(window.innerWidth||document.body.clientWidth)},n.prototype.setData=function(e){var t=this.getPercentageInViewPort(this.config[e+"El"]);return t-this.data[e].depth>this.config.changeThreshold?(this.data[e].depth=t,"number"==typeof this.data[e].duration&&(this.data[e].duration=this.timeSince(this.data[e].start)),!0):!1},n.prototype.hasDataChanged=function(){var e=this.setData("page"),t=this.config.isContent?this.setData("content"):!1;(e||t)&&this.log()},n.prototype.assertScrolling=function(){function t(){e.emit("scrolldepth:inactive")}"number"==typeof this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(t.bind(this),1e3)},n.prototype.log=function(){e.emit("scrolldepth:data",this.data)},n.prototype.init=function(){e.on("window:scroll",this.assertScrolling.bind(this)),e.on("scrolldepth:inactive",this.hasDataChanged.bind(this)),e.on("module:clickstream:click",this.hasDataChanged.bind(this))},n}),define("common/modules/analytics/livestats",["common/utils/cookies","common/utils/storage","common/modules/analytics/beacon","common/modules/experiments/ab"],function(e,t,n,o){function i(){var e="gu.session";return"undefined"!=typeof a?a:(t.session.get(e)?a=!1:(t.session.set(e,"true"),a=!0),a)}function s(e,t){var n=[];for(var o in e)n.push(o+"="+encodeURIComponent(e[o]));return t+"?"+n.join("&")}var a,r={log:function(e){var t=o.getAbLoggableObject(e);t.type=i()?"session":"view",n.fire(s(t,"/ab.gif"))}};return r}),define("common/modules/discussion/comment-count",["common/utils/mediator","bonzo","common/utils/ajax"],function(e,t,n){function o(e){var t=e.querySelectorAll("["+c+"]"),n=t.length-1,o="";return Array.prototype.forEach.call(t,function(e,t){o+=e.getAttribute(c),n>t&&(o+=",")}),o}function i(e){return e.getElementsByTagName("a")[0].pathname+"#comments"}function s(e,n){e.forEach(function(e){var o=n.querySelector('[data-discussion-id="'+e.id+'"]');if(o){if("true"===o.getAttribute("data-discussion-closed")&&0===e.count)return;var s=i(o),a=d.replace("[URL]",s);a=a.replace("[LABEL]",1===e.count?"comment":"comments");var r=o.querySelector(".item__meta, .card__meta, .js-append-commentcount"),l=t(r?r:o);l.append(a.replace("[COUNT]",e.count)),o.removeAttribute(c)}})}function a(t){var i=o(t);n({url:l+i,type:"json",method:"get",crossOrigin:!0,success:function(n){n&&n.counts&&(s(n.counts,t),e.emit("modules:commentcount:loaded",n.counts))}})}function r(t){t.querySelector("[data-discussion-id]")&&a(t),e.on("module:trailblock-show-more:render",function(){a(t)}),e.on("modules:related:loaded",function(){a(t)})}var c="data-discussion-id",l="/discussion/comment-counts.json?shortUrls=",d='<span class="trail__count trail__count--commentcount">';return d+='<a href="[URL]" data-link-name="Comment count"><i class="i i-comment-light-grey"></i>[COUNT]',d+='<span class="u-h"> [LABEL]</span></a></span>',{init:r,getCommentCounts:a,getContentIds:o}}),define("common/modules/ui/overlay",["bean","common/utils/mediator","bonzo"],function(e,t,n){function o(o){this.loadingHtml='<div class="preload-msg"><div class="is-updating is-updating--dark"></div></div>',o=o||this.loadingHtml;var i=this,s='<div class="overlay">  <div class="overlay__header u-cf">    <div class="overlay__toolbar u-cf"></div>    <button class="overlay__cta overlay__cta--close js-overlay-close" data-link-name="Close overlay">      <i class="i i-close-icon"></i>    </button>  </div>  <div class="overlay__body">'+o+"</div></div>";n(document.body).append(s),this._savedPos=0,this.node=document.body.querySelector(".overlay"),this.headerNode=this.node.querySelector(".overlay__header"),this.toolbarNode=this.node.querySelector(".overlay__toolbar"),this.bodyNode=this.node.querySelector(".overlay__body"),this.node.style.display="none",e.on(this.node,"click",".js-overlay-close",function(e){e.preventDefault(),i.hide(),t.emit("modules:overlay:close",i)})}return o.prototype.showLoading=function(){this.setBody(this.loadingHtml),this.show()},o.prototype.show=function(){this._savedPos=window.pageYOffset,n(document.body).addClass("has-overlay"),this.node.style.display="block",window.scrollTo(window.pageXOffset,0),t.emit("modules:overlay:show",this)},o.prototype.hide=function(){var e=this;n(document.body).removeClass("has-overlay");var o=0;setTimeout(function(){window.scrollTo(window.pageXOffset,e._savedPos)},o),this.node.style.display="none",t.emit("modules:overlay:hide",this)},o.prototype.setBody=function(e){this.bodyNode.innerHTML=e},o.prototype.remove=function(){this.node.parentNode&&this.node.parentNode.removeChild(this.node)},o}),define("common/modules/gallery/lightbox",["common/utils/$","bean","common/utils/mediator","lodash/functions/debounce","common/utils/ajax","bonzo","qwery","common/utils/detect","common/utils/url","common/modules/ui/overlay"],function(e,t,n,o,i,s,a,r,c,l){function d(d,m){var u,f,p,h,g,v,y,b,w,_=this,k="/"+d.page.pageId,x=1,C=0,T="fullimage",j=5e3,S=!0;this.selector=".js-gallerythumbs",this.galleryEndpoint="",this.init=function(n){_.opts=n||{},e(_.selector+" a",m).attr("data-is-ajax","1"),t.on(m,"click",_.selector,function(t){t.preventDefault();var n=t.currentTarget,o=e(n).attr("data-gallery-url");if(!o){var i="A"===n.nodeName?n:n.querySelector("a");o=i.getAttribute("href")}if(-1!==o.indexOf("index=")){var s=c.getUrlVars({query:o.split("?")[1]});x=parseInt(s.index,10)}_.loadGallery({url:o})});var o=c.getUrlVars();o.index&&this.loadGallery({url:"/"+d.page.pageId,startingImage:parseInt(o.index,10)})},this.bindEvents=function(){t.on(p.toolbarNode,"touchstart click",".js-gallery-grid",this.switchToGrid),t.on(p.toolbarNode,"touchstart click",".js-gallery-full",this.switchToFullImage),t.on(p.toolbarNode,"click",".js-start-slideshow",this.startSlideshow),t.on(p.toolbarNode,"click",".js-stop-slideshow",this.stopSlideshow),t.on(p.bodyNode,"click",".js-gallery-prev",this.prev),t.on(p.bodyNode,"click",".js-gallery-next",this.next),t.on(p.bodyNode,"click",".js-load-gallery",this.loadGallery),t.on(p.bodyNode,"click",".js-toggle-furniture",this.toggleFurniture),t.on(p.bodyNode,"click",".gallery--fullimage-mode .gallery__item",function(t){if(h&&!g){var n=a(".js-gallery-item-"+x,u)[0],o=!1;
if(e(".gallerycaption, .captioncontrol",n).each(function(e){s.isAncestor(e,t.target)&&(o=!0)}),o)return;var i=t.pageX/u.offsetWidth*100;25>i?_.swipe.prev():_.swipe.next()}}),t.on(p.bodyNode,"touchmove",".gallery__item",function(){g=!0,_.stopSlideshow()}),t.on(p.bodyNode,"touchend",".gallery__item",function(){setTimeout(function(){g=!1},250)}),t.on(p.bodyNode,"click",".gallery--grid-mode .gallery__item",function(e){var t=parseInt(e.currentTarget.getAttribute("data-index"),10);_.goTo(t)}),n.addListener("window:orientationchange",function(){_.layout(),"landscape"===r.getOrientation()&&_.jumpToContent()}),n.addListener("window:resize",function(){_.layout()}),n.on("modules:overlay:hide",function(){t.off(p.toolbarNode,"click"),t.off(p.bodyNode,"click touchmove touchend"),t.off(document.body,"keydown",_.handleKeyEvents),_.removeOverlay(),_.stopSlideshow(),S&&c.pushUrl({},document.title,k,!0)}),t.on(window,"popstate",function(e){e.state&&e.state.lightbox&&e.state.currentImage?_.goTo(e.state.currentImage,{dontUpdateUrl:!0}):e.state&&e.state.lightbox&&!e.state.currentImage&&(setTimeout(function(){p.hide(),_.removeOverlay()},10),t.off(document.body,"keydown",_.handleKeyEvents),n.emit("module:clickstream:interaction","Lightbox Gallery - Back button exit"))})},this.handleKeyEvents=function(e){37===e.keyCode?(_.prev(),_.trackInteraction("keyboard:previous")):39===e.keyCode?(_.next(),_.trackInteraction("keyboard:next")):27===e.keyCode&&p.hide()},this.loadGallery=function(o){h=!1,p=new l,p.showLoading(),this.galleryEndpoint=o.url.split("?")[0]+"/lightbox.json",this.bindEvents(),o.startingImage&&(x=o.startingImage),i({url:_.galleryEndpoint,type:"json",method:"get",crossOrigin:!0,success:function(o){_.galleryUrl="/"+o.config.page.pageId,p.setBody(o.html),u=a(".gallery--lightbox",p.bodyNode)[0],b=e(".gallery__nav",u),w=e(".gallery__img",u),C=parseInt(u.getAttribute("data-total"),10),c.pushUrl({lightbox:!0},document.title,_.galleryUrl),f=a(".gallery__images",u)[0],y=f.innerHTML,(!x||x>C)&&(x=1),_.layout(),_.setupOverlayHeader(),_.goTo(x),t.on(document.body,"keydown",_.handleKeyEvents),n.emit("module:lightbox-gallery:loaded",o.config,u)},error:function(){var e='<div class="preload-msg">Error loading gallery  <button class="cta js-load-gallery" data-link-name="Try loading gallery again" data-is-ajax>Try again</button></div>';p.setBody(e)}})},this.setupOverlayHeader=function(){var e='<button class="overlay__cta js-gallery-grid" data-link-name="Gallery grid mode">  <i class="i i-gallery-thumb-icon"></i> </button><button class="overlay__cta js-gallery-full" data-link-name="Gallery full image mode">  <i class="i i-gallery-fullimage-icon"></i> </button><button class="overlay__cta js-start-slideshow" data-link-name="Gallery start slideshow">  <i class="i i-gallery-play-slideshow"></i> </button><button class="overlay__cta js-stop-slideshow" data-link-name="Gallery stop slideshow">  <i class="i i-gallery-pause-slideshow"></i> </button><div class="overlay__cta gallery__counter">  <span class="js-image-index gallery__counter--current-image"></span> | '+C+"</div>";p.toolbarNode.innerHTML=e,_.imageIndexNode=p.toolbarNode.querySelector(".js-image-index"),_.gridModeCta=p.headerNode.querySelector(".js-gallery-grid"),_.fullModeCta=p.headerNode.querySelector(".js-gallery-full"),p.toolbarNode.querySelector(".js-stop-slideshow").style.display="none"},this.removeOverlay=o(function(){return p.remove(),!0},500),this.prev=function(e){e&&e.preventDefault(),_.stopSlideshow(),h?_.swipe.prev():_.goTo(x-1)},this.next=function(e){e&&e.preventDefault(),_.stopSlideshow(),h?_.swipe.next():_.goTo(x+1)},this.goTo=function(t,n){n=n||{},t>C?t=1:1>t&&(t=C),e(".gallery__item",p.bodyNode).each(function(e){var n=parseInt(e.getAttribute("data-index"),10);n===t?(s(e).addClass("gallery__item--active"),_.currentImageNode=e):s(e).removeClass("gallery__item--active")}),x=t,_.imageIndexNode.innerHTML=x,_.switchToFullImage(),n.dontUpdateUrl||_.pushUrlState()},this.switchToGrid=function(t){v&&_.stopSlideshow(),h&&_.removeSwipe(),T="grid",s(u).removeClass("gallery--fullimage-mode").addClass("gallery--grid-mode"),e(".gallery__img",p.bodyNode).each(function(e){e.src=e.getAttribute("data-src")}),_.gridModeCta.style.display="none",_.fullModeCta.style.display="block",_.layout(),t&&t.preventDefault()},this.switchToFullImage=function(e){T="fullimage",!r.hasTouchScreen()||h||_.opts.disableSwipe||v||_.setupSwipe(),s(u).removeClass("gallery--grid-mode").addClass("gallery--fullimage-mode"),_.gridModeCta.style.display="block",_.fullModeCta.style.display="none",_.layout(),_.preloadImages(),e&&e.preventDefault()},this.preloadImages=function(){Array.prototype.forEach.call(w,function(e,t){(t===x-1||t===x)&&(e.src=e.getAttribute("data-fullsrc"))})},this.toggleFurniture=function(){s(u).toggleClass("gallery--hide-furniture"),_.layout()},this.layout=function(){var t=s.viewport().height-p.headerNode.offsetHeight;h&&(u.style.height=a(".js-gallery-item-"+x,u)[0].offsetHeight+"px"),w=e(".gallery__img",u);var n=e(".gallery__item",u);"fullimage"===T?(w.css({"max-height":t+"px",width:"auto","max-width":"100%"}),n.css("height",t+"px")):(w.removeAttr("style"),n.removeAttr("style"))},this.jumpToContent=function(){window.scrollTo(0,p.headerNode.offsetHeight)},this.setupSwipe=function(){require(["js!swipe"],function(){s(u).addClass("gallery--swipe"),_.swipe=new Swipe(u,{startSlide:x-1,speed:200,continuous:!0,callback:function(e){var t=e+1>x?"next":"prev";_.trackInteraction("Lightbox gallery swipe - "+t),x=e+1,_.imageIndexNode.innerHTML=x,_.layout(),_.preloadImages(),_.pushUrlState()}}),h=!0})},this.removeSwipe=function(){_.swipe.kill(),s(f).removeAttr("style").html(y),s(u).removeClass("gallery--swipe").css("height","auto"),h=!1},this.pushUrlState=function(e){if(e=e||{},S){var t={lightbox:!0,currentImage:x};c.pushUrl(t,document.title,_.galleryUrl+"?index="+x,e.replace)}},this.trackInteraction=function(e){n.emit("module:clickstream:interaction",e)},this.startSlideshow=function(){v=!0,s(u).addClass("gallery--slideshow"),a(".js-start-slideshow",p.toolbarNode)[0].style.display="none",a(".js-stop-slideshow",p.toolbarNode)[0].style.display="block",h&&_.removeSwipe(),_.goTo(x),_.slideshowTimer=setInterval(function(){_.goTo(x+1)},j)},this.stopSlideshow=function(){v&&(v=!1,s(u).removeClass("gallery--slideshow"),a(".js-start-slideshow",p.toolbarNode)[0].style.display="block",a(".js-stop-slideshow",p.toolbarNode)[0].style.display="none",clearInterval(_.slideshowTimer),_.goTo(x))}}return d}),define("common/modules/onward/sequence",["bean","common/utils/ajax","common/utils/mediator","common/utils/storage","common/utils/config","lodash/collections/filter","common/modules/onward/history"],function(e,t,n,o,i,s,a){function r(e,t){y.set(b[e],t),n.emit("modules:sequence:"+e+":loaded",t)}function c(e){return y.get(b[e])}function l(){var e=c("sequence");return e?{name:e.name,items:u(e.items)}:null}function d(){return{name:c("contextName"),path:c("contextPath")}}function m(){y.remove(b.contextName),y.remove(b.contextPath)}function u(e){var t=new a({}).get().map(function(e){return e.id});return s(e,function(e){return t.indexOf(e.url)<0&&e.url!==v})}function f(){var e="page"in i&&""!==i.page.section?"/"+i.page.section:"";return{path:"most-read"+e}}function p(e){t({url:"/"+e.path+".json",type:"json",crossOrigin:!0}).then(function(t){t&&"trails"in t&&(r("sequence",{name:e.name,items:u(t.trails)}),m(),n.emit("modules:sequence:loaded",l()))}).fail(function(e){n.emit("modules:error","Failed to load sequence: "+e.statusText,"common/modules/onwards/sequence.js")})}function h(){n.on("module:clickstream:click",function(e){e.sameHost&&!e.samePage&&e.linkContextPath&&(r("contextPath",e.linkContextPath),r("contextName",e.linkContextName))})}function g(e){var t=d();v=e,null!==t.path?p(t):null===l()?p(f()):n.emit("modules:sequence:loaded",l()),h()}var v,y=o.session,b={contextName:"gu.context.name",contextPath:"gu.context.path",sequence:"gu.sequence"};return{getSequence:l,getContext:d,init:g}}),define("common/modules/ui/message",["common/utils/$","bean","common/utils/storage","common/modules/userPrefs","lodash/arrays/uniq"],function(e,t,n,o,i){var s=function(e,t){var n=t||{};this.id=e,this.important=n.important||!1,this.permanent=n.permanent||!1,this.type=n.type||"banner",this.prefs="messages"};return s.prototype.show=function(n){return!e(".site-message").hasClass("is-hidden")&&!this.important||this.hasSeen()?!1:(e(".js-site-message-copy").html(n),e(".site-message").addClass("site-message--"+this.type).addClass("site-message--"+this.id),e(".site-message").removeClass("is-hidden"),this.permanent?(e(".site-message").addClass("site-message--permanent"),e(".site-message__close").addClass("is-hidden")):t.on(document,"click",".js-site-message-close",this.acknowledge.bind(this)),void("modal"===this.type&&this.bindModalListeners()))},s.prototype.bindModalListeners=function(){t.on(document,"click",".js-site-message-inner",function(e){e.stopImmediatePropagation(),e.stopPropagation()}),t.on(document,"click",".js-site-message",this.acknowledge.bind(this))},s.prototype.hide=function(){e("#header").removeClass("js-site-message"),e(".site-message").addClass("is-hidden")},s.prototype.hasSeen=function(){var e=o.get(this.prefs);return e&&e.indexOf(this.id)>-1},s.prototype.remember=function(){var e=o.get(this.prefs)||[];e.push(this.id),o.set(this.prefs,i(e))},s.prototype.acknowledge=function(){this.remember(),this.hide()},s}),define("common/modules/identity/facebook-authorizer",[""],function(){function e(e){n=this,this.appId=e,this.onConnected=new t,this.onFBScriptLoaded=new t,this.onUserDataLoaded=new t,this.onNotAuthorized=new t,this.onNotLoggedIn=new t,this.cancelledLogin=new t}function t(){this.callbacks=[]}var n=null;e.DEFAULT_PERMISSIONS={scope:"email,publish_actions,publish_stream"},e.prototype.onConnected=null,e.prototype.onFBScriptLoaded=null,e.prototype.onUserDataLoaded=null,e.prototype.onNotAuthorized=null,e.prototype.onNotLoggedIn=null,e.prototype.cancelledLogin=null,e.accessToken=null,e.userId=null,e.userData=null,e.prototype.login=function(t,n){return(n||!this.accessToken&&!this.loginPending)&&(this.cancelledLogin.reset(),this.onConnected.reset(),this.loginPending=!0,this._loadFacebookAPI().then(function(n){n.login(this._handleGotLoginStatus.bind(this,!0),t||e.DEFAULT_PERMISSIONS)}.bind(this))),this.onConnected},e.prototype.getLoginStatus=function(t){return this.loginStatusPending||(this.loginStatusPending=!0,this._loadFacebookAPI().then(function(n){n.getLoginStatus(this._handleGotLoginStatus.bind(this,!1),t||e.DEFAULT_PERMISSIONS)}.bind(this))),this.onConnected};var o="facebook-jssdk";return e.prototype._handleGotLoginStatus=function(e,t){switch(this.loginStatusPending=!1,this.loginPending=!1,t.status){case"connected":this.accessToken=t.authResponse.accessToken,this.userId=t.authResponse.userID,this._getUserData(),this.onConnected.resolve(FB,t.authResponse);break;case"not_authorized":this._getUserData(),this.onNotAuthorized.resolve(this);break;default:e&&this.cancelledLogin.resolve(),this.onNotLoggedIn.resolve()}},e.prototype._getUserData=function(){FB.api("/me",this._handleGotUserData.bind(this))},e.prototype._handleGotUserData=function(e){e&&!e.error&&(this.userData=e,this.onUserDataLoaded.resolve(e))},e.prototype._loadFacebookAPI=function(){return window.FB?this.onFBScriptLoaded.resolve(window.FB):document.getElementById(o)||this._requiredAlready||(this._requiredAlready=!0,this._loadFacebookScript()),this.onFBScriptLoaded},e.prototype._loadFacebookScript=function(){require(["js!facebook"],this._handleScriptLoaded.bind(this))},e.prototype._handleScriptLoaded=function(){FB.init({appId:this.appId,status:!0,cookie:!0,xfbml:!0}),this.onFBScriptLoaded.resolve(FB)},e.prototype.destroy=function(){n=null},t.prototype.resolve=function(){this.args=Array.prototype.slice.apply(arguments);var e,t=this.callbacks.length;for(e=0;t>e;e++)this.callbacks[e].apply(null,this.args);this.callbacks=[]},t.prototype.then=function(e){void 0!==this.args?e.apply(null,this.args):this.callbacks.push(e)},t.prototype.reset=function(){this.args=void 0},e}),define("common/modules/identity/autosignin",["common/utils/ajax","bonzo","common/modules/identity/api","common/modules/identity/facebook-authorizer","common/modules/navigation/profile","common/utils/storage","common/modules/userPrefs","common/utils/time","common/modules/ui/message"],function(e,t,n,o,i,s,a,r,c){function l(t){this.config=t;var s=this;s.header=document.body,this.init=function(){if(n.shouldAutoSigninInUser()){var e=this.config.page.fbAppId,t=new o(e);t.getLoginStatus(),t.onConnected.then(function(e,n){t.onUserDataLoaded.then(function(e){e.email&&s.signin(n,e.name)})}),t.onNotLoggedIn.then(function(){var e=r.currentDate();n.setNextFbCheckTime(e.setDate(e.getDate()+1))}),t.onNotAuthorized.then(function(){var e=r.currentDate();n.setNextFbCheckTime(e.setMonth(e.getMonth()+1))})}},this.signin=function(t,n){e({url:s.config.page.idWebAppUrl+"/jsapi/facebook/autosignup",cache:!1,crossOrigin:!0,type:"jsonp",data:{signedRequest:t.signedRequest,accessToken:t.accessToken},success:function(e){if(s.welcome(n),"ok"===e.status){var t=new i(s.header,{url:s.config.page.idUrl});t.init()}}})},this.welcome=function(e){var t='<p class="site-message__message">Welcome '+e+", you're signed into the Guardian using Facebook, or <a href=\""+s.config.page.idUrl+'/signout"/>sign out</a>.</p>';new c("fbauto",{important:!0}).show(t)}}return l}),define("common/modules/analytics/foresee-survey",["common/utils/cookies"],function(e){function t(){return e.add("fsr.sp","%7B%22mobile_web%22%3A%22100%22%7D",1)}function n(){var e=125*Math.random()<1,n=/forceForesee/.test(location.hash);n&&t(),(e||n)&&require(["js!foresee"],function(){})}return{load:n}}),define("common/modules/onward/geo-most-popular",["qwery","lodash/objects/assign","common/modules/component","common/modules/analytics/register"],function(e,t,n,o){function i(n){o.begin("geo-most-popular"),this.config=t(this.config,n),this.fetch(e(".js-components-container"),"rightHtml")}return n.define(i),i.prototype.endpoint="/most-read-geo.json",i.prototype.ready=function(){o.end("geo-most-popular")},i}),define("common/modules/onward/tonal",["common/utils/mediator","common/modules/analytics/register","common/modules/ui/images","common/modules/component"],function(e,t,n,o){function i(e,n){t.begin("tonal-content"),this.config=e,this.context=n,this.edition=this.config.page.edition.toLowerCase(),this.isSupported()?this.endpoint=this.getEndpoint():this.fetch=s}var s=function(){};return o.define(i),i.prototype.tones={features:"-alpha/features/feature-stories.json",comment:"-alpha/contributors/feature-stories.json"},i.prototype.getEndpoint=function(){return"/container/"+this.edition+this.tones[this.getTone()]},i.prototype.isSupported=function(){return this.getTone()in this.tones},i.prototype.getTone=function(){return this.config.page.tones.split(",")[0].toLowerCase()},i.prototype.ready=function(){n.upgrade(this.context),t.end("tonal-content")},i.prototype.error=function(){e.emit("module:error","Failed to load tone:"+this.getTone()+"common/modules/related.js"),t.error("tonal-content")},i}),define("common/modules/onward/more-tags",["common/utils/$","bean"],function(e,t){function n(){this.init=function(){var n=e(".js-more-tags");0!==n.length&&(n.removeClass("js-hidden"),t.on(document.querySelector(".js-more-tags__link"),"click",function(){e(".js-hidden-tag").removeClass("js-hidden"),n.addClass("js-hidden")}))}}return n}),define("common/modules/ui/smartAppBanner",["common/utils/storage","common/utils/template","common/modules/userPrefs","common/modules/ui/message"],function(e,t,n,o){function i(){return d||m}function s(){return 4>u}function a(){var n=d?"ios":"android",i=new o(n);i.show(t(f,l[n.toUpperCase()])),e.local.set(c,u+1)}function r(){i()&&s()&&a()}var c="gu.ads.appOnboardCount",l={IOS:{LOGO:"http://assets.guim.co.uk/images/apps/ios-logo.png",SCREENSHOTS:"http://assets.guim.co.uk/images/apps/ios-screenshots.jpg",LINK:"http://ad-x.co.uk/API/click/guardian789057jo/web3537df56ab1f7e",STORE:"on the App Store"},ANDROID:{LOGO:"http://assets.guim.co.uk/images/apps/android-logo-2x.png",SCREENSHOTS:"http://assets.guim.co.uk/images/apps/ios-screenshots.jpg",LINK:"http://ad-x.co.uk/API/click/guardian789057jo/web3537df5992e76b",STORE:"in Google Play"}},d=/(iPad|iPhone|iPod touch);.*CPU.*OS 7_\d/i.test(navigator.userAgent),m=/Android/i.test(navigator.userAgent),u=e.local.get(c)?parseInt(e.local.get(c),10):0,f='<img src="{{LOGO}}" class="app__logo" alt="Guardian App logo" /><div class="app__cta"><h4 class="app__heading">The Guardian app</h4><p class="app__copy">Instant alerts. Offline reading.<br/>Tailored to you.</p><p class="app__copy"><strong>FREE</strong>  {{STORE}}</p></div><a href="{{LINK}}" class="app__link">View</a><img src="{{SCREENSHOTS}}" class="app__screenshots" alt="screenshots" />';return{init:r}}),define("common/modules/analytics/discussion",["common/utils/$","bonzo","common/utils/mediator","common/modules/identity/api"],function(e,t,n,o){var i={};i.seen=!1,i.getLinkTrackVars=function(e){e=e||[];var t=["events","prop4","prop6","prop8","prop10","prop13","prop19","prop31","prop51","prop75","eVar7","eVar8","eVar19","eVar31","eVar51","eVar66"];return t.concat(e).join(",")},i.comment=function(e){s.events="event51",s.eVar66=o.getUserFromCookie().id||null,s.eVar68=e.replyTo?"response":"comment",s.eVar67=e.replyTo?e.replyTo.authorId:null,s.linkTrackVars=this.getLinkTrackVars(["eVar68"]),s.linkTrackEvents="event51",s.tl(!0,"o","comment")},i.recommend=function(e){s.events="event72",s.eVar65="recommendation",s.eVar66=o.getUserFromCookie()?o.getUserFromCookie().id:null,s.eVar67=e.userId,s.linkTrackVars=this.getLinkTrackVars(["eVar65","eVar67"]),s.linkTrackEvents="event72",s.tl(!0,"o","Recommend a comment")},i.jumpedToComments=function(){i.seen||(s.events="event72",s.eVar65="seen jump-to-comments",s.eVar66=o.getUserFromCookie()?o.getUserFromCookie().id:null,s.linkTrackVars=this.getLinkTrackVars(["eVar65"]),s.linkTrackEvents="event72",s.tl(!0,"o","seen jump-to-comments"),i.seen=!0)},i.commentPermalink=function(){i.seen||(s.events="event72",s.eVar65="seen comment-permalink",s.eVar66=o.getUserFromCookie()?o.getUserFromCookie().id:null,s.linkTrackVars=this.getLinkTrackVars(["eVar65"]),s.linkTrackEvents="event72",s.tl(!0,"o","seen comment-permalink"),i.seen=!0)},i.scrolledToComments=function(){i.seen||(s.events="event72",s.eVar65="seen scroll-top",s.eVar66=o.getUserFromCookie()?o.getUserFromCookie().id:null,s.linkTrackVars=this.getLinkTrackVars(["eVar65"]),s.linkTrackEvents="event72",s.tl(!0,"o","seen scroll-top"),i.seen=!0)},i.areCommentsSeen=function(){var e,t=function(){i.seen||e||!i.areCommentsVisible()||(i.scrolledToComments(),n.off("window:scroll",t))};i.seen||n.on("window:scroll",t)},i.areCommentsVisible=function(){var n=e("#comments").offset(),o=e("body").first().scrollTop(),i=t.viewport().height;return n.top-i/2<o&&n.top+n.height-i/3>o?!0:!1};var a=function(){n.on("discussion:commentbox:post:success",i.comment.bind(i)),n.on("discussion:comment:recommend:success",i.recommend.bind(i)),n.on("discussion:seen:comment-permalink",i.commentPermalink.bind(i)),n.on("discussion:seen:comments-anchor",i.jumpedToComments.bind(i)),n.on("discussion:seen:comments-scrolled-to",i.scrolledToComments.bind(i)),i.areCommentsSeen()};return{init:a}}),define("common/modules/discussion/user-avatars",["common/utils/$","bonzo","common/modules/discussion/api"],function(e,t,n){function o(){e(".user-avatar").each(i)}function i(e){var o=t(e),i=t(t.create('<div class="is-updating"></div>')),s=t(t.create('<img class="user-avatar__image" alt="" />')),a=o.data("userid");o.removeClass("is-hidden"),i.css("display","block").appendTo(o),n.getUser(a).then(function(e){s.attr("src",e.userProfile.secureAvatarUrl),i.remove(),s.appendTo(o)})}return{init:o,avatarify:i}}),define("common/modules/identity/validation-email",["bean","bonzo","common/utils/mediator","common/modules/identity/api"],function(e,t,n,o){return{init:function(i){var s=i.querySelector(".js-id-send-validation-email");if(s){var a=t(s);e.on(s,"click",function(e){e.preventDefault(),o.isUserLoggedIn()&&o.sendValidationEmail().then(function(e){"error"===e.status?(n.emit("module:identity:validation-email:fail"),a.innerHTML="An error occured, please click here to try again."):(n.emit("module:identity:validation-email:success"),a.replaceWith("<p>Sent. Please check your email and follow the link.</p>"))},function(){n.emit("module:identity:validation-email:fail"),a.innerHTML="An error occured, please click here to try again."})})}}}}),define("common/modules/discussion/comment-box",["common/utils/$","bean","bonzo","common/utils/config","common/utils/context","common/utils/mediator","common/modules/discussion/api","common/modules/identity/api","common/modules/component","common/modules/discussion/user-avatars","common/modules/identity/validation-email"],function(e,t,n,o,i,s,a,r,c,l,d){function m(e){this.context=i(),this.mediator=s,this.setOptions(e),s.on("module:identity:validation-email:success",this.verificationEmailSuccess.bind(this)),s.on("module:identity:validation-email:fail",this.verificationEmailFail.bind(this))}return c.define(m),m.prototype.useBem=!0,m.prototype.templateName="comment-box",m.prototype.componentClass="d-comment-box",m.prototype.classes={},m.prototype.errorMessages={EMPTY_COMMENT_BODY:"Please write a comment.",COMMENT_TOO_LONG:"Your comment must be fewer than 5000 characters long.",COMMENT_NEEDS_SENTIMENT:"Please select yes or no.",ENHANCE_YOUR_CALM:"You can only post one comment every minute. Please try again in a moment.",USER_BANNED:'Commenting has been disabled for this account (<a href="/community-faqs#321a">why?</a>).',API_ERROR:"Sorry, there was a problem posting your comment.",EMAIL_VERIFIED:'<span class="d-comment-box__error-meta">Sent. Please check your email to verify '+(r.getUserFromCookie()?r.getUserFromCookie().primaryEmailAddress:" your email address")+". Once verified post your comment.</span>",EMAIL_VERIFIED_FAIL:'We are having technical difficulties. Please try again later or <a href="/send/email" class="js-id-send-validation-email"><strong>resend the verification</strong></a>.',EMAIL_NOT_VERIFIED:'Please confirm your email address to post your first comment.<br /><a href="_#" class="js-id-send-validation-email"><strong>Send verification email</strong></a><span class="d-comment-box__error-meta"> to '+(r.getUserFromCookie()?r.getUserFromCookie().primaryEmailAddress:" your email address")+".</span>"},m.prototype.defaultOptions={discussionId:null,apiRoot:null,maxLength:5e3,premod:!1,focus:!1,state:"top-level",replyTo:null,switches:{},priorToVerificationDate:new Date(1392719401337)},m.prototype.errors=[],m.prototype.getUserData=function(){return r.getUserFromCookie()},m.prototype.prerender=function(){this.options.premod||this.getElem("premod").parentNode.removeChild(this.getElem("premod"));var e=this.getUserData();if(this.getElem("author").innerHTML=e.displayName,"response"===this.options.state)this.getElem("submit").innerHTML="Post reply";else{var t=this.getElem("avatar-wrapper");t.setAttribute("userid",e.id),l.avatarify(t)}if(this.options.replyTo){var n=this.getElem("reply-to-author");n.innerHTML=this.options.replyTo.author,this.getElem("parent-comment-author").innerHTML=this.options.replyTo.author+" @ "+this.options.replyTo.timestamp+" said:",this.getElem("parent-comment-body").innerHTML=this.options.replyTo.body;var o=function(){var e=n.offsetLeft+n.getBoundingClientRect().width/2;this.getElem("parent-comment-spout").style.marginLeft=e+"px"};window.setTimeout(o.bind(this),0)}},m.prototype.ready=function(){if(null===this.getDiscussionId())throw new Error('CommentBox: You need to set the "data-discussion-key" on your element');var n=this.getElem("body");if(this.setFormState(),t.on(this.context,"submit",[this.elem],this.postComment.bind(this)),t.on(this.context,"change keyup",[n],this.setFormState.bind(this)),t.on(n,"focus",this.setExpanded.bind(this)),this.on("click",this.getClass("preview"),this.previewComment),this.on("click",this.getClass("hide-preview"),this.resetPreviewComment),this.on("click",this.getClass("cancel"),this.cancelComment),this.on("click",this.getClass("show-parent"),this.setState.bind(this,"parent-visible",!1)),this.on("click",this.getClass("hide-parent"),this.removeState.bind(this,"parent-visible",!1)),this.on("click",this.getClass("formatting-bold"),this.formatComment.bind(this,"bold")),this.on("click",this.getClass("formatting-italic"),this.formatComment.bind(this,"italic")),this.on("click",this.getClass("formatting-quote"),this.formatComment.bind(this,"quote")),this.on("click",this.getClass("formatting-link"),this.formatComment.bind(this,"link")),this.setState(this.options.state),this.options.focus&&this.getElem("body").focus(),o.switches.sentimentalComments){var i="d-comment-box__sentiment--active";e('.open a[href="#comments"]').each(function(n){e(".d-discussion").addClass("d-discussion--sentimental"),e(".discussion__show-threaded").remove(),this.setState("sentimental"),this.options.maxLength=350,e.create("<div>"+e(".open__head__accent").text()+"</div>").addClass("d-comment-box__sentiments-head tone-news tone-colour").insertAfter(this.getElem("sentiments")),t.on(n,"click",function(e){this.getElem("body").focus(),e.preventDefault()}.bind(this)),t.on(this.elem,"click",this.getClass("sentiment"),function(t){e("."+i,this.elem).removeClass(i),e(t.currentTarget).addClass(i),this.elem.sentiment.value=t.currentTarget.getAttribute("data-value"),this.getElem("body").focus()}.bind(this))}.bind(this))}},m.prototype.postComment=function(e){var t=this,n={body:this.elem.body.value};this.elem.sentiment.value&&(n.sentiment=this.elem.sentiment.value),e.preventDefault(),t.clearErrors();var o=function(){""===n.body&&t.error("EMPTY_COMMENT_BODY"),n.body.length>t.options.maxLength&&t.error("COMMENT_TOO_LONG","<b>Comments must be shorter than "+t.options.maxLength+" characters.</b>Yours is currently "+(n.body.length-t.options.maxLength)+" character(s) too long."),t.hasState("sentimental")&&!n.sentiment&&t.error("COMMENT_NEEDS_SENTIMENT"),t.options.replyTo&&(n.replyTo=t.options.replyTo),0===t.errors.length&&(t.setFormState(!0),a.postComment(t.getDiscussionId(),n).then(t.postCommentSuccess.bind(t,n),t.fail.bind(t)))},i=function(){t.error("EMAIL_NOT_VERIFIED"),d.init(t.context)};if(t.getUserData().emailVerified)o();else{var s=new Date(t.getUserData().accountCreatedDate);s>t.options.priorToVerificationDate?r.getUserFromApiWithRefreshedCookie().then(function(e){e.user.statusFields.userEmailValidated===!0?o():i()}):o()}},m.prototype.error=function(e,t){t=t||this.errorMessages[e],this.setState("invalid");var o=n.create('<div class="d-discussion__error '+this.getClass("error",!0)+'"><i class="i i-alert"></i><span class="d-discussion__error-text">'+t+"</span></div>")[0];this.getElem("messages").appendChild(o),this.errors.push(e)},m.prototype.postCommentSuccess=function(e,t){e.id=parseInt(t.message,10),this.getElem("body").value="",this.resetPreviewComment(),this.setFormState(),this.emit("post:success",e),this.mediator.emit("discussion:commentbox:post:success",e)},m.prototype.fail=function(e){var t;try{t=JSON.parse(e.responseText)}catch(n){t={}}this.setFormState(),this.error(420===e.status?"ENHANCE_YOUR_CALM":this.errorMessages[t.errorCode]?t.errorCode:"API_ERROR")},m.prototype.previewCommentSuccess=function(e,t){this.getElem("preview-body").innerHTML=t.commentBody,this.setState("preview-visible")},m.prototype.getDiscussionId=function(){return this.options.discussionId||this.elem.getAttribute("data-discussion-key").replace("discussion","")},m.prototype.setFormState=function(e){e="boolean"==typeof e?e:!1;var t=this.getElem("body"),n=this.getElem("submit");e||0===t.value.length?n.setAttribute("disabled","disabled"):n.removeAttribute("disabled")},m.prototype.clearErrors=function(){this.getElem("messages").innerHTML="",this.errors=[],this.removeState("invalid")},m.prototype.setExpanded=function(){this.setState("expanded")},m.prototype.verificationEmailSuccess=function(){this.clearErrors(),this.error("EMAIL_VERIFIED")},m.prototype.verificationEmailFail=function(){this.clearErrors(),this.error("EMAIL_VERIFIED_FAIL")},m.prototype.previewComment=function(e){var t=this,n={body:this.getElem("body").value};e.preventDefault(),t.clearErrors(),""===n.body&&(this.resetPreviewComment(),t.error("EMPTY_COMMENT_BODY")),n.body.length>t.options.maxLength&&t.error("COMMENT_TOO_LONG","<b>Comments must be shorter than "+t.options.maxLength+" characters.</b>Yours is currently "+(n.body.length-t.options.maxLength)+" characters too long."),0===t.errors.length&&a.previewComment(n).then(t.previewCommentSuccess.bind(t,n),t.fail.bind(t))},m.prototype.cancelComment=function(){"response"===this.options.state?this.destroy():(this.resetPreviewComment(),this.getElem("body").value="",this.setFormState(),this.removeState("expanded"))},m.prototype.resetPreviewComment=function(){this.removeState("preview-visible"),this.getElem("preview-body").innerHTML=""},m.prototype.formatComment=function(e){var t=this.getElem("body"),n=t.selectionStart,o=t.value.substring(t.selectionStart,t.selectionEnd),i=function(e,n){var i=e+o+n;t.value=t.value.substring(0,t.selectionStart)+i+t.value.substring(t.selectionEnd),a(i)},s=function(){var e;e=/^https?:\/\//i.test(o)?o:"http://";var n='<a href="'+e+'">'+o+"</a>";t.value=t.value.substring(0,t.selectionStart)+n+t.value.substring(t.selectionEnd),a(n)},a=function(e){t.setSelectionRange(n,n+e.length)};switch(e){case"bold":i("<b>","</b>");break;case"italic":i("<i>","</i>");break;case"quote":i("<blockquote>","</blockquote>");break;case"link":s()}},m}),define("common/modules/discussion/recommend-comments",["bean","qwery","common/utils/mediator","common/modules/discussion/api","common/modules/identity/api"],function(e,t,n,o,i){var s={};return s.CONFIG={classes:{button:"js-recommend-comment",count:"js-recommend-count",active:"d-comment__recommend--active",userRecommended:"d-comment__recommend--user-recommended",open:"d-discussion--recommendations-open"},events:{prefix:"discussion:comment:recommend:",init:"initialised",success:"success",fail:"fail"}},s.init=function(e,o){var a;this.open=this.open||t("."+s.CONFIG.classes.open,e).length>0,this.open&&(a=t("."+s.CONFIG.classes.button,e));for(var r in o)s.options[r]=o[r];a&&(Array.prototype.forEach.call(a,function(e){var t=i.getUserFromCookie(),n=t?t.id:null,o=e.getAttribute("data-user-id")===n;n&&o||(e.className=e.className+" "+s.CONFIG.classes.active,e.title=e.title+=" - recommend this comment")}),s.bindEvents(e),n.emit(s.getEvent("init")))},s.bindEvents=function(t){e.on(t,"click","."+s.CONFIG.classes.active,s.handleClick)},s.handleClick=function(e){var t=e.currentTarget,n=t.getAttribute("data-comment-id"),o=s.recommendComment(n);return t.className=t.className.replace(s.CONFIG.classes.active,""),s.renderRecommendation(t),o.then(s.success.bind(t),s.fail.bind(t))},s.recommendComment=function(e){return o.recommendComment(e)},s.success=function(){n.emit(s.getEvent("success"),{id:parseInt(this.getAttribute("data-comment-id"),10),userId:parseInt(this.getAttribute("data-user-id"),10),count:parseInt(this.getAttribute("data-recommend-count"),10)})},s.fail=function(e){var t="NOT FOUND"!==e.responseText&&""!==e.responseText?JSON.parse(e.responseText):{};s.renderRecommendation(this,!0),"CAN'T_RECOMMEND_SAME_COMMENT_TWICE"===t.errorCode&&(this.className=this.className.replace(s.CONFIG.classes.active,""),this.title="You cannot recommend the same comment twice"),this.className=this.className+" "+s.CONFIG.classes.button,n.emit(s.getEvent("fail"),{id:parseInt(this.getAttribute("data-comment-id"),10),count:parseInt(this.getAttribute("data-recommend-count"),10),errorCode:t.errorCode})},s.renderRecommendation=function(e,t){var n=parseInt(e.getAttribute("data-recommend-count"),10),o=t?n-1:n+1;e.className=t?(e.className+" "+s.CONFIG.classes.active).replace(s.CONFIG.classes.userRecommended,""):(e.className+" "+s.CONFIG.classes.userRecommended).replace(s.CONFIG.classes.active,""),e.setAttribute("data-recommend-count",o)
},s.getEvent=function(e){return s.CONFIG.events.prefix+s.CONFIG.events[e]||null},s}),define("common/modules/discussion/comments",["common/utils/$","bonzo","qwery","bean","common/utils/ajax","common/utils/scroller","common/modules/component","common/modules/userPrefs","common/modules/identity/api","common/modules/discussion/comment-box","common/modules/discussion/recommend-comments","common/modules/discussion/api"],function(e,t,n,o,i,s,a,r,c,l,d,m){var u=function(e,t,n){this.context=e||document,this.mediator=t,this.setOptions(n),r.get("discussion.order")&&(this.options.order=r.get("discussion.order")),this.fetchData={orderBy:this.options.order,pageSize:10},this.endpoint=this.options.commentId?"/discussion/comment-context/"+this.options.commentId+".json":"/discussion/"+this.options.discussionId+".json"};return a.define(u),u.prototype.componentClass="d-discussion",u.prototype.classes={jsContent:"js-discussion-content",container:"discussion__comments__container",comments:"d-thread--top-level",topLevelComment:"d-comment--top-level",changePage:"js-discussion-change-page",showMoreHiddenContainer:"show-more__container--hidden",showMoreNewer:"d-discussion__show-more--newer",showMoreOlder:"d-discussion__show-more--older",showMoreLoading:"d-discussion__show-more-loading",showHidden:"d-discussion__show-all-comments",showAllComments:"d-discussion__show-all-comments",reply:"d-comment--response",showReplies:"d-show-more-replies",header:"d-discussion__header",heading:"discussion__heading",newComments:"js-new-comments",orderControl:"d-discussion__order-control",sentimentControl:"js-discussion-sentiment-changer",loader:"d-discussion__loader",comment:"d-comment",commentActions:"d-comment__actions__main",commentReply:"d-comment__action--reply",commentPick:"d-comment__action--pick",commentRecommend:"d-comment__recommend",commentStaff:"d-comment--staff",commentBlocked:"d-comment--blocked",commentBody:"d-comment__body",commentTimestampJs:"js-timestamp",commentReport:"js-report-comment"},u.prototype.defaultOptions={discussionId:null,showRepliesCount:3,user:null,commentId:null,order:"newest",state:null},u.prototype.endpoint="/discussion:discussionId.json",u.prototype.hasHiddenComments=!1,u.prototype.comments=null,u.prototype.topLevelComments=null,u.prototype.user=null,u.prototype.prerender=function(){var e=n(this.getClass("heading"),this.getClass("container"))[0],t=this.elem.getAttribute("data-comment-count");e.innerHTML+=' <span class="discussion__comment-count">('+t+")</span>",this.user=this.options.user,this.topLevelComments=n(this.getClass("topLevelComment"),this.elem),this.comments=n(this.getClass("comment"),this.elem),this.user&&this.user.badge&&(this.user.isStaff=this.user.badge.some(function(e){return"Staff"===e.name}),this.user.isStaff&&(this.removeState("not-staff"),this.setState("is-staff"))),this.options.state&&this.setState(this.options.state)},u.prototype.ready=function(){if(this.on("click",this.getClass("showReplies"),this.getMoreReplies),this.on("click",this.getClass("changePage"),this.changePage),this.on("click",this.getClass("showHidden"),this.showHiddenComments),this.on("click",this.getClass("commentReport"),this.reportComment),this.on("change",this.getClass("orderControl"),this.setOrder),this.on("click",this.getClass("sentimentControl"),this.setSentiment),this.mediator.on("discussion:comment:recommend:fail",this.recommendFail.bind(this)),this.addMoreRepliesButtons(),this.isReadOnly()||this.bindCommentEvents(),this.options.commentId){var t=e("#comment-"+this.options.commentId);this.showHiddenComments(),e(".d-discussion__show-all-comments").addClass("u-h"),t.attr("hidden")&&o.fire(e(this.getClass("showReplies"),t.parent())[0],"click"),window.location.replace("#comment-"+this.options.commentId)}this.emit("ready"),e(".js-report-comment-close",this.elem).each(function(t){o.on(t,"click",function(){e(".js-report-comment-form").addClass("u-h")})})},u.prototype.bindCommentEvents=function(){d.init(this.context),this.user&&this.user.privateFields.canPostComment&&(this.on("click",this.getClass("commentReply"),this.replyToComment),this.on("click",this.getClass("commentPick"),this.handlePickClick))},u.prototype.handlePickClick=function(t){t.preventDefault();var n=t.target.getAttribute("data-comment-id"),o=e(t.target),i="true"===o[0].getAttribute("data-comment-highlighted")?this.unPickComment.bind(this):this.pickComment.bind(this);i(n,o).fail(function(n){var o=n.response.length>0?JSON.parse(n.response).message:n.statusText;e(t.target).text(o)})},u.prototype.pickComment=function(t,o){var i=this,s=n("#comment-"+t,this.elem);return m.pickComment(t).then(function(){e(i.getClass("commentPick"),s).removeClass("u-h"),e(i.getClass("commentRecommend"),s).addClass("d-comment__recommend--left"),o.text("Unpick"),s.setAttribute("data-comment-highlighted",!0)})},u.prototype.unPickComment=function(t,o){var i=this,s=n("#comment-"+t);return m.unPickComment(t).then(function(){e(i.getClass("commentPick"),s).addClass("u-h"),e(i.getClass("commentRecommend"),s).removeClass("d-comment__recommend--left"),o.text("Pick"),s.setAttribute("data-comment-highlighted",!1)})},u.prototype.gotoComment=function(t){var n=e("#comment-"+t,this.elem);return n.length>0?void window.location.replace("#comment-"+t):this.fetchComments({comment:t}).then(function(){window.location.replace("#comment-"+t)}.bind(this))},u.prototype.gotoPage=function(e){return this.loading(),s.scrollToElement(n(".discussion__comments__container .discussion__heading"),100),this.fetchComments({page:e,sentimentId:this.options.sentiment}).then(function(){this.loaded()}.bind(this))},u.prototype.changePage=function(e){e.preventDefault();var t=parseInt(e.currentTarget.getAttribute("data-page"),10);return this.gotoPage(t)},u.prototype.fetchComments=function(e){var t="/discussion/"+(e.comment?"comment-context/"+e.comment:this.options.discussionId)+".json?"+(e.page?"&page="+e.page:"")+(e.sentimentId?"&sentiment="+e.sentimentId:"");return i({url:t,type:"json",method:"get",crossOrigin:!0,data:this.fetchData}).then(this.renderComments.bind(this))},u.prototype.renderComments=function(o){var i=t.create(o.html),s=n(this.getClass("jsContent"),i);n(this.getClass("comment"),this.getElem("newComments")).forEach(function(t){var n=e("#"+t.id,i);1===n.length&&e(t).remove()}),e(this.getClass("jsContent"),this.elem).replaceWith(s),this.addMoreRepliesButtons(n(this.getClass("comment"),s)),this.isReadOnly()||d.init(this.context),this.emit("loaded")},u.prototype.showHiddenComments=function(e){e&&e.preventDefault(),this.removeState("shut"),this.removeState("partial"),this.emit("first-load")},u.prototype.addMoreRepliesButtons=function(t){var o=this;t=t||this.topLevelComments,t.forEach(function(t){var i=parseInt(t.getAttribute("data-comment-replies"),10),s=n(o.getClass("reply"),t);if(s.length<i){var a=i-s.length,r='<li><span><i class="i i-plus-white-small"></i></span>Show '+a+" more "+(1===a?"reply":"replies")+"</li>";e.create(r).addClass(o.getClass("showReplies",!0)).data("source-comment",t).attr({"data-link-name":"Show more replies","data-is-ajax":"","data-comment-id":t.getAttribute("data-comment-id")}).appendTo(e(".d-thread--responses",t))}})},u.prototype.getMoreReplies=function(e){e.preventDefault();var o=this,s=t(e.target).data("source-comment");i({url:"/discussion/comment/"+e.target.getAttribute("data-comment-id")+".json",type:"json",method:"get",crossOrigin:!0}).then(function(i){var a=t.create(i.html),r=n(o.getClass("reply"),a);r=r.slice(o.options.showRepliesCount,r.length),t(n(".d-thread--responses",s)).append(r),t(e.currentTarget).addClass("u-h"),o.isReadOnly()||d.init(s)})},u.prototype.isReadOnly=function(){return"true"===this.elem.getAttribute("data-read-only")},u.prototype.addComment=function(o,i,s){var a,r,c,l,d,m={username:"d-comment__author",timestamp:"js-timestamp",body:"d-comment__body",report:"d-comment__action--report",avatar:"d-comment__avatar"},u={username:this.user.displayName,timestamp:"Just now",body:"<p>"+o.body.replace(/\n+/g,"</p><p>")+"</p>",report:{href:"http://discussion.theguardian.com/components/report-abuse/"+o.id},avatar:{src:this.user.avatar}},f=t.create(document.getElementById("tmpl-comment").innerHTML)[0],p=t(f);p.addClass("d-comment--new");for(a in m)if(m.hasOwnProperty(a))if(c=m[a],r=u[a],l=n("."+c,f)[0],"string"==typeof r)l.innerHTML=r;else for(d in r)l.setAttribute(d,r[d]);f.id="comment-"+o.id,this.user&&!this.user.isStaff&&p.addClass(this.getClass("commentStaff",!0)),s?(p.removeClass(this.getClass("topLevelComment",!0)),p.addClass(this.getClass("reply",!0)),t(s).append(p)):e(this.getClass("newComments"),this.elem).prepend(f),window.location.replace("#comment-"+o.id)},u.prototype.replyToComment=function(e){var o,i,s=e.currentTarget,a=s.getAttribute("data-comment-id"),r=this;if(document.getElementById("reply-to-"+a))return void document.getElementById("reply-to-"+a).focus();var c=n("#comment-"+a)[0],d=c.getAttribute("data-comment-author"),m=c.getAttribute("data-comment-author-id"),u=t(c),f=n(this.getClass("commentBody"),c)[0].innerHTML,p=n(this.getClass("commentTimestampJs"),c)[0].innerHTML,h=new l({discussionId:this.options.discussionId,premod:this.user.privateFields.isPremoderated,state:"response",replyTo:{commentId:a,author:d,authorId:m,body:f,timestamp:p},focus:!0});o=u.hasClass(this.getClass("topLevelComment",!0))?u[0]:u.parent().parent()[0],i=n(this.getClass("showReplies"),o),i.length>0&&!t(i).hasClass("u-h")&&i[0].click(),h.render(o),h.on("post:success",function(e){var i=n(".d-thread--responses",o)[0];i||(i=t.create('<ul class="d-thread d-thread--responses"></ul>')[0],t(o).append(i)),this.destroy(),r.addComment(e,!1,i)})},u.prototype.recommendFail=function(){},u.prototype.showDiscussion=function(){var t=e(".d-discussion__show-all-comments");t.hasClass("u-h")||(o.fire(t,"click"),t.addClass("u-h"))},u.prototype.loading=function(){var t=e(this.getClass("jsContent"),this.elem);e(this.getClass("loader"),this.elem).removeClass("u-h").css({height:t.offset().height}),t.addClass("u-h")},u.prototype.loaded=function(){var t=e(this.getClass("jsContent"),this.elem);e(this.getClass("loader"),this.elem).addClass("u-h").css({height:"auto"}),t.removeClass("u-h")},u.prototype.setOrder=function(t){var n=t.currentTarget,o=n.options[n.selectedIndex].value,i=e(this.getElem("newComments"));return this.options.order=o,this.fetchData.orderBy=o,this.showDiscussion(),this.loading(),i.empty(),r.set("discussion.order",o),this.fetchComments({page:1}).then(function(){this.showHiddenComments(),this.loaded()}.bind(this))},u.prototype.setSentiment=function(t){var n=t.currentTarget;return t.preventDefault(),e(".d-discussion__sentiment--active",this.elem).removeClass("d-discussion__sentiment--active"),e(n).addClass("d-discussion__sentiment--active"),this.options.sentiment=n.getAttribute("data-sentiment"),this.gotoPage(1)},u.prototype.reportComment=function(n){n.preventDefault();var i=n.currentTarget.getAttribute("data-comment-id");e(".js-report-comment-form").first().each(function(e){o.one(e,"submit",function(n){n.preventDefault();var o=e.elements.category,s=e.elements.comment.value;"0"!==o.value&&m.reportComment(i,{emailAddress:e.elements.email.value,categoryId:o.value,reason:s}),t(e).addClass("u-h")})}).appendTo(e("#comment-"+i+" .js-report-comment-container").first()).removeClass("u-h")},u}),define("common/modules/discussion/top-comments",["common/utils/ajax","bonzo","qwery","common/modules/component","common/modules/identity/api","common/modules/discussion/comment-box","common/modules/discussion/recommend-comments","common/utils/$"],function(e,t,n,o,i,s,a,r){var c=function(e,t,n){this.context=e||document,this.mediator=t,this.setOptions(n),this.fetchData={topComments:!0}};return o.define(c),c.prototype.classes={comments:"d-thread--top-level",topLevelComment:"d-comment--top-level",reply:"d-comment--response",showReplies:"d-show-more-replies",topCommentTitle:"page-sub-header",comment:"d-comment",commentActions:"d-comment__actions__main",commentReply:"d-comment__action--reply",showMoreFeatured:"show-more__container--featured",showMoreFeaturedButton:"js-show-more-top-comments",topCommentsContainer:"discussion__comments__top",titleCounter:"discussion__comment-count",fadeOut:"d-image-fade"},c.prototype.endpoint="/discussion/:discussionId.json",c.prototype.defaultOptions={discussionId:null,showRepliesCount:3,user:null,sectionHeading:"Featured Comments "},c.prototype.hasHiddenComments=!1,c.prototype.currentPage=1,c.prototype.comments=null,c.prototype.topLevelComments=null,c.prototype.user=null,c.prototype.fetch=function(n){var o,i=this,s=this.endpoint;for(o in this.options)s=s.replace(":"+o,this.options[o]);return e({url:s,type:"json",method:"get",crossOrigin:!0,data:this.fetchData}).then(function(e){e.currentCommentCount>0?(i.topCommentsAmount=e.currentCommentCount,i.parent=n,i.elem=t.create(e.html),r(i.getClass("topCommentsContainer"),n).append(i.elem),i.elem=i.elem[0],i.elems={},i.prerender(),i.ready(),i.mediator.emit("module:topcomments:loadcomments")):(r(".discussion__comments--top-comments").remove(),i.mediator.emit("module:topcomments:loadcomments",{showLoader:!0}))},function(){r(".discussion__comments--top-comments").remove(),i.mediator.emit("module:topcomments:loadcomments",{showLoader:!0})})},c.prototype.ready=function(){var e=this;this.user=this.options.user,this.topLevelComments=n(this.getClass("topLevelComment"),this.elem),this.comments=n(this.getClass("comment"),this.elem),this.commentsContainer=n(this.getClass("comments"),this.elem)[0];var o=.66*t.viewport().height;o=Math.max(o,200),o=Math.min(o,800),this.commentsContainer.offsetHeight>o&&(this.truncateFeatured(parseInt(o,10)),this.on("click",this.getClass("showMoreFeaturedButton"),this.showAllFeatured));var i=document.querySelector(".js-top-comments");i.childNodes[0].nodeValue=e.options.sectionHeading,1===e.topCommentsAmount?i.childNodes[0].nodeValue=i.childNodes[0].nodeValue.replace(/s\b/,""):r(e.getClass("titleCounter")).removeClass("u-h")[0].innerHTML="("+e.topCommentsAmount+")",e.emit("ready")},c.prototype.bindCommentEvents=function(){a.init(this.context),this.user&&this.user.privateFields.canPostComment&&this.on("click",this.getClass("commentReply"),this.replyToComment)},c.prototype.truncateFeatured=function(e){this.hasHiddenComments=!0,r(".d-image-fade",this.parent).removeClass("u-h"),r(this.getClass("showMoreFeatured"),this.elem).removeClass("u-h"),r(this.commentsContainer).css("max-height",e+"px")},c.prototype.showAllFeatured=function(e){e&&e.preventDefault(),this.hasHiddenComments=!1,r(".d-image-fade",this.parent).addClass("u-h"),r(this.getClass("showMoreFeatured"),this.elem).addClass("u-h"),r(this.commentsContainer).css("max-height","none")},c.prototype.replyToComment=function(e){var o,i,a=e.currentTarget,r=a.getAttribute("data-comment-id"),c=this;if(document.getElementById("reply-to-"+r))return void document.getElementById("reply-to-"+r).focus();var l=n("#comment-"+r)[0],d=l.getAttribute("data-comment-author"),m=l.getAttribute("data-comment-author-id"),u=t(l),f=new s({discussionId:this.options.discussionId,premod:this.user.privateFields.isPremoderated,state:"response",replyTo:{commentId:r,author:d,authorId:m},focus:!0,cancelable:!0});o=u.hasClass(this.getClass("topLevelComment",!0))?u[0]:u.parent().parent()[0],i=n(this.getClass("showReplies"),o),i.length>0&&i[0].click(),f.render(o),f.on("post:success",function(e){var i=n(".d-thread--responses",o)[0];i||(i=t.create('<ul class="d-thread d-thread--responses"></ul>')[0],t(o).append(i)),c.addComment(e,!1,i),this.destroy()})},c}),define("common/modules/discussion/activity-stream",["bonzo","bean","common/utils/$","common/modules/component","common/modules/discussion/api"],function(e,t,n,o,i){function s(e){this.setOptions(e)}function a(e){t.on(e.elem,"click",".js-activity-stream-page-change",function(t){var n=t.currentTarget.getAttribute("data-page");t.preventDefault(),e.change({page:n})})}return o.define(s),s.prototype.endpoint="/discussion/profile/:userId/:streamType.json?page=:page",s.prototype.componentClass="activity-stream",s.prototype.defaultOptions={page:1,streamType:"discussions",userId:null},s.prototype.ready=function(){this.removeState("loading"),this.on("click",".js-disc-recommend-comment",this.recommendComment),n(".js-disc-recommend-comment").addClass("disc-comment__recommend--open"),a(this)},s.prototype.recommendComment=function(t){var o=t.currentTarget;i.recommendComment(o.getAttribute("data-comment-id")),e(o).addClass("disc-comment__recommend--active"),n(".js-disc-recommend-count",o).each(function(e){e.innerHTML=parseInt(e.innerHTML,10)+1})},s.prototype.change=function(t){var o=e(this.elem).empty();return this.setState("loading"),this.setOptions(t),this._fetch().then(function(e){n.create(e.html).each(function(e){o.html(n(e).html()).attr({"class":e.className})}.bind(this)),this.removeState("loading")}.bind(this))},s}),define("common/modules/discussion/loader",["common/utils/$","common/utils/ajax","bonzo","qwery","bean","common/modules/component","common/modules/analytics/register","common/modules/analytics/discussion","common/modules/identity/api","common/modules/discussion/api","common/modules/discussion/comments","common/modules/discussion/top-comments","common/modules/discussion/comment-box","common/modules/discussion/activity-stream"],function(e,t,n,o,i,s,a,r,c,l,d,m,u,f){var p=function(e,t,n){this.context=e||document,this.mediator=t,this.setOptions(n),a.begin("discussion")};return s.define(p),p.prototype.context=null,p.prototype.defaultOptions={switches:{}},p.prototype.classes={commentsContainer:"discussion__comments__container",comments:"discussion__comments",commentBox:"discussion__comment-box",commentBoxBottom:"discussion__comment-box--bottom",topComments:"discussion__comments--top-comments"},p.prototype.componentClass="discussion",p.prototype.comments=null,p.prototype.commentBox=null,p.prototype.bottomCommentBox=null,p.prototype.user=null,p.prototype.canComment=!1,p.prototype.ready=function(){var e=this,t=this.getElem("topComments");this.topLoadingElem=n.create('<div class="preload-msg">Loading comments <a href="/discussion'+this.getDiscussionId()+'" class="accessible-link">Trouble loading?</a><div class="is-updating"></div></div>')[0],n(this.topLoadingElem).insertAfter(t),this.on("user:loaded",function(){this.topComments=new m(e.context,e.mediator,{discussionId:this.getDiscussionId(),user:e.user}),this.topComments.fetch(t).then(function(){n(e.topLoadingElem).addClass("u-h")}),this.mediator.on("module:topcomments:loadcomments",e.loadComments.bind(e))}),this.getUser(),this.renderCommentCount(),r.init(),i.on(window,"hashchange",function(){var t=e.getCommentIdFromHash();t&&e.comments.gotoComment(t)}),"#comments"===window.location.hash&&this.mediator.emit("discussion:seen:comments-anchor"),a.end("discussion")},p.prototype.loadComments=function(e){e=e||{};var t=this,o=this.getElem("commentsContainer"),i=this.getElem("comments"),s=n.create('<div class="preload-msg d-discussion__loader--comments">Loading comments<div class="is-updating"></div></div>')[0],a=this.getCommentIdFromHash(),r=e.showLoader||a||"#comments"===window.location.hash;e.showLoader&&n(o).removeClass("u-h"),n(t.topLoadingElem).addClass("u-h"),n(s).insertAfter(o),a&&this.mediator.emit("discussion:seen:comment-permalink"),this.comments=new d(this.context,this.mediator,{discussionId:this.getDiscussionId(),user:this.user,commentId:a?a:null,order:this.getDiscussionClosed()?"oldest":"newest",state:this.topComments.topCommentsAmount>0?"shut":"partial"}),this.comments.fetch(i).then(function(){n(s).addClass("u-h"),t.renderCommentBar(t.user),r&&(n(t.comments.getElem("header")).removeClass("u-h"),t.comments.removeState("shut")),n(o).removeClass("js-hidden"),t.initUnthreaded()}).fail(t.loadingError.bind(t))},p.prototype.initUnthreaded=function(){var t=this,o=e(".js-discussion-container",this.elem),i=e(".js-discussion__non-threaded",this.elem),s=e(".d-discussion__loader--comments",this.elem),a=e(".discussion__show-threaded-state",this.elem);this.on("click",".js-show-threaded",function(e){var t=n(e.currentTarget);if(a.toggleClass("u-h"),i.toggleClass("u-h"),o.toggleClass("u-h"),!t.data("loaded")){var r=new f;t.data("loaded",!0),s.removeClass("u-h"),r.endpoint="/discussion/non-threaded"+this.getDiscussionId()+".json?page=:page",r.fetch(i[0]).then(function(){s.addClass("u-h")})}}),this.on("click",".js-comment-permalink",function(e){var n=t.comments.gotoComment(e.currentTarget.getAttribute("data-comment-id"));e.preventDefault(),i.addClass("u-h"),a.removeClass("u-h"),t.comments.showHiddenComments(),n?(s.removeClass("u-h"),n.then(function(){s.addClass("u-h"),o.removeClass("u-h")})):o.removeClass("u-h")})},p.prototype.getUser=function(){var e=this;return c.getUserFromCookie()?l.getUser().then(function(t){e.user=t.userProfile,e.emit("user:loaded",t.userProfile)}):void e.emit("user:loaded")},p.prototype.loadingError=function(){n(this.getElem("commentsContainer")).remove()},p.prototype.renderReadOnly=function(){this.getElem("commentBox").innerHTML='<div class="d-bar d-bar--closed"><b>We\'re doing some maintenance right now.</b> You can still read comments, but please come back later to add your own.</div>'},p.prototype.renderDiscussionClosedMessage=function(){this.getElem("commentBox").innerHTML='<div class="d-bar d-bar--closed">This discussion is closed for comments.</div>'},p.prototype.renderSignin=function(){var e=c.getUrl()+"/{1}?returnUrl="+window.location.href;this.getElem("commentBox").innerHTML='<div class="d-bar d-bar--signin">Open for comments. <a class="u-underline" href="'+e.replace("{1}","signin")+'">Sign in</a> or <a class="u-underline" href="'+e.replace("{1}","register")+'">create your Guardian account</a> to join the discussion.</div>'},p.prototype.renderCommentBar=function(){this.comments.isReadOnly()?this.renderReadOnly():this.getDiscussionClosed()?this.renderDiscussionClosedMessage():c.getUserFromCookie()?(this.renderCommentBox(),this.comments.on("first-load",this.renderBottomCommentBox.bind(this)),this.comments.on("first-load",this.cleanUpOnShowComments.bind(this))):this.renderSignin()},p.prototype.renderCommentBox=function(){this.user.privateFields?this.user.privateFields.canPostComment?(this.commentBox=new u({discussionId:this.getDiscussionId(),premod:this.user.privateFields.isPremoderated,switches:this.options.switches}),this.commentBox.render(this.getElem("commentBox")),this.commentBox.on("post:success",this.commentPosted.bind(this)),this.canComment=!0):this.renderUserBanned():this.renderSignin()},p.prototype.commentPosted=function(){this.comments.addComment.apply(this.comments,arguments),this.firstComment||(this.firstComment=!0,this.comments.showHiddenComments(),this.cleanUpOnShowComments())},p.prototype.cleanUpOnShowComments=function(){n(this.comments.getElem("header")).removeClass("u-h")},p.prototype.renderUserBanned=function(){this.getElem("commentBox").innerHTML='<div class="d-bar d-discussion__error d-bar--banned">Commenting has been disabled for this account (<a href="/community-faqs#321a">why?</a>).</div>'},p.prototype.renderBottomCommentBox=function(){this.bottomCommentBox||(this.bottomCommentBox=new u({discussionId:this.getDiscussionId(),premod:this.user.privateFields.isPremoderated}),this.bottomCommentBox.render(this.getElem("commentBoxBottom")),this.bottomCommentBox.on("post:success",function(e){this.comments.addComment(e,!0)}.bind(this)))},p.prototype.getDiscussionId=function(){return this.elem.getAttribute("data-discussion-key")},p.prototype.getDiscussionClosed=function(){return"true"===this.elem.getAttribute("data-discussion-closed")},p.prototype.renderCommentCount=function(){t({url:"/discussion/comment-counts.json?shortUrls="+this.getDiscussionId(),type:"json",method:"get",crossOrigin:!0,success:function(e){if(e&&e.counts&&e.counts.length){var t=e.counts[0].count;if(t>0){n(o(".js-show-discussion, .js-show-discussion a",this.context)).attr("href","#comments");var i=1===t?"comment":"comments",s='<a href="#comments" class="js-show-discussion commentcount tone-colour" data-link-name="Comment count">  <i class="i"></i>'+t+'  <span class="commentcount__label">'+i+"</span></a>";n(o(".js-comment-count",this.context)).html(s)}}}})},p.prototype.getCommentIdFromHash=function(){var e=/#comment-(\d+)/;return e.exec(window.location.hash)?parseInt(e.exec(window.location.hash)[1],10):null},p}),define("common/bootstraps/common",["common/utils/$","common/utils/mediator","common/utils/deferToLoad","common/utils/ajax","common/modules/userPrefs","bonzo","bean","qwery","enhancer","lodash/functions/debounce","common/utils/storage","common/utils/detect","common/modules/onward/most-popular-factory","common/modules/onward/related","common/modules/onward/onward-content","common/modules/ui/images","common/modules/navigation/profile","common/modules/navigation/sections","common/modules/navigation/search","common/modules/navigation/servicesNav","common/modules/navigation/newNavigation","common/modules/ui/tabs","common/modules/ui/toggles","common/modules/ui/dropdowns","common/modules/ui/relativedates","common/modules/analytics/clickstream","common/modules/analytics/omniture","common/modules/analytics/scrollDepth","common/utils/cookies","common/modules/analytics/livestats","common/modules/experiments/ab","common/modules/discussion/comment-count","common/modules/gallery/lightbox","common/modules/onward/history","common/modules/onward/sequence","common/modules/ui/message","common/modules/identity/autosignin","common/modules/analytics/foresee-survey","common/modules/onward/geo-most-popular","common/modules/analytics/register","common/modules/onward/tonal","common/modules/identity/api","common/modules/onward/more-tags","common/modules/ui/smartAppBanner","common/modules/discussion/loader"],function(e,t,n,o,i,s,a,r,c,l,d,m,u,f,p,h,g,v,y,b,w,_,k,x,C,T,j,S,E,I,A,O,M,D,L,F,q,N,P,U,V,B,R,H,z){var G={upgradeImages:function(){h.upgrade(),h.listen()},initialiseTopNavItems:function(e){var t=new y(e),n=document.getElementById("header");if(n&&e.switches.idProfileNavigation){var o=new g(n,{url:e.page.idUrl});o.init()}t.init(n),b.init(e)},initialiseNavigation:function(e){new v(e).init(document)},initialiseNewNavigation:function(e){w.init(e)},transcludeRelated:function(e,t){var n=new f;n.renderRelatedComponent(e,t)},transcludePopular:function(e){new u(e)},transcludeOnwardContent:function(t,n){"seriesId"in t.page?new p(t,r(".js-onward",n)):""!==t.page.tones&&e(".js-onward",n).each(function(e){new V(t,e).fetch(e,"html")})},showTabs:function(){var e=new _;t.on("modules:popular:loaded",function(t){e.init(t)})},showToggles:function(){var e=new k;e.init(document),t.on("page:common:ready",function(){e.reset(),x.init()})},showRelativeDates:function(){var e=C;t.on("page:common:ready",function(t,n){e.init(n)}),t.on("fragment:ready:dates",function(t){e.init(t)})},initClickstream:function(){new T({filter:["a","button"]})},transcludeCommentCounts:function(){t.on("page:common:ready",function(e,t){O.init(t)})},initLightboxGalleries:function(){var e;t.on("page:common:ready",function(t,n){var o=new M(t,n);e=t.page.pageId,o.init()}),t.on("module:lightbox-gallery:loaded",function(n,o){e!==n.page.pageId&&t.emit("page:common:deferred:loaded",n,o)})},initAbTests:function(e){A.segmentUser(e)},runAbTests:function(e,t){A.run(e,t)},initRightHandComponent:function(e){"Article"===e.page.contentType&&"mobile"!==m.getBreakpoint()&&parseInt(e.page.wordCount,10)>500&&!e.page.isLiveBlog&&new P({})},logLiveStats:function(e){I.log(e)},loadAnalytics:function(e){var n=new j;n.go(e),e.switches.ophan&&!e.page.isSSL&&require("ophan/ng",function(n){n.record({ab:A.getParticipations()}),e.switches.scrollDepth&&(t.on("scrolldepth:data",n.record),new S({isContent:"Article"===e.page.contentType}))})},cleanupCookies:function(){E.cleanUp(["mmcore.pd","mmcore.srv","mmid","GU_ABFACIA","GU_FACIA","GU_ALPHA"]),E.cleanUpDuplicates(["GU_VIEW"])},optIn:function(){var e=/#countmein/.test(window.location.hash);e&&E.add("GU_VIEW","responsive",365)},displayReleaseMessage:function(e){var t=document.location.pathname?document.location.pathname:"/",n="/preference/platform/classic?page="+encodeURIComponent(t+"?view=classic"),o='<p class="site-message__message" id="site-message__message">Youre viewing a beta release of the Guardians responsive website. Wed love to hear your <a href="https://www.surveymonkey.com/s/theguardian-beta-feedback" data-link-name="feedback">feedback</a></p><ul class="site-message__actions u-unstyled"><li class="site-message__actions__item"><i class="i i-back"></i><a class="js-main-site-link" rel="nofollow" href="'+n+'"data-link-name="opt-out">Opt-out and return to our current site </a></li></ul>',i=new F("alpha"),s=new RegExp(".*/-sp-.*");e.switches.releaseMessage&&"mobile"!==m.getBreakpoint()&&!s.test(t)&&(E.add("GU_VIEW","responsive",365),i.show(o))},displayOnboardMessage:function(e){if("#opt-in-message"===window.location.hash&&e.switches.networkFrontOptIn&&"mobile"!==m.getBreakpoint()){a.on(document,"click",".js-site-message-close",function(){E.add("GU_VIEW","responsive",365)}),a.on(document,"click",".js-site-message",function(){E.add("GU_VIEW","responsive",365)});var t=new F("onboard",{type:"modal"}),n=document.location.pathname?document.location.pathname:"/",o="/preference/platform/classic?page="+encodeURIComponent(n+"?view=classic"),i='<h2 class="site-message__header">Thanks for joining us.</h2><div class="site-message__message" id="site-message__message"><p>Youre looking at a prototype of our new website. Opt-out any time by clicking "Current version" at the bottom of the page. <a href="http://next.theguardian.com/">Find out more</a>.</p><ul class="site-message__list"><li class="site-message__list__item">We love feedback - <a href="https://www.surveymonkey.com/s/theguardian-beta-feedback">let us know yours</a>.</li><li class="site-message__list__item">Stay up to date with new releases on <a href="http://next.theguardian.com/blog/">our blog</a>.</li></ul><ul class="site-message__actions u-unstyled"><li class="site-message__actions__item"><i class="i i-arrow-white-circle"></i>  <a class="js-site-message-close" data-link-name="R2 alpha opt in" href="#" tabindex=1>Got it</a><li class="site-message__actions__item"><i class="i i-back-white"></i><a class="js-main-site-link" rel="nofollow" href="'+o+'"data-link-name="R2 alpha opt out">Opt-out and return to the current site </a></li></ul>';t.show(i)}},unshackleParagraphs:function(t,n){i.isOff("para-indents")&&e(".paragraph-spacing--indents",n).removeClass("paragraph-spacing--indents")},logReadingHistory:function(){t.on("page:common:ready",function(e){/Article|Video|Gallery|Interactive/.test(e.page.contentType)&&(new D).log({id:"/"+e.page.pageId,meta:{section:e.page.section,keywords:e.page.keywordIds.split(",").slice(0,5)}}),"identity"!==e.page.section&&L.init("/"+e.page.pageId)})},initAutoSignin:function(){t.on("page:common:ready",function(e){e.switches&&e.switches.facebookAutosignin&&"mobile"!==m.getBreakpoint()&&new q(e).init()})},windowEventListeners:function(){var e={resize:"window:resize",orientationchange:"window:orientationchange",scroll:"window:scroll"},n=function(e){return function(n){t.emit(e,n)}};for(var o in e)a.on(window,o,l(n(e[o]),200))},checkIframe:function(){window.self!==window.top&&e("html").addClass("iframed")},runForseeSurvey:function(e){e.switches.foresee&&N.load()},augmentInteractive:function(){t.on("page:common:ready",function(n,o){/Article|Interactive/.test(n.page.contentType)&&e("figure.interactive").each(function(e){c.render(e,o,n,t)})})},startRegister:function(e){e.page.isSSL||U.initialise(e)},repositionComments:function(){t.on("page:common:ready",function(){B.isUserLoggedIn()||e(".js-comments").appendTo(r(".js-repositioned-comments"))})},showMoreTagsLink:function(){(new R).init()},showSmartBanner:function(e){e.switches.smartBanner&&H.init()},initDiscussion:function(){t.on("page:common:ready",function(n,o){if(n.page.commentable&&n.switches.discussion){var i=new z(o,t,{switches:n.switches});
i.attachTo(e(".discussion")[0])}})}},$=function(e,o){var i=this;n(function(){i.initialisedDeferred||(i.initialisedDeferred=!0,G.initAbTests(e),G.logLiveStats(e),G.loadAnalytics(e,o),G.cleanupCookies(o),G.runAbTests(e,o),G.transcludePopular(e),G.transcludeRelated(e,o),G.transcludeOnwardContent(e,o),G.initRightHandComponent(e,o)),t.emit("page:common:deferred:loaded",e,o)})},W=function(e,n){this.initialised||(this.initialised=!0,G.displayOnboardMessage(e),G.windowEventListeners(),G.checkIframe(),G.upgradeImages(),G.showTabs(),G.initialiseTopNavItems(e),e.switches.responsiveNav?G.initialiseNewNavigation(e):G.initialiseNavigation(e),G.showToggles(),G.showRelativeDates(),G.initClickstream(),G.transcludeCommentCounts(),G.initLightboxGalleries(),G.optIn(),G.displayReleaseMessage(e),G.logReadingHistory(),G.unshackleParagraphs(e,n),G.initAutoSignin(e),G.augmentInteractive(),G.runForseeSurvey(e),G.startRegister(e),G.repositionComments(),G.showMoreTagsLink(),G.showSmartBanner(e),G.initDiscussion()),t.emit("page:common:ready",e,n)},Y=function(e,t){W(e,t),$(e,t)};return{init:Y}}),define("common/modules/onward/popular-fronts",["common/utils/$","common/utils/mediator","common/utils/ajax","bonzo","common/modules/ui/relativedates","common/modules/ui/images","common/modules/discussion/comment-count"],function(e,t,n,o,i,s,a){return{render:function(r,c){var l=c||{},d=r.page&&r.page.section&&"global"!==r.page.section;return n({url:"/most-read"+(d?"/"+r.page.section:"")+".json",type:"json",crossOrigin:!0}).then(function(t){var n=o.create(t.faciaHtml.trim())[0];return n?(o(n).insertAfter(l.insertAfter||e(".container, .ad-slot--commercial-component-high").last()),a.init(n),i.init(n),void s.upgrade(n)):!1},function(e){t.emit("module:error","Failed to load facia popular: "+e.statusText)})}}}),define("common/bootstraps/tag",["common/utils/mediator","common/modules/onward/popular-fronts"],function(e,t){var n={showPopular:function(){e.on("page:tag:ready",function(e){t.render(e)})}},o=function(t,o){this.initialised||(this.initialised=!0,n.showPopular()),e.emit("page:tag:ready",t,o)};return{init:o}}),define("common/bootstraps/section",["common/utils/mediator","common/modules/onward/popular-fronts"],function(e,t){var n={showPopular:function(){e.on("page:section:ready",function(e){t.render(e)})}},o=function(t,o){this.initialised||(this.initialised=!0,n.showPopular()),e.emit("page:section:ready",t,o)};return{init:o}}),define("common/modules/ui/rhc",["common/utils/$","bonzo","lodash/collections/filter"],function(e,t,n){function o(o,s){s=s||1;var a,r="component--rhc";return e.create('<div class="'+r+'" data-importance="'+s+'"></div>').append(o).each(function(o){a=e("."+r,i[0]);var c=n(a,function(e){return!e.hasAttribute("data-importance")||s>parseInt(e.getAttribute("data-importance"),10)});0===c.length?i.append(o):t(c[0]).before(o)})}var i=e(".js-components-container");return{addComponent:o}}),define("common/modules/charts/doughnut",["common/utils/$","lodash/objects/assign"],function(e,t){function n(t){return e.create(document.createElementNS("http://www.w3.org/2000/svg",t))}function o(e){return"translate("+e+")"}var i=function(i,s){s=t({percentCutout:35,unit:"",showValues:!1},s||{});var a,r,c,l,d,m,u,f,p,h,g=s.width,v=s.height||g,y=Math.min(v/2,g/2),b=y*(s.percentCutout/100),w=i.reduce(function(e,t){return{value:e.value+t.value}}).value,_=Math.PI/2,k=2*Math.PI,x=[g/2,v/2],C={x:g/2,y:v/2},T=e.create('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>').attr({width:g,height:v,viewbox:"0 0 "+[g,v].join(" ")}).addClass("chart chart--doughnut"),j=-_;return i.forEach(function(e){a=e.value/w*k,r=j+a,c=(r-j)%k>Math.PI?1:0,l={start:{x:C.x+Math.cos(j)*y,y:C.y+Math.sin(j)*y},end:{x:C.x+Math.cos(r)*y,y:C.y+Math.sin(r)*y}},d={start:{x:C.x+Math.cos(r)*b,y:C.y+Math.sin(r)*b},end:{x:C.x+Math.cos(j)*b,y:C.y+Math.sin(j)*b}},m=(b+y)/2,u=(j+r)/2,f=["M",l.start.x,l.start.y,"A",y,y,0,c,1,l.end.x,l.end.y,"L",d.start.x,d.start.y,"A",b,b,0,c,0,d.end.x,d.end.y,"Z"],p=n("g").addClass("chart__arc").append(n("path").attr({d:f.join(" "),fill:e.color})),h=n("text"),s.showValues?h.append(n("tspan").text(e.label).attr({x:0,dy:"0"}).addClass("chart__label-text")).append(n("tspan").text(e.value).attr({x:0,dy:"1em"}).addClass("chart__label-value")):h.text(e.label),h.attr({transform:o([Math.cos(u)*m+C.x,Math.sin(u)*m+C.y])}).addClass("chart__label").appendTo(p),p.appendTo(T),j+=e.value/w*k}),T.append(n("text").text(s.unit).addClass("chart__unit").attr({transform:o(x),dy:"0.4em"}))};return i}),define("common/modules/charts/table-doughnut",["common/utils/$","bonzo","common/modules/charts/doughnut"],function(e,t,n){var o=function(){};return o.prototype.render=function(o){var i=o.scrollWidth||o.getAttribute("data-chart-width"),s=e("th",o),a=e("td",o).map(function(e,t){return{label:s[t].innerHTML,value:parseInt(e.getAttribute("data-chart-value"),10),color:e.getAttribute("data-chart-color")}});return t(o).addClass("u-h"),new n(a,{showValues:"true"===o.getAttribute("data-chart-show-values"),unit:o.getAttribute("data-chart-unit"),width:i}).addClass(o.getAttribute("data-chart-class")).insertAfter(o)},o}),define("common/modules/sport/football/match-list-live",["common/modules/component","common/utils/$","bonzo"],function(e,t,n){var o=function(e,t,n){this.endpoint+=["football",e,t,n].filter(function(e){return e}).join("/")+".json"};return e.define(o),o.prototype.endpoint="/",o.prototype.autoupdated=!0,o.prototype.updateEvery=10,o.prototype.prerender=function(){var e=this.elem;t(".football-team__form",e).remove(),t(".date-divider",e).remove(),t(this.elem).addClass("table--small"),t(".football-matches__date",this.elem).replaceWith('<span class="item__live-indicator">Live</span>')},o.prototype.autoupdate=function(e){var o,i,s=t(".football-match",e),a=this;t(".football-match",this.elem).each(function(e,t){o=n(e).removeClass("football-match--updated"),i=n(s[t]),["score-home","score-away","match-status"].forEach(function(e){e="data-"+e,i.attr(e)!==o.attr(e)&&(o.replaceWith(i.addClass("football-match--updated")),a.prerender())})})},o}),define("common/modules/sport/football/match-info",["common/utils/$","common/utils/ajax"],function(e,t){var n=function(e,t){this.endpoint+=(e.id?e.id:[e.date].concat(e.teams).join("/"))+".json?page="+encodeURIComponent(t)};return n.prototype.endpoint="/football/api/match-nav/",n.prototype.fetch=function(){return t({crossOrigin:!0,url:this.endpoint})},n}),define("common/modules/sport/football/score-board",["common/modules/component"],function(e){var t=function(){};return e.define(t),t.prototype.componentClass="match-summary",t.prototype.responseDataKey="matchSummary",t}),define("common/modules/sport/football/football",["common/modules/component"],function(e){function t(t){var n=new e;return n.endpoint=t,n}function n(e,n){return t("/football/match-day/"+e+"/"+n+".json")}function o(e){return t("/football/"+e+"/table.json")}function i(e){return t(e+".json")}return{matchDayFor:n,tableFor:o,statsFor:i}}),define("common/bootstraps/football",["common/utils/$","bonzo","bean","common/utils/ajax","common/utils/context","common/utils/config","common/utils/page","common/utils/mediator","common/utils/detect","common/modules/ui/rhc","common/modules/charts/table-doughnut","common/modules/sport/football/match-list-live","common/modules/sport/football/match-info","common/modules/sport/football/score-board","common/modules/sport/football/football"],function(e,t,n,o,i,s,a,r,c,l,d,m,u,f,p){function h(t,n){var o;return(o=new u(t,s.page.pageId)).fetch().then(function(s){var a;s.nav&&s.nav.trim().length>0&&(a=e.create(s.nav).first().each(function(n){(t.id||e(".tabs__tab",n).length>2)&&e(".js-football-tabs",i).append(n)})),n&&n(s,a,o.endpoint)},function(){e(".score-container",i).remove(),e(".js-score",i).removeClass("u-h")})}function g(t,o){t=t.filter(function(e){return e});var r=0===t.filter(function(e){return e.ready===!1}).length;r&&a.belowArticleVisible(function(){var a;e(".js-after-article",i).append(e.create('<div class="football-extras"></div>').each(function(n){t.forEach(function(t,i){o?e.create(o).each(function(n){s.page.isLiveBlog&&e(n).addClass("dropdown--key-events"),e(".dropdown__label",n).append(t.name),e(".dropdown__content",n).append(t.content),e(".dropdown__button",n).attr("data-link-name","Show dropdown: "+t.name).each(function(e){0===i&&(a=e)})}).appendTo(n):n.appendChild(t.content)})})),a&&n.fire(a,"click")},function(){t.forEach(function(e){l.addComponent(e.content,e.importance)})})}function v(t,n,o){n[2]={ready:!1},e.create('<div class="js-football-table" data-link-name="football-table-embed"></div>').each(function(i){p.tableFor(t).fetch(i).then(function(){n[2]=e(".table__container",i).length>0?{name:"Table",importance:3,content:i,ready:!0}:void 0,g(n,o)},function(){delete n[2],g(n,o)})})}function y(e,n,o){t(e).append(t.create('<div class="loading"><div class="loading__message">'+(n||"Loading")+"</div>"+(o?'<a href="'+o.href+'" class="loading__link">'+o.text+"</a>":"")+'<div class="loading__animation"></div></div>'))}function b(t){e(".loading",t).remove()}function w(){var l,u=[];i=i(),a.isMatch(function(n){if(u[0]={ready:!1},"stats"===n.pageType)h(n);else{var o=e(".js-score",i),s=new f,r=t.create('<div class="score-container"><div class="score__loading'+("report"!==n.pageType?" score__loading--live":"")+'"><div class="loading__text">Fetching the scores</div><div class="is-updating"></div></div></div>')[0];"report"===n.pageType?o.after(r):o.addClass("u-h").before(r),h(n,function(t,i,m){if(l=t.dropdown,r.innerHTML="",s.template=t.matchSummary,/^\s+$/.test(s.template)?o.removeClass("u-h"):(s.endpoint=m,s.updateEvery=/desktop|wide/.test(c.getBreakpoint())?30:60,s.autoupdated=n.isLive,s.render(r),s.setState(n.pageType)),t.hasStarted&&i){var f=e(".tab--stats a",i).attr("href").replace(/^.*\/\/[^\/]+/,"");e.create('<div class="match-stats__container"></div>').each(function(t){p.statsFor(f).fetch(t).then(function(){e(".js-chart",t).each(function(e){(new d).render(e)}),u[0]={name:"Match stats",importance:3,content:t,ready:!0},g(u,l)})})}else delete u[0],g(u,l);a.isCompetition(function(n){u[1]={ready:!1},""!==t.group&&v(n+"/"+t.group,u,l),e.create('<div class="js-football-match-day" data-link-name="football-match-day-embed"></div>').each(function(e){p.matchDayFor(n,t.matchDate).fetch(e).then(function(){u[1]={name:"Today's matches",importance:2,content:e,ready:!0},g(u,l)},function(){delete u[1],g(u,l)})})})})}}),a.isCompetition(function(e){v(e,u,l)}),a.isLiveClockwatch(function(){var t=new m("match-day",a.isCompetition()||"premierleague",s.dateFromSlug()),n=e(".media-primary"),o=e.create('<div class="football-matches__container" data-link-name="football-matches-clockwatch"></div>').css({minHeight:n[0]?n[0].offsetHeight:0});n.addClass("u-h"),y(o[0],"Fetching today's matches",{text:"Impatient?",href:"/football/live"}),e(".js-football-meta").append(o),t.fetch(o[0]).fail(function(){t.destroy(),o.remove(),n.removeClass("u-h")}).always(function(){0===e(".football-match",o[0]).length&&(t.destroy(),o.remove(),n.removeClass("u-h")),o.css({minHeight:0}),b(o[0])})}),a.isFootballStatsPage(function(){e(".js-chart").each(function(e){(new d).render(e)})}),n.on(i,"click",".js-show-more",function(n){n.preventDefault();var s=n.currentTarget;o({url:s.getAttribute("href")+".json"}).then(function(n){e.create(n.html).each(function(o){e('[data-show-more-contains="'+s.getAttribute("data-puts-more-into")+'"]',i).append(e(s.getAttribute("data-shows-more"),o));var a=n[s.getAttribute("data-new-url")];a?t(s).attr("href",a):t(s).remove()})})}),n.on(i,"change",e("form.football-leagues")[0],function(){window.location=this.value}),s.page.isFootballWorldCup2014||n.on(i,"click",".table tr[data-link-to]",function(e){e.target.getAttribute("href")||(window.location=this.getAttribute("data-link-to"))}),s.page.isFootballWorldCup2014&&(e("a").attr("target","_top"),function(){var t,o,i,s;try{i=e(".interactive iframe",window.parent.document).get(0)}catch(a){}s=function c(){return t||(o=e("#js-context").offset().height+50,i&&(i.height=o),t=setTimeout(function(){clearTimeout(t),t=null},200)),c}(),r.on("window:resize",s),n.on(document,"click",".dropdown__button",s)}())}return{init:w}}),define("fence",[],function(){function e(t,n,o,i){i=i||0,t(),n>0&&setTimeout(function(){var s=o+i;e(t,n-1,s,o)},o)}function t(t){setTimeout(function(){e(function(){a(t),r(t)},p,f)},0)}function n(e,t){return e.classList?e.classList.contains(t):-1!==e.className.indexOf(t)}function o(e,t){return e.classList?e.classList.add(t):e.className+=" "+t}function i(){for(var e="iframe."+m,t=document.querySelectorAll(e),n=0,o=t.length;o>n;++n)s(t[n])}function s(e,i){if(i=i||{},"IFRAME"!==e.tagName)throw new Error("Cannot render non-iframe elements!");if(!n(e,m))throw new Error("Cannot render iframes with no "+m+" class!");var s=n(e,u);if(!s||i.force){e.style.height=0,e.frameBorder=0,e.style.border="none",e.style.overflow="hidden",e.width="100%";var a=!!e.srcdoc;if(a)"complete"===e.contentWindow.document.readyState?t(e):s||e.addEventListener("load",function(){t(e)},!1);else{var r=e.getAttribute("srcdoc");r&&"string"==typeof r&&(e.contentWindow.contents=r,e.src='javascript:window["contents"]',t(e))}o(e,u)}}function a(e){var t=e.contentWindow&&e.contentWindow.document,n=t&&t.body;n&&(n.style.padding=0,n.style.margin=0,n.style.overflow="hidden")}function r(e){var t=e.contentWindow&&e.contentWindow.document;if(t){var n=t.documentElement&&t.documentElement.scrollHeight||t.body&&t.body.scrollHeight||0;e.style.height=n+"px"}}function c(e){var t=document.createElement("div");t.innerHTML=(e||"").trim();var n=t.firstChild,o=n&&"IFRAME"===n.tagName,i=n&&!n.nextSibling;return o&&i}function l(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}function d(e){if(c(e))return e;var t=l(e).replace(/\"/g,"&quot;"),n="<html><head></head><body>"+t+"</body></html>";return'<iframe srcdoc="'+n+'" class="'+m+'"></iframe>'}var m="fenced",u="fenced-rendered",f=300,p=12;return{render:s,renderAll:i,isSafeCode:c,wrap:d}}),define("common/modules/article/twitter",["qwery","common/utils/$","common/utils/context","common/utils/detect","common/utils/config"],function(e,t,n,o,i){function s(){if("mobile"!==o.getBreakpoint()&&i.switches.enhanceTweets){var s=n(),a=e("blockquote.tweet",s),r=e("#twitter-widget",s);a.forEach(function(e){t(".tweet-body",e).after(t(".tweet-date",e)),t(".tweet-user",e).remove(),t(e).removeClass("tweet").addClass("twitter-tweet")});var c=e("blockquote.twitter-tweet",s);if(c.length>0)if(0===r.length){var l=document.createElement("script");l.id="twitter-widget",l.async=!0,l.src="//platform.twitter.com/widgets.js",t(s).append(l)}else twttr&&"widgets"in twttr&&"load"in twttr.widgets&&twttr.widgets.load()}}return{enhanceTweets:s}}),define("common/modules/article/truncate",["common/utils/$","bean","bonzo","qwery","common/utils/config","common/utils/context","common/utils/detect","common/utils/mediator","common/modules/article/twitter"],function(e,t,n,o,i,s,a,r,c){function l(){e(".truncated-block blockquote.tweet-truncated",s).removeClass("tweet-truncated").addClass("tweet"),c.enhanceTweets(),f.removeClass(m),e(".article-elongator").addClass("u-h")}function d(){i.page.isLiveBlog&&o(".block").length>u&&""===window.location.hash&&(e.create('<button class="u-fauxlink u-button-reset button button--show-more article-elongator" data-link-name="continue reading"><span class="i-center"><i class="i i-plus-white-med"></i></span>View all updates</button>').each(function(t){e(".article-body",s).append(t)}),t.on(s,"click",".article-elongator",l.bind(this)),r.on("module:liveblog:showkeyevents",l.bind(this)),r.on("module:filter:toggle",l.bind(this)),f.addClass(m),e(".truncated-block blockquote.tweet",s).removeClass("tweet").addClass("tweet-truncated"))}s=s();var m="truncated-block",u="mobile"===a.getBreakpoint()?5:10,f=n(o(".block",s).slice(u));return d}),define("common/modules/open/cta",["common/utils/$","common/utils/clamp","common/modules/component"],function(e,t,n){var o=function(e,t,n){this.contex=e,this.mediator=t,this.setOptions(n)};return n.define(o),o.prototype.endpoint="/open/cta/article/:discussionKey.json",o.prototype.componentClass="comment",o.prototype.useBem=!0,o.prototype.defaultOptions={discussionKey:null},o.prototype.prerender=function(){var t=e(".comment",this.elem),n=t[Math.floor(Math.random()*t.length)+0];0===t.length?this.destroy():this.elem=n},o.prototype.ready=function(){t(this.getElem("body"),10,!0)},o}),define("common/modules/live/notification-bar",["common/utils/mediator","common/modules/component","lodash/objects/assign"],function(e,t,n){function o(t){this.config=n(t,this.config),this.attachTo=this.config.attachTo,this.mediator=e}return t.define(o),o.prototype.componentClass="notify",o.prototype.manipulationType="prepend",o.prototype.classes={count:"js-notify-count",button:"js-notify-btn"},o.prototype.template='<div class="block block--notification js-block-notification notify"><div class="block-elements"><button class="notify__btn u-button-reset js-notify-btn"> Show <span class="notify__count js-notify-count"></span> new post(s)</button></div></div>',o.prototype.ready=function(){this.on("click",this.getClass("button"),function(){this.setState("hidden"),this.mediator.emit("modules:notificationbar:show",!0)})},o.prototype.notify=function(e){this.rendered||this.render(this.attachTo),this.removeState("hidden"),this.setCount(e)},o.prototype.setCount=function(e){this.getElem("count").innerHTML=e},o}),define("lodash/collections/toArray",["../objects/isString","../internals/slice","../objects/values"],function(e,t,n){function o(e){return e&&"number"==typeof e.length?t(e):n(e)}return o}),define("common/modules/ui/autoupdate",["common/utils/mediator","common/utils/ajax","common/utils/$","bonzo","bean","common/modules/userPrefs","common/utils/detect","common/modules/live/notification-bar","lodash/objects/assign","common/modules/article/twitter","lodash/collections/toArray"],function(e,t,n,o,i,s,a,r,c,l,d){function m(s){var m=c({activeClass:"is-active",btnClass:".js-auto-update",manipulationType:"html"},s);this.unreadBlocks=0,this.notification="<",this.template='  <button class="u-button-reset live-toggler live-toggler--autoupdate live-toggler--on js-auto-update js-auto-update--on"          data-action="off" data-link-name="autoupdate off" title="Turn auto update off">    <span class="live-toggler__label">Auto update:</span>    <span class="u-h">is</span>    <span class="live-toggle__value">On</span>    <span class="u-h">(turn off)</span>  </button>  <button class="u-button-reset live-toggler live-toggler--autoupdate live-toggler--off js-auto-update js-auto-update--off"          data-action="on" data-link-name="autoupdate on" title="Turn auto update on">    <span class="live-toggler__label">Auto update:</span>    <span class="u-h">is</span>    <span class="live-toggle__value">Off</span>    <span class="u-h">(turn on)</span>  </button>',this.view={render:function(t){var i=m.attachTo,s=this.getManipulationType(),a=(new Date).toString(),r=o(i),c=n.create("<div>"+t.html+"</div>")[0],u=c.innerHTML;this.unreadBlocks+=c.children.length,"prepend"===s?(o(c.children).addClass("autoupdate--hidden"),u=d(c.children)):"append"===s&&(o(c.children).addClass("autoupdate--hidden"),u=d(c.children).reverse()),r[s](u),r.attr("data-last-updated",a),l.enhanceTweets(),this.isUpdating?(this.notificationBar.setState("hidden"),this.view.revealNewElements.call(this)):this.unreadBlocks>0&&(this.notificationBar.notify(this.unreadBlocks),e.emit("modules:autoupdate:unread",this.unreadBlocks)),e.emit("modules:autoupdate:render")},toggle:function(e){var t=e.getAttribute("data-action");n(m.btnClass).removeClass(m.activeClass),n(".js-auto-update--"+t,e.parentNode).addClass(m.activeClass),this[t]()},destroy:function(){n(".update").remove(),e.emit("modules:autoupdate:destroyed")},revealNewElements:function(){var t=n(".autoupdate--hidden",m.attachTo);t.addClass("autoupdate--highlight").removeClass("autoupdate--hidden"),a.pageVisible()&&(this.unreadBlocks=0),e.emit("modules:autoupdate:unread",this.unreadBlocks),setTimeout(function(){t.removeClass("autoupdate--highlight")},5e3)}},this.load=function(){var n=this,o="function"==typeof m.path?m.path():m.path+".json";return t({url:o,type:"json",crossOrigin:!0}).then(function(t){t.refreshStatus===!1?(n.off(),n.view.destroy()):(n.view.render.call(n,t),e.emit("modules:autoupdate:loaded",t))},function(t){e.emit("module:error","Failed to load auto-update: "+t.statusText,"common/modules/autoupdate.js")})},this.on=function(){var e=this;this.nextReload=(new Date).getTime()+m.delay,this.isUpdating=!0,this.interval&&window.clearInterval(this.interval),this.interval=window.setInterval(function(){e.load.call(e),e.nextReload=(new Date).getTime()+m.delay},m.delay)},this.off=function(){this.isUpdating=!1},this.init=function(){if(!m.switches||m.switches.autoRefresh===!0){var t=this;this.notificationBar=new r({attachTo:n(".js-update-notification")[0]}),n(m.attachTo).addClass("autoupdate--has-animation"),a.initPageVisibility(),e.on("modules:detect:pagevisibility:visible",function(){this.isUpdating&&t.view.revealNewElements()}),e.on("modules:notificationbar:show",this.view.revealNewElements.bind(this)),n(".update").html(this.template).removeClass("u-h"),this.btns=n(m.btnClass),this.btns.each(function(e){i.add(e,"click",function(e){e.preventDefault(),t.view.toggle.call(t,this)})}),this.view.toggle.call(this,this.btns[1])}},this.setManipulationType=function(e){m.manipulationType=e},this.getManipulationType=function(){return m.manipulationType}}return m}),define("common/modules/live/filter",["common/utils/$","common/modules/component","common/utils/mediator","lodash/collections/toArray"],function(e,t,n,o){function i(e){this.context=e||document,this.componentClass="live-filter",this.useBem=!0}return t.define(i),i.prototype.template='<div><span class="live-toggler__label">Order by:</span>  <button class="u-button-reset live-toggler live-toggler--latest js-live-toggler" title="Sort by oldest first">    <span class="live-toggler__value">Latest</span>    <i class="i i-arrow-grey-down"></i>  </button>  <button class="u-button-reset live-toggler live-toggler--oldest js-live-toggler" title="Sort by latest first">    <span class="live-toggler__value">Oldest</span>    <i class="i i-arrow-grey-down"></i>  </button></div>',i.prototype.ready=function(){this.on("click",".js-live-toggler",this.toggle)},i.prototype.toggle=function(){var t=o(e(".block",this.context).detach());t.reverse(),this.toggleState("order-by-oldest"),e(this.context).prepend(t),n.emit("module:filter:toggle",this.hasState("order-by-oldest"))},i}),define("common/modules/ui/notification-counter",["common/utils/mediator"],function(e){function t(){}var n=document.title;return t.prototype.init=function(){var t=this;e.on("modules:autoupdate:unread",function(e){t.setCount(e)})},t.prototype.setCount=function(e){e>0?document.title="("+e+") "+n:this.restorePageTitle()},t.prototype.restorePageTitle=function(){document.title=n},t}),define("common/modules/experiments/affix",["bean","bonzo","lodash/functions/debounce","common/utils/request-animation-frame","common/utils/mediator"],function(e,t,n,o,i){var s=function(o){e.on(window,"scroll",n(this.checkPositionWithEventLoop.bind(this),10)),e.on(window,"click",this.checkPositionWithEventLoop.bind(this)),i.addListener("window:resize",this.calculateContainerPositioning.bind(this)),this.affixed=null,this.$markerTop=t(o.topMarker),this.$markerBottom=t(o.bottomMarker),this.$container=t(o.containerElement),this.$element=t(o.element),this.$window=t(document.body),this.calculateContainerPositioning()};return s.CLASS="affix",s.CLASSY_BOTTOM="affix-bottom",s.prototype.calculateContainerPositioning=function(){this.$container.css("top","0");var e=this.$markerTop.offset().top-this.$container.offset().top;this.$container.css("top",e+"px")},s.prototype.checkPositionWithEventLoop=function(){o(this.checkPosition.bind(this))},s.prototype.getPixels=function(e){return"auto"!==e?parseInt(e,10):0},s.prototype.checkPosition=function(){var e=this.$window.scrollTop()>=this.$markerTop.offset().top,n=this.$window.scrollTop()+this.$element.dim().height<this.$markerBottom.offset().top,o=this.$element.dim().height<t.viewport().height,i=n&&e&&o;if(this.affixed!==i){if(this.affixed=i,n)this.$container.removeClass(s.CLASSY_BOTTOM),this.calculateContainerPositioning();else{var a=this.getPixels(this.$container.css("top")),r=this.$markerBottom.offset().top-this.$markerTop.offset().top-this.$element.dim().height+a;this.$container.css("top",r+"px"),this.$container.addClass(s.CLASSY_BOTTOM)}i?this.$element.addClass(s.CLASS):this.$element.removeClass(s.CLASS)}},s}),define("common/bootstraps/liveblog",["common/utils/mediator","common/utils/$","qwery","bonzo","bean","lodash/functions/throttle","common/utils/_","common/utils/scroller","common/utils/detect","common/modules/ui/autoupdate","common/modules/live/filter","common/modules/ui/notification-counter","common/modules/experiments/affix","common/utils/template","common/utils/url","common/utils/context"],function(e,t,n,o,i,s,a,r,c,l,d,m,u,f,p,h){function g(){return n(".is-key-event").slice(0,7)}function v(){return n(".block")}function y(){return v().shift()}function b(){return v().pop()}function w(){function s(){t("."+l).removeClass(l)}function a(){i.off(c),c=i.one(document,"scroll",function(){s()})}var c,l="live-blog__key-event--selected";i.on(n(".timeline")[0],"click",".timeline__link",function(d){e.emit("module:liveblog:showkeyevents",!0),t(".dropdown--live-feed",h()).addClass("dropdown--active");var m=o(d.currentTarget),u=m.attr("data-event-id"),f=t(".timeline__title",m).text(),g=n("#"+u),v=o(g).offset();r.scrollTo(v.top,500,"easeOutQuint"),window.setTimeout(a,550),i.off(c),s(),m.addClass(l),p.pushUrl({blockId:u},f,window.location.pathname+"#"+u,!0),d.stop()})}function _(e){var n='<li class="timeline__item" data-event-id="{{id}}"><a class="timeline__link" href="#{{id}}" data-event-id="{{id}}"><span class="timeline__date">{{time}}</span><span class="timeline__title u-underline">{{title}}</span></a></li>',o={id:e.getAttribute("id"),title:t(".block-title",e).text(),time:t(".block-time__link",e).html()};return f(n,o)}function k(e){function t(e,o){return e.length?(o+=_(e[0]),n=e.slice(1),t(n,o)):o}var n;return t(e,"")}function x(e){return _(y())+e+_(b())}function C(){e.on("page:article:ready",function(e,o){var i=g(),s=x(k(i));if(t(".js-live-blog__timeline",o).append(s),t(".js-live-blog__timeline li:first-child .timeline__title").text("Latest post"),t(".js-live-blog__timeline li:last-child .timeline__title").text("Opening post"),/desktop|wide/.test(c.getBreakpoint())&&e.page.keywordIds.indexOf("football/football")<0){var a=n(".js-top-marker")[0];E=new u({element:n(".js-live-blog__timeline-container")[0],topMarker:a,bottomMarker:n(".js-bottom-marker")[0],containerElement:n(".js-live-blog__key-events")[0]})}w()})}function T(){e.on("page:article:ready",function(e,n){if(e.page.isLive){var o=/desktop|wide/.test(c.getBreakpoint())?3e4:6e4;I=new l({path:S,delay:o,attachTo:t(".article-body",n)[0],switches:e.switches,manipulationType:"prepend"}),I.init()}}),e.on("module:filter:toggle",function(e){I&&I.setManipulationType(e?"append":"prepend")})}function j(){e.on("page:article:ready",function(e,n){new d(t(".js-blog-blocks",n)[0]).render(t(".js-live-filter")[0]),(new m).init()})}function S(){var e=n(".article-body .block",h()),t=null;t="append"===I.getManipulationType()?e.pop():e.shift();var o=t?t.id:"block-0";return window.location.pathname+".json?lastUpdate="+o}var E=null,I=null;return{init:function(){T(),j(),g().length>0&&C()}}}),define("common/modules/article/world-cup",["common/utils/$","qwery","common/modules/lazyload","common/utils/mediator"],function(e,t,n,o){function i(){var i="/container/1be1-17a5-c04b-b002.json";new n({url:i,container:t(".js-world-cup")[0],error:function(e){o.emit("module:error","Failed to load world cup container: "+e.statusText,"common/modules/article/world-cup.js")},success:function(){o.emit("ui:images:upgrade"),e(".js-world-cup .js-container--show-more").addClass("u-h")}}).load()}return i}),define("lodash/collections/contains",["../internals/baseIndexOf","../objects/forOwn","../objects/isArray","../objects/isString"],function(e,t,n,o){function i(i,a,r){var c=-1,l=e,d=i?i.length:0,m=!1;return r=(0>r?s(0,d+r):r)||0,n(i)?m=l(i,a,r)>-1:"number"==typeof d?m=(o(i)?i.indexOf(a,r):l(i,a,r))>-1:t(i,function(e){return++c>=r?!(m=e===a):void 0}),m}var s=Math.max;return i}),define("common/bootstraps/article",["common/utils/mediator","common/utils/$","fence","common/modules/ui/rhc","common/modules/article/truncate","common/modules/article/twitter","common/modules/open/cta","common/bootstraps/liveblog","common/modules/article/world-cup","lodash/collections/contains"],function(e,t,n,o,i,s,a,r,c,l){var d={initLiveBlogging:function(e){e.page.isLiveBlog&&r.init()},initOpen:function(){e.on("page:article:ready",function(n,i){if(n.switches.openCta&&n.page.commentable){var s=new a(i,e,{discussionKey:n.page.shortUrl.replace("http://gu.com/","")});t.create('<div class="open-cta"></div>').each(function(e){s.fetch(e),n.page.isLiveBlog||o.addComponent(e)})}})},initFence:function(){e.on("page:article:ready",function(){t(".fenced").each(function(e){n.render(e)})})},initTruncateAndTwitter:function(){e.on("page:article:ready",function(){i(),s.enhanceTweets()})},initWorldCup:function(e){var t=e.page.keywordIds.split(",");e.switches.worldcupArticleContainer&&l(t,"football/world-cup-2014")&&c()}},m=function(t,n){this.initialised||(this.initialised=!0,d.initLiveBlogging(t),d.initOpen(t),d.initFence(),d.initTruncateAndTwitter(),d.initWorldCup(t)),e.emit("page:article:ready",t,n)};return{init:m}}),define("common/modules/analytics/omnitureMedia",["lodash/functions/throttle","common/utils/config","bean"],function(e,t,n){function o(o){var i=t.page.webTitle,a=t.page.source||"",r=t.page.blockVideoAds||"";this.getDuration=function(){return o.duration},this.getPosition=function(){return o.currentTime},this.play=function(){s.Media.open(i,this.getDuration(),"HTML5 Video"),s.Media.play(i,this.getPosition())},this.pause=function(){s.Media.stop(i,this.getPosition())},this.buffer=function(){s.Media.stop(i,this.getPosition())},this.seeking=function(){s.Media.stop(i,this.getPosition())},this.seeked=function(){s.Media.play(i,this.getPosition())},this.trackUserInteraction=function(e,t){var n;switch(e){case"Play":n="event98";break;case"Advert":n="event97"}s.prop41=e,s.linkTrackVars="events,eVar11,prop41,eVar43,prop43,eVar44,prop44",s.linkTrackEvents=n,s.events=n,s.tl(!0,"o",t)},this.trackVideoAdvertReady=function(){s.trackVideoAd(),this.trackUserInteraction("Advert","Video advert is ready")},this.trackVideoContentReady=function(){s.trackVideoContent(a,r),this.trackUserInteraction("Play","Video content is ready")},this.init=function(){s.loadMediaModule(a,r),s.prop11=t.page.sectionName||"",s.prop43="Video",s.eVar11=s.prop11,s.eVar43=s.prop43,n.on(o,"pause",this.pause.bind(this)),n.on(o,"seeking",this.seeking.bind(this)),n.on(o,"seeked",this.seeked.bind(this)),n.on(o,"volumechange",e(this.trackUserInteraction.bind(this,"Volume","User Changed Volume"),250)),n.on(o,"video:preroll:ready",this.trackVideoAdvertReady.bind(this)),n.on(o,"video:content:ready",this.trackVideoContentReady.bind(this)),n.on(o,"video:preroll:play video:content:play",this.play.bind(this))}}return o}),define("common/bootstraps/video",["common/utils/$","common/utils/ajax","common/utils/detect","common/utils/config","common/utils/deferToAnalytics","common/utils/url","common/modules/ui/images","common/modules/commercial/dfp","common/modules/analytics/omnitureMedia","lodash/functions/throttle","bean","bonzo","common/modules/component"],function(e,t,n,o,i,s,a,r,c,l,d,m,u){var f="Video"===o.page.contentType&&/desktop|wide/.test(n.getBreakpoint()),p=[25,50,75],h=["video:preroll:ready","video:preroll:play","video:preroll:end","video:content:ready","video:content:play","video:content:end"],g={ophanRecord:function(e,t){var n=e.getAttribute("data-media-id");
n&&require("ophan/ng",function(e){e.record({video:{id:n,eventType:t.type}})})},initOphanTracking:function(e){h.concat(p.map(function(e){return"video:play:"+e})).forEach(function(t){d.one(e,t,function(t){g.ophanRecord(e,t)})})},initOmnitureTracking:function(e){new c(e).init(),m(e).addClass("tracking-applied")},bindPrerollEvents:function(e,t){var n=0,o={end:function(){d.fire(t,"video:preroll:end"),g.bindContentEvents(e,t)},playWithDuration:function(){n>0?(d.fire(t,"video:preroll:play"),n=0):n++},ready:function(){d.fire(t,"video:preroll:ready"),e.one("play",o.playWithDuration),e.one("durationchange",o.playWithDuration),e.one("ended",o.end),f&&e.play()}};e.one("adsready",o.ready),e.one("adtimeout",function(){g.bindContentEvents(e,t,!0)})},bindContentEvents:function(e,t,n){var o=0,i={end:function(){d.fire(t,"video:content:end")},playWithDuration:function(){o>0||e.duration()?(d.fire(t,"video:content:play"),o=0):o++},timeupdate:function(){var n=Math.round(parseInt(e.currentTime()/e.duration()*100,10));p.reverse().some(function(e){return n>=e?(d.fire(t,"video:play:"+e),!0):!1})},ready:function(){d.fire(t,"video:content:ready"),e.one("play",i.playWithDuration),e.one("durationchange",i.playWithDuration),e.on("timeupdate",l(i.timeupdate,1e3)),e.one("ended",i.end),f&&e.play()}};n?i.ready():e.one("loadstart",i.ready)},getVastUrl:function(){var e=o.page.adUnit,t=s.constructQuery(r.buildPageTargeting({page:o.page})),n=encodeURIComponent(t),i=(new Date).getTime(),a="http://"+o.page.dfpHost+"/gampad/ads?correlator="+i+"&gdfp_req=1&env=vp&impl=s&output=xml_vast2&unviewed_position_start=1&iu="+e+"&sz=400x300&scp=slot%3Dvideo&cust_params="+n;return a},countDown:function(){var t=this,n='<div class="vjs-ads-overlay js-ads-overlay">Your video will start in <span class="vjs-ads-overlay__remaining js-remaining-time"></span> seconds <span class="vjs-ads-overlay__label">Advertisement</span></div>',o={destroy:function(){e(".js-ads-overlay",this.el()).remove(),this.off("timeupdate",o.update)},update:function(){e(".js-remaining-time",this.el()).text(parseInt(this.duration()-this.currentTime(),10).toFixed())},init:function(){e(this.el()).append(e.create(n)),this.on("timeupdate",o.update.bind(this)),this.one("video:preroll:end",o.destroy.bind(t)),this.one("video:content:play",o.destroy.bind(t)),this.one("adtimeout",o.destroy.bind(t))}};this.one("video:preroll:play",o.init.bind(t))},initLoadingSpinner:function(e){e.loadingSpinner.contentEl().innerHTML='<div class="pamplemousse"><div class="pamplemousse__pip"><i></i></div><div class="pamplemousse__pip"><i></i></div><div class="pamplemousse__pip"><i></i></div></div>'},initPlayer:function(){require("bootstraps/video-player",function(){videojs.plugin("adCountDown",g.countDown),e(".gu-video").each(function(e){var t=videojs(e,{controls:!0,autoplay:!1,preload:"metadata"});t.ready(function(){var t=this;g.initLoadingSpinner(t),i(function(){g.initOmnitureTracking(e),g.initOphanTracking(e),g.bindPrerollEvents(t,e),t.adCountDown(),t.ads({timeout:3e3}),t.vast({url:g.getVastUrl()})})});var n;t.on("mousemove",function(){n?clearTimeout(n):t.addClass("vjs-mousemoved"),n=setTimeout(function(){t.removeClass("vjs-mousemoved"),n=!1},500)});var o=t.volume();o&&(t.volume(0),t.volume(o)),t.persistvolume({namespace:"gu.vjs"})})})},initMoreInSection:function(){var t=new u,n=e(".js-onward")[0];t.endpoint="/video/section/"+o.page.section+".json?shortUrl="+o.page.shortUrl,t.fetch(n).then(function(){a.upgrade(n)})}},v=function(){g.initPlayer(),"Video"===o.page.contentType&&g.initMoreInSection()};return{init:v}}),define("common/bootstraps/gallery",["common/utils/mediator"],function(e){var t=function(t,n){this.initialised||(this.initialised=!0),e.emit("page:gallery:ready",t,n)};return{init:t}}),define("common/modules/identity/forms",["bean","bonzo"],function(e,t){function n(e,t){var n=t.querySelector(".js-reset-form");if(n){var o=window.location.hash.match("email=([^&#]*)");if(o){var i=n.querySelector(".js-reset-email");i.value=o[1]}}}function o(t,n){var o=n.querySelector(".js-signin-form");if(o){var i=o.querySelector(".js-signin-email"),s=o.querySelector(".js-forgotten-password"),a=s.getAttribute("href");e.add(s,"click",function(){var e=i.value;""!==e&&s.setAttribute("href",a+"#email="+e)})}}function i(n,o){var i=o.querySelector(".js-register-form");if(i){var s=i.querySelector(".js-register-password"),a="js-toggle-password",r='<div class="form-field__note form-field__note--right mobile-only"><a href="#toggle-password" class="'+a+'" data-password-label="Show password" data-text-label="Hide password" data-link-name="Toggle password field">Show password</a></div>',c=t(t.create(r)).insertBefore(s);c.previous().addClass("form-field__note--left"),e.add(c[0],"."+a,"click",function(e){e.preventDefault();var n=e.target,o="password"===s.getAttribute("type")?"text":"password",i=n.getAttribute("data-"+o+"-label");s.setAttribute("type",o),t(n).text(i)})}}return{forgottenEmail:n,forgottenPassword:o,passwordToggle:i}}),define("common/modules/identity/formstack",["common/utils/$","lodash/objects/assign","bean","common/modules/identity/api"],function(e,t,n,o){function i(i,s,a,r){var c=this,l={},d=s.split("-")[0];r=t({idClasses:{form:"form",field:"form-field",note:"form-field__note form-field__note--below",label:"label",checkboxLabel:"check-label",textInput:"text-input",textArea:"textarea textarea--no-resize",submit:"submit-input",fieldError:"form-field--error",formError:"form__error",fieldset:"formstack-fieldset",required:"formstack-required",sectionHeader:"formstack-heading",sectionHeaderFirst:"formstack-heading--first",sectionText:"formstack-section",characterCount:"formstack-count",hide:"is-hidden"},fsSelectors:{form:"#fsForm"+d,field:".fsRow",note:".fsSupporting, .showMobile",label:".fsLabel",checkboxLabel:".fsOptionLabel",textInput:'.fsField[type="text"], .fsField[type="email"], .fsField[type="number"], .fsField[type="tel"]',textArea:"textarea.fsField",submit:".fsSubmitButton",fieldError:".fsValidationError",formError:".fsError",fieldset:"fieldset",required:".fsRequiredMarker",sectionHeader:".fsSectionHeading",sectionHeaderFirst:".fsSection:first-child .fsSectionHeading",sectionText:".fsSectionText",characterCount:".fsCounter",hide:".hidden, .fsHidden, .ui-datepicker-trigger"},hiddenSelectors:{userId:'[type="number"]',email:'[type="email"]'}},r),c.init=function(){var t=o.getUserOrSignIn();c.dom(t),e(i).removeClass(r.idClasses.hide),e("html").addClass("iframed--overflow-hidden"),c.postMessage("ready")},c.dom=function(t){l.$form=e(r.fsSelectors.form).addClass(r.idClasses.form),e("link",i).remove();for(var o in r.fsSelectors)e(r.fsSelectors[o],l.$form).addClass(r.idClasses[o]);var s=e(r.hiddenSelectors.userId,l.$form).remove(),a=e(r.hiddenSelectors.email,l.$form).remove(),d='<input type="hidden" name="'+s.attr("name")+'" value="'+t.id+'"><input type="hidden" name="'+a.attr("name")+'" value="'+t.primaryEmailAddress+'">';l.$form.append(d),n.on(window,"unload",c.unload),n.on(l.$form[0],"submit",c.submit)},c.submit=function(){setTimeout(function(){e("."+r.idClasses.formError).removeClass(r.idClasses.formError),e("."+r.idClasses.fieldError).removeClass(r.idClasses.fieldError),e(r.fsSelectors.formError,l.$form).addClass(r.idClasses.formError),e(r.fsSelectors.fieldError,l.$form).addClass(r.idClasses.fieldError),e(r.fsSelectors.textArea,i).each(function(e){n.fire(e,"keyup")}),c.postMessage("refreshHeight")},100)},c.unload=function(){c.postMessage("unload")},c.postMessage=function(e){var t=r.page.idUrl;window.top.postMessage(e,t)}}return i}),define("common/modules/identity/formstack-iframe",["common/utils/$","bean"],function(e,t){function n(n,o,i){var s=this;s.init=function(){t.on(window,"message",function(e){e.origin===i.page.idUrl&&s.onMessage(e)}),t.on(window,"resize",s.refreshHeight),t.on(n,"load",function(){s.show(),s.refreshHeight()})},s.onMessage=function(e){switch(e.data){case"ready":s.show(),s.refreshHeight();break;case"unload":s.refreshHeight(!0);break;case"refreshHeight":s.refreshHeight()}},s.refreshHeight=function(t){t&&e(n).css({height:0});var o=n.contentWindow.document,i=o.body,s=o.documentElement,a=Math.max(i.scrollHeight,i.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight);e(n).css({height:a})},s.show=function(){e(n).removeClass("is-hidden")}}return n}),define("common/modules/identity/formstack-iframe-embed",["common/utils/$","lodash/objects/assign","bean","common/modules/identity/api"],function(e,t,n,o){function i(i,s,a,r){var c=this,l={},d=s.split("-")[0];r=t({idClasses:{form:"form",field:"form-field",note:"form-field__note form-field__note--below",label:"label",checkboxLabel:"check-label",textInput:"text-input",textArea:"textarea textarea--no-resize",submit:"submit-input",fieldError:"form-field--error",formError:"form__error",fieldset:"formstack-fieldset",required:"formstack-required",sectionHeader:"formstack-heading",sectionHeaderFirst:"formstack-heading--first",sectionText:"formstack-section",characterCount:"formstack-count",hide:"is-hidden"},fsSelectors:{form:"#fsForm"+d,field:".fsRow",note:".fsSupporting, .showMobile",label:".fsLabel",checkboxLabel:".fsOptionLabel",textInput:'.fsField[type="text"], .fsField[type="email"], .fsField[type="number"], .fsField[type="tel"]',textArea:"textarea.fsField",submit:".fsSubmitButton",fieldError:".fsValidationError",formError:".fsError",fieldset:"fieldset",required:".fsRequiredMarker",sectionHeader:".fsSectionHeading",sectionHeaderFirst:".fsSection:first-child .fsSectionHeading",sectionText:".fsSectionText",characterCount:".fsCounter",hide:".hidden, .fsHidden, .ui-datepicker-trigger"},hiddenSelectors:{userId:'[type="number"]',email:'[type="email"]'}},r),c.init=function(){var t=o.getUserOrSignIn();c.dom(t),e(i).removeClass(r.idClasses.hide),e("html").addClass("iframed--overflow-hidden"),c.sendHeight()},c.dom=function(t){l.$form=e(r.fsSelectors.form).addClass(r.idClasses.form),e("link",i).remove();for(var o in r.fsSelectors)e(r.fsSelectors[o],l.$form).addClass(r.idClasses[o]);var s=e(r.hiddenSelectors.userId,l.$form).remove(),a=e(r.hiddenSelectors.email,l.$form).remove(),d='<input type="hidden" name="'+s.attr("name")+'" value="'+t.id+'"><input type="hidden" name="'+a.attr("name")+'" value="'+t.primaryEmailAddress+'">';l.$form.append(d),n.on(window,"unload",c.unload),n.on(l.$form[0],"submit",c.submit),window.addEventListener("message",function(e){var t=JSON.parse(e.data);t.iframeTop&&c.scrollToTopOfIframe(t.iframeTop)},!1)},c.submit=function(t){t.preventDefault(),setTimeout(function(){e("."+r.idClasses.formError).removeClass(r.idClasses.formError),e("."+r.idClasses.fieldError).removeClass(r.idClasses.fieldError),e(r.fsSelectors.formError,l.$form).addClass(r.idClasses.formError),e(r.fsSelectors.fieldError,l.$form).addClass(r.idClasses.fieldError),e(r.fsSelectors.textArea,i).each(function(e){n.fire(e,"keyup")}),c.postMessage("get-position","get-position"),0===e(r.fsSelectors.formError,l.$form).length&&l.$form[0].submit()},100)},c.scrollToTopOfIframe=function(e){c.postMessage("scroll-to","scroll-to",0,e)},c.unload=function(){c.sendHeight(!0)},c.sendHeight=function(){var e=document.body,t=document.documentElement,n=Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight);c.postMessage("set-height",n)},c.postMessage=function(e,t,n,o){var i={type:e,value:t,href:window.location.href};n&&(i.x=n),o&&(i.y=o),window.top.postMessage(JSON.stringify(i),"*")}}return i}),define("common/modules/identity/password-strength",["lodash/objects/assign","bonzo","bean"],function(e,t,n){function o(o,i,s){s=e({text:{label:"Password strength","long":"Password too long","short":"Password too short"},classes:{indicator:"js-password-strength-indicator",label:"js-password-strength-label",ready:"has-indicator"},labels:["weak","poor","medium","good","strong"],minLength:6,maxLength:20},s);var a,r=!1,c={element:o},l='<div class="password-strength-indicator '+s.classes.indicator+' score-null is-off"><div class="form-field__note form-field__note--below form-field__note--right password-strength '+s.classes.label+'">'+s.text.label+"</div></div>";this.init=function(){if(!t(c.element).hasClass(s.classes.ready)){var e=this;require(["js!zxcvbn"],function(){a=this.zxcvbn,c.indicator=t(t.create(l)).insertAfter(c.element)[0],c.label=c.indicator.querySelector("."+s.classes.label),n.on(c.element,"keyup.count",e.checkCount),n.on(c.element,"keyup.key",e.checkStrength),e.checkCount(),e.checkStrength(),t(c.element).addClass(s.classes.ready)})}},this.checkCount=function(){c.element.value.length>=s.minLength&&(r=!0,t(c.indicator).removeClass("is-off"),n.off(c.element,"keyup.count"))},this.checkStrength=function(){if(r){var e=a(c.element.value).score,n=s.text.label+": "+s.labels[e];c.element.value.length<s.minLength?(n=s.text["short"],e=null):c.element.value.length>s.maxLength&&(n=s.text["long"],e=null),c.indicator.className=c.indicator.className.replace(/\bscore-\S+/g,"score-"+e),t(c.label).text(n)}}}return o}),define("common/modules/identity/account-profile",["common/utils/$","bean","bonzo","common/utils/url"],function(e,t,n,o){var i=function(){var n=this;return n.classes={forms:".js-account-profile-forms",accountForm:".js-account-details-form",publicForm:".js-public-profile-form",tabs:".js-tabs",formError:".form__error",changed:"js-form-changed",textInput:".text-input",avatarUploadForm:".js-avatar-upload-form",memberShipContainer:".js-memebership-tab-container"},n.messages={noCorsError:"Cross-origin resource sharing is not supported by this browser. Please upgrade your browser to use this feature.",noServerError:"The image upload server could not be reached."},n.urls={avatarTokenUrl:"https://gu-image-upload.appspot.com/upload-endpoint-generator"},n.unsavedFields=[],{init:function(o){if(n.accountProfileForms=o.querySelector(n.classes.forms),n.accountProfileForms){n.bindAvatarUpload(),n.bindInputs(n.accountProfileForms.querySelector(n.classes.accountForm)),n.bindInputs(n.accountProfileForms.querySelector(n.classes.publicForm));var i=n.accountProfileForms.querySelector(n.classes.tabs);require(["bootstraps/membership"],function(t){n.membershipTab=new t(o),n.membershipTab.fetch(e(n.classes.memberShipContainer))}),e(n.classes.tabs+" .tabs__tab a").each(function(){this.href=this.getAttribute("data-tabs-href")}),t.on(i,"click",n.handleTabsClick.bind(n))}}}};return i.prototype.handleTabsClick=function(e){var i=this;"a"===e.target.nodeName.toLowerCase()&&(i.unsavedChangesForm?(e.preventDefault(),e.stopImmediatePropagation(),i.unsavedChangesForm.querySelector(i.classes.formError)||(n(i.unsavedChangesForm).prepend(i.genUnsavedError()),t.on(i.unsavedChangesForm.querySelector(".js-save-unsaved"),"click",function(){i.unsavedChangesForm.submit()}))):o.pushUrl({},e.target.innerHTML,e.target.getAttribute("data-pushstate-url")))},i.prototype.bindAvatarUpload=function(){var e=this,n=e.accountProfileForms.querySelector(e.classes.avatarUploadForm);n&&t.on(n,"submit",function(t){t.preventDefault();var o=e.createCORSRequest("GET",e.urls.avatarTokenUrl);o||e.prependErrorMessage(e.messages.noCorsError,n),o.onerror=function(){e.prependErrorMessage(e.messages.noServerError,n)},o.onload=function(){n.setAttribute("action",o.responseText),n.submit()},o.send()})},i.prototype.prependErrorMessage=function(e,t){var n=document.createElement("div");n.innerHTML=e,n.className=this.classes.formError.replace(".",""),t.insertBefore(n,t.firstChild)},i.prototype.createCORSRequest=function(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e,t)):n=null,n},i.prototype.genUnsavedError=function(){for(var e='<div class="form__error">',t="</div>",n='<a href="#" class="js-save-unsaved">Save changes</a>',o="Your form has unsaved changes in ",i=0;i<this.unsavedFields.length;i++){var s=this.unsavedFields[i].id,a=this.accountProfileForms.querySelector('[for="'+s+'"]').innerHTML;o+='"'+a+'"',o+=i===this.unsavedFields.length-1?". ":i===this.unsavedFields.length-2?" and ":", "}return e+o+n+t},i.prototype.onInputChange=function(e){n(e.target.form).addClass(this.classes.changed),this.unsavedChangesForm=e.target.form,this.unsavedFields.some(function(t){return t===e.target})||this.unsavedFields.push(e.target)},i.prototype.bindInputs=function(e){var t=Array.prototype.slice.call(e.querySelectorAll(this.classes.textInput));t=t.concat(Array.prototype.slice.call(e.querySelectorAll("select")));for(var n=t.length-1;n>=0;n--){var o=t[n];o.form=e,"select-one"===o.type?o.addEventListener("change",this.onInputChange.bind(this)):o.addEventListener("input",this.onInputChange.bind(this))}},i}),define("common/bootstraps/identity",["common/utils/$","common/modules/identity/forms","common/modules/identity/formstack","common/modules/identity/formstack-iframe","common/modules/identity/formstack-iframe-embed","common/modules/identity/password-strength","common/modules/identity/validation-email","common/modules/identity/api","common/modules/identity/account-profile","common/modules/commercial/user-ad-targeting","common/modules/discussion/user-avatars","common/utils/mediator","common/modules/ui/tabs"],function(e,t,n,o,i,s,a,r,c,l,d,m,u){var f={idInit:function(e){r.init(e),r.isUserLoggedIn()&&(document.documentElement.className=document.documentElement.className.replace(/\bid--signed-out\b/,"id--signed-in"))},initFormstack:function(){m.on("page:identity:ready",function(t,s){var a="data-formstack-id";e("["+a+"]").each(function(e){var o=e.getAttribute(a),r=e.className.match(/\bformstack-embed\b/);r?new i(e,o,s,t).init():new n(e,o,s,t).init()}),e(".js-formstack-iframe").each(function(e){new o(e,s,t).init()})})},forgottenEmail:function(){m.on("page:identity:ready",function(e,n){t.forgottenEmail(e,n)})},forgottenPassword:function(){m.on("page:identity:ready",function(e,n){t.forgottenPassword(e,n)})},passwordStrength:function(){m.on("page:identity:ready",function(t,n){e(".js-password-strength").each(function(e){new s(e,n,t).init()})})},passwordToggle:function(){m.on("page:identity:ready",function(e,n){t.passwordToggle(e,n)})},userAdTargeting:function(){m.on("page:identity:ready",function(){l.requestUserSegmentsFromId()})},userAvatars:function(){m.on("page:identity:ready",function(){d.init()})},validationEmail:function(){m.on("page:identity:ready",function(e,t){a.init(t)})},tabs:function(){var e=new u;m.on("page:identity:ready",function(t,n){e.init(n)})},accountProfile:function(){var e=new c;m.on("page:identity:ready",function(t,n){e.init(n)})}},p=function(e,t){this.initialised||(this.initialised=!0,f.idInit(e),f.initFormstack(),f.forgottenEmail(),f.forgottenPassword(),f.passwordStrength(),f.passwordToggle(),f.userAdTargeting(),f.userAvatars(),f.validationEmail(),f.tabs(),f.accountProfile()),m.emit("page:identity:ready",e,t)};return{init:p}}),define("common/modules/identity/public-profile",["common/utils/$","bonzo","bean","common/utils/config","common/utils/context","common/utils/url","common/modules/component","common/modules/discussion/api","common/modules/discussion/activity-stream","lodash/objects/mapValues"],function(e,t,n,o,i,s,a,r,c,l){function d(n){var o,i={userId:"data-user-id",streamType:"data-stream-type"};return e(".js-activity-stream").each(function(e){(o=new c(l(i,function(t){return e.getAttribute(t)}))).fetch(e).then(function(){t(e).removeClass("activity-stream--loading")})}).addClass("activity-stream--loading"),n(o),o}function m(n){e(".tabs__tab--selected").removeClass("tabs__tab--selected"),t(n).parent().addClass("tabs__tab--selected")}function u(e){n.on(i(),"click",".js-activity-stream-change",function(t){var n=t.currentTarget,o=n.getAttribute("data-stream-type");t.preventDefault(),m(n),e.change({page:1,streamType:o}).then(function(){s.pushUrl({},null,"/user/id/"+e.options.userId+("discussions"!==o?"/"+o:""),!0)})})}function f(t){n.on(i(),"submit",".js-activity-stream-search",function(n){var o=n.currentTarget.elements.q.value;n.preventDefault(),m(e('a[data-stream-type="discussions"]')),t.change({streamType:""!==o?"search/"+encodeURIComponent(o):"comments"})})}function p(){d(function(e){u(e),f(e)})}return{init:p}}),define("common/bootstraps/profile",["common/modules/identity/public-profile"],function(e){function t(){e.init()}return{init:t}}),define("bootstraps/app",["qwery","common/utils/mediator","common/utils/ajax","common/utils/detect","common/utils/config","common/utils/context","common/utils/userTiming","common/modules/ui/fonts","common/modules/commercial/user-ad-targeting","common/modules/discussion/api","common/bootstraps/common","common/bootstraps/tag","common/bootstraps/section","common/bootstraps/football","common/bootstraps/article","common/bootstraps/video","common/bootstraps/gallery","common/bootstraps/identity","common/bootstraps/profile"],function(e,t,n,o,i,s,a,r,c,l,d,m,u,f,p,h,g,v,y){var b={initialiseAjax:function(e){n.init(e)},initialiseDiscussionApi:function(e){l.init(e)},loadFonts:function(e,t){if(e.switches.webFonts&&!guardian.shouldLoadFontsAsynchronously){var n=o.getFontFormatSupport(t),i=document.querySelectorAll("[data-cache-name].initial"),s=new r(i,n);s.loadFromServerAndApply()}},initId:function(e,t){v.init(e,t)},initUserAdTargeting:function(){c.requestUserSegmentsFromId()}},w=function(){a.mark("App Begin");var n=document.getElementById("js-context");s.set(n),b.initialiseAjax(i),b.initialiseDiscussionApi(i),b.loadFonts(i,navigator.userAgent),b.initId(i,n),b.initUserAdTargeting();var o=function(t,n){d.init(t,n),t.page.isFront&&require("bootstraps/facia",function(e){e.init(t,n)}),"Article"===t.page.contentType&&p.init(t,n),("Video"===t.page.contentType||e("video").length)&&h.init(t,n),"Gallery"===t.page.contentType&&g.init(t,n),"Tag"===t.page.contentType&&m.init(t,n),"Section"!==t.page.contentType||t.page.isFront||u.init(t,n),"football"===t.page.section&&f.init(),"identity"===t.page.section&&y.init()};t.on("page:ready",o),t.emit("page:ready",i,n),a.mark("App End")};return{go:w}});
//# sourceMappingURL=app.js.map